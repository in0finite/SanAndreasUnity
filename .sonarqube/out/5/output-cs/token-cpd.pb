	
FD:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\ConsoleLog.cs
	namespace 	
SanAndreasAPI
 
{ 
public 

class 

ConsoleLog 
{ 
public 
string 
	logString 
;  
public 
string 

stackTrace  
;  !
public		 
LogType		 
logType		 
;		 
private 

ConsoleLog 
( 
) 
{ 	
} 	
public 

ConsoleLog 
( 
string  
	logString! *
,* +
string, 2

stackTrace3 =
,= >
LogType? F
logTypeG N
)N O
{ 	
this 
. 
	logString 
= 
	logString &
;& '
this 
. 

stackTrace 
= 

stackTrace (
;( )
this 
. 
logType 
= 
logType "
;" #
} 	
} 
} ş
SD:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str (
)( )
]) *
[ 
assembly 	
:	 

AssemblyDescription 
( 
$str !
)! "
]" #
[		 
assembly		 	
:			 
!
AssemblyConfiguration		  
(		  !
$str		! #
)		# $
]		$ %
[

 
assembly

 	
:

	 

AssemblyCompany

 
(

 
$str

 
)

 
]

 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str *
)* +
]+ ,
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
["" 
assembly"" 	
:""	 

AssemblyVersion"" 
("" 
$str"" $
)""$ %
]""% &
[## 
assembly## 	
:##	 

AssemblyFileVersion## 
(## 
$str## (
)##( )
]##) *‘
HD:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\SocketClient.cs
	namespace 	
SanAndreasAPI
 
{ 
public 

class 
SocketClient 
: 
IDisposable  +
{ 
public 
SocketClientConsole "
myLogger# +
=, -
new. 1
SocketClientConsole2 E
(E F
)F G
;G H
public 
Socket 
ClientSocket "
;" #
public 
	IPAddress 
IP 
; 
public 
ushort 
Port 
; 
public!! 
ulong!! 
Id!! 
;!! 
[## 	
Obsolete##	 
(## 
$str## &
)##& '
]##' (
private$$ 

IPEndPoint$$ 
	_endpoint$$ $
;$$$ %
public(( 
Action(( 
<(( 
object(( 
,(( 
Socket(( $
>(($ %)
ReceivedServerMessageCallback((& C
;((C D
public)) 
Action)) 
OnConnectedCallback)) )
;))) *
private// 
SocketState// 
_state// "
;//" #
public11 
SocketState11 
myState11 "
{22 	
get33 
{44 
return55 
_state55 
;55 
}66 
}77 	
internal;; 

IPEndPoint;; 
IPEnd;; !
{<< 	
get== 
{>> 
if?? 
(?? 
IP?? 
!=?? 
null?? 
)?? 
{@@ 
ifAA 
(AA 
	_endpointAA !
==AA" $
nullAA% )
)AA) *
	_endpointBB !
=BB" #
newBB$ '

IPEndPointBB( 2
(BB2 3
IPBB3 5
,BB5 6
PortBB7 ;
)BB; <
;BB< =
returnCC 
	_endpointCC $
;CC$ %
}DD 
elseEE 
returnEE 
nullEE  
;EE  !
}FF 
}GG 	
publicKK 
ulongKK 
maxReqIdKK 
{LL 	
getMM 
{NN 
returnOO 
IdOO 
+OO 
ushortOO "
.OO" #
MaxValueOO# +
;OO+ ,
}PP 
}QQ 	
public[[ 
SocketClient[[ 
([[ 
bool[[  
doConnection[[! -
=[[. /
false[[0 5
)[[5 6
:[[7 8
this\\ 
(\\ 
	IPAddress\\ 
.\\ 
Loopback\\ #
,\\# $
SocketServer\\% 1
.\\1 2
DefPort\\2 9
,\\9 :

SocketType\\; E
.\\E F
Stream\\F L
,\\L M
ProtocolType\\N Z
.\\Z [
Tcp\\[ ^
,\\^ _
null\\` d
,\\d e
doConnection\\f r
)\\r s
{]] 	
}]]
 
publicdd 
SocketClientdd 
(dd 
Actiondd "
<dd" #
objectdd# )
,dd) *
Socketdd+ 1
>dd1 2
	everyFuncdd3 <
,dd< =
booldd> B
doConnectionddC O
=ddP Q
falseddR W
)ddW X
:ddY Z
thisee 
(ee 
	IPAddressee 
.ee 
Loopbackee #
,ee# $
SocketServeree% 1
.ee1 2
DefPortee2 9
,ee9 :

SocketTypeee; E
.eeE F
StreameeF L
,eeL M
ProtocolTypeeeN Z
.eeZ [
Tcpee[ ^
,ee^ _
	everyFuncee` i
,eei j
doConnectioneek w
)eew x
{ff 	
}ff
 
publicnn 
SocketClientnn 
(nn 
stringnn "
ipnn# %
,nn% &
ushortnn' -
portnn. 2
,nn2 3
boolnn4 8
doConnectionnn9 E
=nnF G
falsennH M
)nnM N
:nnO P
thisoo 
(oo 
ipoo 
,oo 
portoo 
,oo 
nulloo 
,oo  
doConnectionoo! -
)oo- .
{pp 	
}pp
 
publicrr 
SocketClientrr 
(rr 
	IPAddressrr %
iprr& (
,rr( )
ushortrr* 0
portrr1 5
,rr5 6
boolrr7 ;
doConnectionrr< H
=rrI J
falserrK P
)rrP Q
:rrR S
thisss 
(ss 
ipss 
,ss 
portss 
,ss 

SocketTypess %
.ss% &
Streamss& ,
,ss, -
ProtocolTypess. :
.ss: ;
Tcpss; >
,ss> ?
nullss@ D
,ssD E
doConnectionssF R
)ssR S
{tt 	
}tt
 
publicvv 
SocketClientvv 
(vv 
	IPAddressvv %
ipvv& (
,vv( )
ushortvv* 0
portvv1 5
,vv5 6
Actionvv7 =
<vv= >
objectvv> D
,vvD E
SocketvvF L
>vvL M
	everyFuncvvN W
,vvW X
boolvvY ]
doConnectionvv^ j
=vvk l
falsevvm r
)vvr s
:vvt u
thisww 
(ww 
ipww 
,ww 
portww 
,ww 

SocketTypeww %
.ww% &
Streamww& ,
,ww, -
ProtocolTypeww. :
.ww: ;
Tcpww; >
,ww> ?
	everyFuncww@ I
,wwI J
doConnectionwwK W
)wwW X
{xx 	
}xx
 
public
‚‚ 
SocketClient
‚‚ 
(
‚‚ 
string
‚‚ "
ip
‚‚# %
,
‚‚% &
ushort
‚‚' -
port
‚‚. 2
,
‚‚2 3
Action
‚‚4 :
<
‚‚: ;
object
‚‚; A
,
‚‚A B
Socket
‚‚C I
>
‚‚I J
	everyFunc
‚‚K T
,
‚‚T U
bool
‚‚V Z
doConnection
‚‚[ g
=
‚‚h i
false
‚‚j o
)
‚‚o p
:
‚‚q r
this
ƒƒ 
(
ƒƒ 
	IPAddress
ƒƒ 
.
ƒƒ 
Parse
ƒƒ  
(
ƒƒ  !
ip
ƒƒ! #
)
ƒƒ# $
,
ƒƒ$ %
port
ƒƒ& *
,
ƒƒ* +

SocketType
ƒƒ, 6
.
ƒƒ6 7
Stream
ƒƒ7 =
,
ƒƒ= >
ProtocolType
ƒƒ? K
.
ƒƒK L
Tcp
ƒƒL O
,
ƒƒO P
	everyFunc
ƒƒQ Z
,
ƒƒZ [
doConnection
ƒƒ\ h
)
ƒƒh i
{
„„ 	
}
„„
 
public
 
SocketClient
 
(
 
	IPAddress
 %
ipAddr
& ,
,
, -
ushort
. 4
port
5 9
,
9 :

SocketType
; E
sType
F K
,
K L
ProtocolType
M Y
pType
Z _
,
_ `
Action
a g
<
g h
object
h n
,
n o
Socket
p v
>
v w
	everyFuncx 
, ‚
boolƒ ‡
doConnectionˆ ”
=• –
false— œ
)œ 
{
‘‘ 	+
ReceivedServerMessageCallback
”” )
=
””* +
	everyFunc
””, 5
;
””5 6
IP
šš 
=
šš 
ipAddr
šš 
;
šš 
Port
›› 
=
›› 
port
›› 
;
›› 
ClientSocket
 
=
 
new
 
Socket
 %
(
% &
ipAddr
& ,
.
, -
AddressFamily
- :
,
: ;
sType
< A
,
A B
pType
C H
)
H I
{
 
NoDelay
ŸŸ 
=
ŸŸ 
false
ŸŸ 
}
   
;
   
if
¢¢ 
(
¢¢ 
doConnection
¢¢ 
)
¢¢ 
DoConnection
££ 
(
££ 
)
££ 
;
££ 
}
¤¤ 	
public
ÏÏ 
void
ÏÏ 
DoConnection
ÏÏ  
(
ÏÏ  !
)
ÏÏ! "
{
ĞĞ 	
try
ÒÒ 
{
ÓÓ 
ClientSocket
ÔÔ 
.
ÔÔ 
BeginConnect
ÔÔ )
(
ÔÔ) *
IPEnd
ÔÔ* /
,
ÔÔ/ 0
new
ÔÔ1 4
AsyncCallback
ÔÔ5 B
(
ÔÔB C&
ConnectToServerCompleted
ÔÔC [
)
ÔÔ[ \
,
ÔÔ\ ]
new
ÔÔ^ a
SocketGlobals
ÔÔb o
.
ÔÔo p
AsyncSendState
ÔÔp ~
(
ÔÔ~ 
ClientSocketÔÔ ‹
)ÔÔ‹ Œ
)ÔÔŒ 
;ÔÔ 
}
ÕÕ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
ex
ÖÖ 
)
ÖÖ  
{
×× 
myLogger
ØØ 
.
ØØ 
Log
ØØ 
(
ØØ 
$str
ØØ 6
+
ØØ7 8
ex
ØØ9 ;
.
ØØ; <
Message
ØØ< C
)
ØØC D
;
ØØD E
}
ÙÙ 
}
ÚÚ 	
public
ÜÜ 
void
ÜÜ "
DisconnectFromServer
ÜÜ (
(
ÜÜ( )
)
ÜÜ) *
{
İİ 	
ClientSocket
ŞŞ 
.
ŞŞ 

Disconnect
ŞŞ #
(
ŞŞ# $
false
ŞŞ$ )
)
ŞŞ) *
;
ŞŞ* +
}
ßß 	
public
ææ 
void
ææ &
ConnectToServerCompleted
ææ ,
(
ææ, -
IAsyncResult
ææ- 9
ar
ææ: <
)
ææ< =
{
çç 	
SocketGlobals
éé 
.
éé 
AsyncSendState
éé (
mState
éé) /
=
éé0 1
(
éé2 3
SocketGlobals
éé3 @
.
éé@ A
AsyncSendState
ééA O
)
ééO P
ar
ééP R
.
ééR S

AsyncState
ééS ]
;
éé] ^
try
ìì 
{
íí 
mState
ïï 
.
ïï 
Socket
ïï 
.
ïï 

EndConnect
ïï (
(
ïï( )
ar
ïï) +
)
ïï+ ,
;
ïï, -
Send
ôô 
(
ôô 
SocketManager
ôô "
.
ôô" #
ManagedConn
ôô# .
(
ôô. /
)
ôô/ 0
)
ôô0 1
;
ôô1 2
SocketGlobals
÷÷ 
.
÷÷ 
AsyncReceiveState
÷÷ /
mReceiveState
÷÷0 =
=
÷÷> ?
new
÷÷@ C
SocketGlobals
÷÷D Q
.
÷÷Q R
AsyncReceiveState
÷÷R c
(
÷÷c d
)
÷÷d e
;
÷÷e f
mReceiveState
øø 
.
øø 
Socket
øø $
=
øø% &
mState
øø' -
.
øø- .
Socket
øø. 4
;
øø4 5
Console
úú 
.
úú 
	WriteLine
úú !
(
úú! "
$str
úú" m
,
úúm n
ar
úúo q
.
úúq r%
CompletedSynchronouslyúúr ˆ
,úúˆ ‰
arúúŠ Œ
.úúŒ 
IsCompletedúú ˜
)úú˜ ™
;úú™ š
mReceiveState
üü 
.
üü 
Socket
üü $
.
üü$ %
BeginReceive
üü% 1
(
üü1 2
mReceiveState
üü2 ?
.
üü? @
Buffer
üü@ F
,
üüF G
$num
üüH I
,
üüI J
SocketGlobals
üüK X
.
üüX Y
gBufferSize
üüY d
,
üüd e
SocketFlags
üüf q
.
üüq r
None
üür v
,
üüv w
new
üüx {
AsyncCallbacküü| ‰
(üü‰ Š%
ServerMessageReceivedüüŠ Ÿ
)üüŸ  
,üü  ¡
mReceiveStateüü¢ ¯
)üü¯ °
;üü° ±
}
ÿÿ 
catch
€€ 
(
€€ 
	Exception
€€ 
ex
€€ 
)
€€  
{
 
myLogger
ƒƒ 
.
ƒƒ 
Log
ƒƒ 
(
ƒƒ 
$str
ƒƒ .
+
ƒƒ/ 0
ex
ƒƒ1 3
.
ƒƒ3 4
Message
ƒƒ4 ;
)
ƒƒ; <
;
ƒƒ< =
}
„„ 
}
…… 	
public
‡‡ 
void
‡‡ #
ServerMessageReceived
‡‡ )
(
‡‡) *
IAsyncResult
‡‡* 6
ar
‡‡7 9
)
‡‡9 :
{
ˆˆ 	
SocketGlobals
ŠŠ 
.
ŠŠ 
AsyncReceiveState
ŠŠ +
mState
ŠŠ, 2
=
ŠŠ3 4
(
ŠŠ5 6
SocketGlobals
ŠŠ6 C
.
ŠŠC D
AsyncReceiveState
ŠŠD U
)
ŠŠU V
ar
ŠŠV X
.
ŠŠX Y

AsyncState
ŠŠY c
;
ŠŠc d
int
 
numBytesReceived
  
=
! "
$num
# $
;
$ %
numBytesReceived
 
=
 
mState
 %
.
% &
Socket
& ,
.
, -

EndReceive
- 7
(
7 8
ar
8 :
)
: ;
;
; <
if
‘‘ 
(
‘‘ 
mState
‘‘ 
.
‘‘ 
ReceiveSize
‘‘ "
==
‘‘# %
$num
‘‘& '
)
‘‘' (
{
’’ 
mState
”” 
.
”” 
ReceiveSize
”” "
=
””# $
BitConverter
””% 1
.
””1 2
ToInt32
””2 9
(
””9 :
mState
””: @
.
””@ A
Buffer
””A G
,
””G H
$num
””I J
)
””J K
;
””K L
mState
–– 
.
––  
PacketBufferStream
–– )
.
––) *
Write
––* /
(
––/ 0
mState
––0 6
.
––6 7
Buffer
––7 =
,
––= >
$num
––? @
,
––@ A
numBytesReceived
––B R
-
––S T
$num
––U V
)
––V W
;
––W X
}
—— 
else
˜˜ 
{
™™ 
mState
›› 
.
››  
PacketBufferStream
›› )
.
››) *
Write
››* /
(
››/ 0
mState
››0 6
.
››6 7
Buffer
››7 =
,
››= >
$num
››? @
,
››@ A
numBytesReceived
››B R
)
››R S
;
››S T
}
œœ 
mState
ŸŸ 
.
ŸŸ  
TotalBytesReceived
ŸŸ %
+=
ŸŸ& (
numBytesReceived
ŸŸ) 9
;
ŸŸ9 :
if
¢¢ 
(
¢¢ 
mState
¢¢ 
.
¢¢  
TotalBytesReceived
¢¢ )
<
¢¢* +
mState
¢¢, 2
.
¢¢2 3
ReceiveSize
¢¢3 >
)
¢¢> ?
{
££ 
mState
¦¦ 
.
¦¦ 
Socket
¦¦ 
.
¦¦ 
BeginReceive
¦¦ *
(
¦¦* +
mState
¦¦+ 1
.
¦¦1 2
Buffer
¦¦2 8
,
¦¦8 9
$num
¦¦: ;
,
¦¦; <
SocketGlobals
¦¦= J
.
¦¦J K
gBufferSize
¦¦K V
,
¦¦V W
SocketFlags
¦¦X c
.
¦¦c d
None
¦¦d h
,
¦¦h i
new
¦¦j m
AsyncCallback
¦¦n {
(
¦¦{ |$
ServerMessageReceived¦¦| ‘
)¦¦‘ ’
,¦¦’ “
mState¦¦” š
)¦¦š ›
;¦¦› œ
}
§§ 
else
¨¨ 
{
©© 
System
¬¬ 
.
¬¬ 
Runtime
¬¬ 
.
¬¬ 
Serialization
¬¬ ,
.
¬¬, -

Formatters
¬¬- 7
.
¬¬7 8
Binary
¬¬8 >
.
¬¬> ?
BinaryFormatter
¬¬? N
mSerializer
¬¬O Z
=
¬¬[ \
new
¬¬] `
System
¬¬a g
.
¬¬g h
Runtime
¬¬h o
.
¬¬o p
Serialization
¬¬p }
.
¬¬} ~

Formatters¬¬~ ˆ
.¬¬ˆ ‰
Binary¬¬‰ 
.¬¬ 
BinaryFormatter¬¬ Ÿ
(¬¬Ÿ  
)¬¬  ¡
;¬¬¡ ¢
mState
®® 
.
®®  
PacketBufferStream
®® )
.
®®) *
Position
®®* 2
=
®®3 4
$num
®®5 6
;
®®6 7
mState
°° 
.
°° 
Packet
°° 
=
°° 
mSerializer
°°  +
.
°°+ ,
Deserialize
°°, 7
(
°°7 8
mState
°°8 >
.
°°> ? 
PacketBufferStream
°°? Q
)
°°Q R
;
°°R S(
ParseReceivedServerMessage
²² *
(
²²* +
mState
²²+ 1
.
²²1 2
Packet
²²2 8
,
²²8 9
mState
²²: @
.
²²@ A
Socket
²²A G
)
²²G H
;
²²H I
SocketGlobals
´´ 
.
´´ 
AsyncReceiveState
´´ /

mNextState
´´0 :
=
´´; <
new
´´= @
SocketGlobals
´´A N
.
´´N O
AsyncReceiveState
´´O `
(
´´` a
)
´´a b
;
´´b c

mNextState
µµ 
.
µµ 
Socket
µµ !
=
µµ" #
mState
µµ$ *
.
µµ* +
Socket
µµ+ 1
;
µµ1 2
mState
¸¸ 
.
¸¸  
PacketBufferStream
¸¸ )
.
¸¸) *
Close
¸¸* /
(
¸¸/ 0
)
¸¸0 1
;
¸¸1 2
mState
¹¹ 
.
¹¹  
PacketBufferStream
¹¹ )
.
¹¹) *
Dispose
¹¹* 1
(
¹¹1 2
)
¹¹2 3
;
¹¹3 4
mState
ºº 
.
ºº  
PacketBufferStream
ºº )
=
ºº* +
null
ºº, 0
;
ºº0 1
Array
»» 
.
»» 
Clear
»» 
(
»» 
mState
»» "
.
»»" #
Buffer
»»# )
,
»») *
$num
»»+ ,
,
»», -
mState
»». 4
.
»»4 5
Buffer
»»5 ;
.
»»; <
Length
»»< B
)
»»B C
;
»»C D

mNextState
¿¿ 
.
¿¿ 
Socket
¿¿ !
.
¿¿! "
BeginReceive
¿¿" .
(
¿¿. /

mNextState
¿¿/ 9
.
¿¿9 :
Buffer
¿¿: @
,
¿¿@ A
$num
¿¿B C
,
¿¿C D
SocketGlobals
¿¿E R
.
¿¿R S
gBufferSize
¿¿S ^
,
¿¿^ _
SocketFlags
¿¿` k
.
¿¿k l
None
¿¿l p
,
¿¿p q
new
¿¿r u
AsyncCallback¿¿v ƒ
(¿¿ƒ „%
ServerMessageReceived¿¿„ ™
)¿¿™ š
,¿¿š ›

mNextState¿¿œ ¦
)¿¿¦ §
;¿¿§ ¨
mState
ÂÂ 
=
ÂÂ 
null
ÂÂ 
;
ÂÂ 
}
ÃÃ 
}
ÄÄ 	
public
ÆÆ 
void
ÆÆ (
ParseReceivedServerMessage
ÆÆ .
(
ÆÆ. /
object
ÆÆ/ 5
obj
ÆÆ6 9
,
ÆÆ9 :
Socket
ÆÆ; A
	argClient
ÆÆB K
)
ÆÆK L
{
ÇÇ 	
Console
ÈÈ 
.
ÈÈ 
	WriteLine
ÈÈ 
(
ÈÈ 
$str
ÈÈ <
,
ÈÈ< =
obj
ÈÈ> A
.
ÈÈA B
GetType
ÈÈB I
(
ÈÈI J
)
ÈÈJ K
.
ÈÈK L
Name
ÈÈL P
)
ÈÈP Q
;
ÈÈQ R
if
ÊÊ 
(
ÊÊ 
obj
ÊÊ 
is
ÊÊ 
string
ÊÊ 
)
ÊÊ 
myLogger
ËË 
.
ËË 
Log
ËË 
(
ËË 
(
ËË 
string
ËË $
)
ËË$ %
obj
ËË% (
)
ËË( )
;
ËË) *
else
ÌÌ 
if
ÌÌ 
(
ÌÌ 
obj
ÌÌ 
is
ÌÌ 
SocketMessage
ÌÌ )
)
ÌÌ) *
HandleAction
ÍÍ 
(
ÍÍ 
(
ÍÍ 
SocketMessage
ÍÍ +
)
ÍÍ+ ,
obj
ÍÍ, /
,
ÍÍ/ 0
	argClient
ÍÍ1 :
)
ÍÍ: ;
;
ÍÍ; <
}
ÎÎ 	
public
ĞĞ 
void
ĞĞ 
Send
ĞĞ 
(
ĞĞ 
object
ĞĞ 
obj
ĞĞ  #
)
ĞĞ# $
{
ÑÑ 	
System
ÓÓ 
.
ÓÓ 
Runtime
ÓÓ 
.
ÓÓ 
Serialization
ÓÓ (
.
ÓÓ( )

Formatters
ÓÓ) 3
.
ÓÓ3 4
Binary
ÓÓ4 :
.
ÓÓ: ;
BinaryFormatter
ÓÓ; J
mSerializer
ÓÓK V
=
ÓÓW X
new
ÓÓY \
System
ÓÓ] c
.
ÓÓc d
Runtime
ÓÓd k
.
ÓÓk l
Serialization
ÓÓl y
.
ÓÓy z

FormattersÓÓz „
.ÓÓ„ …
BinaryÓÓ… ‹
.ÓÓ‹ Œ
BinaryFormatterÓÓŒ ›
(ÓÓ› œ
)ÓÓœ 
;ÓÓ 
using
ÔÔ 
(
ÔÔ 
System
ÔÔ 
.
ÔÔ 
IO
ÔÔ 
.
ÔÔ 
MemoryStream
ÔÔ )
mSerializerStream
ÔÔ* ;
=
ÔÔ< =
new
ÔÔ> A
System
ÔÔB H
.
ÔÔH I
IO
ÔÔI K
.
ÔÔK L
MemoryStream
ÔÔL X
(
ÔÔX Y
)
ÔÔY Z
)
ÔÔZ [
{
ÕÕ 
mSerializer
ÖÖ 
.
ÖÖ 
	Serialize
ÖÖ %
(
ÖÖ% &
mSerializerStream
ÖÖ& 7
,
ÖÖ7 8
obj
ÖÖ9 <
)
ÖÖ< =
;
ÖÖ= >
byte
ÙÙ 
[
ÙÙ 
]
ÙÙ 
mPacketBytes
ÙÙ #
=
ÙÙ$ %
mSerializerStream
ÙÙ& 7
.
ÙÙ7 8
	GetBuffer
ÙÙ8 A
(
ÙÙA B
)
ÙÙB C
;
ÙÙC D
byte
ÜÜ 
[
ÜÜ 
]
ÜÜ 

mSizeBytes
ÜÜ !
=
ÜÜ" #
BitConverter
ÜÜ$ 0
.
ÜÜ0 1
GetBytes
ÜÜ1 9
(
ÜÜ9 :
mPacketBytes
ÜÜ: F
.
ÜÜF G
Length
ÜÜG M
+
ÜÜN O
$num
ÜÜP Q
)
ÜÜQ R
;
ÜÜR S
SocketGlobals
ßß 
.
ßß 
AsyncSendState
ßß ,
mState
ßß- 3
=
ßß4 5
new
ßß6 9
SocketGlobals
ßß: G
.
ßßG H
AsyncSendState
ßßH V
(
ßßV W
ClientSocket
ßßW c
)
ßßc d
;
ßßd e
Array
ãã 
.
ãã 
Resize
ãã 
(
ãã 
ref
ãã  
mState
ãã! '
.
ãã' (
BytesToSend
ãã( 3
,
ãã3 4
mPacketBytes
ãã5 A
.
ããA B
Length
ããB H
+
ããI J

mSizeBytes
ããK U
.
ããU V
Length
ããV \
)
ãã\ ]
;
ãã] ^
Buffer
ææ 
.
ææ 
	BlockCopy
ææ  
(
ææ  !

mSizeBytes
ææ! +
,
ææ+ ,
$num
ææ- .
,
ææ. /
mState
ææ0 6
.
ææ6 7
BytesToSend
ææ7 B
,
ææB C
$num
ææD E
,
ææE F

mSizeBytes
ææG Q
.
ææQ R
Length
ææR X
)
ææX Y
;
ææY Z
Buffer
çç 
.
çç 
	BlockCopy
çç  
(
çç  !
mPacketBytes
çç! -
,
çç- .
$num
çç/ 0
,
çç0 1
mState
çç2 8
.
çç8 9
BytesToSend
çç9 D
,
ççD E

mSizeBytes
ççF P
.
ççP Q
Length
ççQ W
,
ççW X
mPacketBytes
ççY e
.
ççe f
Length
ççf l
)
ççl m
;
ççm n
Array
éé 
.
éé 
Clear
éé 
(
éé 

mSizeBytes
éé &
,
éé& '
$num
éé( )
,
éé) *

mSizeBytes
éé+ 5
.
éé5 6
Length
éé6 <
)
éé< =
;
éé= >
Array
êê 
.
êê 
Clear
êê 
(
êê 
mPacketBytes
êê (
,
êê( )
$num
êê* +
,
êê+ ,
mPacketBytes
êê- 9
.
êê9 :
Length
êê: @
)
êê@ A
;
êêA B
Console
ìì 
.
ìì 
	WriteLine
ìì !
(
ìì! "
$str
ìì" N
,
ììN O
mState
ììP V
.
ììV W
BytesToSend
ììW b
.
ììb c
Length
ììc i
)
ììi j
;
ììj k
ClientSocket
îî 
.
îî 
	BeginSend
îî &
(
îî& '
mState
îî' -
.
îî- .
BytesToSend
îî. 9
,
îî9 :
mState
îî; A
.
îîA B

NextOffset
îîB L
(
îîL M
)
îîM N
,
îîN O
mState
îîP V
.
îîV W

NextLength
îîW a
(
îîa b
)
îîb c
,
îîc d
SocketFlags
îîe p
.
îîp q
None
îîq u
,
îîu v
new
îîw z
AsyncCallbackîî{ ˆ
(îîˆ ‰
MessagePartSentîî‰ ˜
)îî˜ ™
,îî™ š
mStateîî› ¡
)îî¡ ¢
;îî¢ £
}
ïï 
}
ğğ 	
public
òò 
void
òò !
SendMessageToServer
òò '
(
òò' (
string
òò( .
argCommandString
òò/ ?
)
òò? @
{
óó 	
Send
ôô 
(
ôô 
argCommandString
ôô !
)
ôô! "
;
ôô" #
}
õõ 	
public
÷÷ 
void
÷÷ 
MessagePartSent
÷÷ #
(
÷÷# $
IAsyncResult
÷÷$ 0
ar
÷÷1 3
)
÷÷3 4
{
øø 	
SocketGlobals
úú 
.
úú 
AsyncSendState
úú (
mState
úú) /
=
úú0 1
(
úú2 3
SocketGlobals
úú3 @
.
úú@ A
AsyncSendState
úúA O
)
úúO P
ar
úúP R
.
úúR S

AsyncState
úúS ]
;
úú] ^
try
ûû 
{
üü 
int
ıı 
numBytesSent
ıı  
=
ıı! "
$num
ıı# $
;
ıı$ %
numBytesSent
ÿÿ 
=
ÿÿ 
mState
ÿÿ %
.
ÿÿ% &
Socket
ÿÿ& ,
.
ÿÿ, -
EndSend
ÿÿ- 4
(
ÿÿ4 5
ar
ÿÿ5 7
)
ÿÿ7 8
;
ÿÿ8 9
mState
 
.
 
Progress
 
+=
  "
numBytesSent
# /
;
/ 0
if
ƒƒ 
(
ƒƒ 
mState
ƒƒ 
.
ƒƒ 

NextLength
ƒƒ %
(
ƒƒ% &
)
ƒƒ& '
>
ƒƒ( )
$num
ƒƒ* +
)
ƒƒ+ ,
{
„„ 
mState
†† 
.
†† 
Socket
†† !
.
††! "
	BeginSend
††" +
(
††+ ,
mState
††, 2
.
††2 3
BytesToSend
††3 >
,
††> ?
mState
††@ F
.
††F G

NextOffset
††G Q
(
††Q R
)
††R S
,
††S T
mState
††U [
.
††[ \

NextLength
††\ f
(
††f g
)
††g h
,
††h i
SocketFlags
††j u
.
††u v
None
††v z
,
††z {
new
††| 
AsyncCallback††€ 
(†† 
MessagePartSent†† 
)†† 
,†† Ÿ
mState††  ¦
)††¦ §
;††§ ¨
}
‡‡ 
else
ˆˆ 
{
‰‰ 
Console
ŠŠ 
.
ŠŠ 
	WriteLine
ŠŠ %
(
ŠŠ% &
$str
ŠŠ& o
,
ŠŠo p
ar
ŠŠq s
.
ŠŠs t%
CompletedSynchronouslyŠŠt Š
,ŠŠŠ ‹
arŠŠŒ 
.ŠŠ 
IsCompletedŠŠ š
)ŠŠš ›
;ŠŠ› œ
Array
 
.
 
Clear
 
(
  
mState
  &
.
& '
BytesToSend
' 2
,
2 3
$num
4 5
,
5 6
mState
7 =
.
= >
BytesToSend
> I
.
I J
Length
J P
)
P Q
;
Q R
mState
‘‘ 
=
‘‘ 
null
‘‘ !
;
‘‘! "
}
’’ 
}
–– 
catch
—— 
(
—— 
	Exception
—— 
ex
—— 
)
——  
{
˜˜ 
myLogger
™™ 
.
™™ 
Log
™™ 
(
™™ 
$str
™™ /
+
™™0 1
ex
™™2 4
.
™™4 5
Message
™™5 <
)
™™< =
;
™™= >
}
šš 
}
›› 	
private
¡¡ 
void
¡¡ 
HandleAction
¡¡ !
(
¡¡! "
SocketMessage
¡¡" /
sm
¡¡0 2
,
¡¡2 3
Socket
¡¡4 :
	argClient
¡¡; D
)
¡¡D E
{
¢¢ 	
if
¤¤ 
(
¤¤ 
sm
¤¤ 
.
¤¤ 
msg
¤¤ 
is
¤¤ 
SocketCommand
¤¤ '
)
¤¤' (
{
¥¥ 
SocketCommand
¦¦ 
cmd
¦¦ !
=
¦¦" #
sm
¦¦$ &
.
¦¦& '
TryGetObject
¦¦' 3
<
¦¦3 4
SocketCommand
¦¦4 A
>
¦¦A B
(
¦¦B C
)
¦¦C D
;
¦¦D E
if
§§ 
(
§§ 
cmd
§§ 
!=
§§ 
null
§§ 
)
§§  
{
¨¨ 
switch
©© 
(
©© 
cmd
©© 
.
©©  
Command
©©  '
)
©©' (
{
ªª 
case
«« 
SocketCommands
«« +
.
««+ ,
CreateConnId
««, 8
:
««8 9
myLogger
¬¬ $
.
¬¬$ %
Log
¬¬% (
(
¬¬( )
$str
¬¬) V
,
¬¬V W
sm
¬¬X Z
.
¬¬Z [
id
¬¬[ ]
)
¬¬] ^
;
¬¬^ _
Id
­­ 
=
­­  
sm
­­! #
.
­­# $
id
­­$ &
;
­­& '
Send
¯¯  
(
¯¯  !
SocketManager
¯¯! .
.
¯¯. /
ConfirmConnId
¯¯/ <
(
¯¯< =
Id
¯¯= ?
)
¯¯? @
)
¯¯@ A
;
¯¯A B!
OnConnectedCallback
°° /
?
°°/ 0
.
°°0 1
Invoke
°°1 7
(
°°7 8
)
°°8 9
;
°°9 :
break
±± !
;
±±! "
case
³³ 
SocketCommands
³³ +
.
³³+ ,
CloseInstance
³³, 9
:
³³9 :
myLogger
´´ $
.
´´$ %
Log
´´% (
(
´´( )
$str
´´) J
)
´´J K
;
´´K L
Stop
µµ  
(
µµ  !
false
µµ! &
)
µµ& '
;
µµ' (
break
¶¶ !
;
¶¶! "
default
¸¸ 
:
¸¸  
myLogger
¹¹ $
.
¹¹$ %
Log
¹¹% (
(
¹¹( )
$str
¹¹) W
,
¹¹W X
cmd
¹¹Y \
)
¹¹\ ]
;
¹¹] ^
break
ºº !
;
ºº! "
}
»» 
}
¼¼ 
else
½½ 
{
¾¾ 
myLogger
¿¿ 
.
¿¿ 
Log
¿¿  
(
¿¿  !
$str
¿¿! C
)
¿¿C D
;
¿¿D E
}
ÀÀ 
}
ÁÁ 
else
ÂÂ +
ReceivedServerMessageCallback
ÃÃ -
?
ÃÃ- .
.
ÃÃ. /
Invoke
ÃÃ/ 5
(
ÃÃ5 6
sm
ÃÃ6 8
.
ÃÃ8 9
msg
ÃÃ9 <
,
ÃÃ< =
	argClient
ÃÃ> G
)
ÃÃG H
;
ÃÃH I
}
ÄÄ 	
private
ÈÈ 
void
ÈÈ 
CloseConnection
ÈÈ $
(
ÈÈ$ %
SocketShutdown
ÈÈ% 3

soShutdown
ÈÈ4 >
)
ÈÈ> ?
{
ÉÉ 	
if
ÊÊ 
(
ÊÊ 

soShutdown
ÊÊ 
==
ÊÊ 
SocketShutdown
ÊÊ ,
.
ÊÊ, -
Receive
ÊÊ- 4
)
ÊÊ4 5
{
ËË 
myLogger
ÌÌ 
.
ÌÌ 
Log
ÌÌ 
(
ÌÌ 
$str
ÌÌ 
)ÌÌ €
;ÌÌ€ 
return
ÍÍ 
;
ÍÍ 
}
ÎÎ 
if
ÏÏ 
(
ÏÏ 
ClientSocket
ÏÏ 
.
ÏÏ 
	Connected
ÏÏ &
)
ÏÏ& '
{
ĞĞ 
ClientSocket
ÑÑ 
.
ÑÑ 

Disconnect
ÑÑ '
(
ÑÑ' (
false
ÑÑ( -
)
ÑÑ- .
;
ÑÑ. /
if
ÒÒ 
(
ÒÒ 
ClientSocket
ÒÒ  
.
ÒÒ  !
	Connected
ÒÒ! *
)
ÒÒ* +
ClientSocket
ÓÓ  
.
ÓÓ  !
Shutdown
ÓÓ! )
(
ÓÓ) *

soShutdown
ÓÓ* 4
)
ÓÓ4 5
;
ÓÓ5 6
}
ÔÔ 
}
ÕÕ 	
private
×× 
bool
×× 
disposed
×× 
;
×× 
public
ÚÚ 
void
ÚÚ 
Dispose
ÚÚ 
(
ÚÚ 
)
ÚÚ 
{
ÛÛ 	
Dispose
ÜÜ 
(
ÜÜ 
true
ÜÜ 
)
ÜÜ 
;
ÜÜ 
GC
İİ 
.
İİ 
SuppressFinalize
İİ 
(
İİ  
this
İİ  $
)
İİ$ %
;
İİ% &
}
ŞŞ 	
	protected
áá 
virtual
áá 
void
áá 
Dispose
áá &
(
áá& '
bool
áá' +
	disposing
áá, 5
)
áá5 6
{
ââ 	
if
ãã 
(
ãã 
disposed
ãã 
)
ãã 
return
ää 
;
ää 
if
ææ 
(
ææ 
	disposing
ææ 
)
ææ 
{
çç 
Send
èè 
(
èè 
SocketManager
èè "
.
èè" #
ClientClosed
èè# /
(
èè/ 0
Id
èè0 2
)
èè2 3
)
èè3 4
;
èè4 5
}
ëë 
disposed
ïï 
=
ïï 
true
ïï 
;
ïï 
}
ğğ 	
public
õõ 
void
õõ 
Stop
õõ 
(
õõ 
bool
õõ 
dis
õõ !
)
õõ! "
{
öö 	
if
÷÷ 
(
÷÷ 
_state
÷÷ 
==
÷÷ 
SocketState
÷÷ %
.
÷÷% &
ClientStarted
÷÷& 3
)
÷÷3 4
{
øø 
try
ùù 
{
úú 
myLogger
ûû 
.
ûû 
Log
ûû  
(
ûû  !
$str
ûû! 8
,
ûû8 9
Id
ûû: <
)
ûû< =
;
ûû= >
_state
ıı 
=
ıı 
SocketState
ıı (
.
ıı( )
ClientStopped
ıı) 6
;
ıı6 7
CloseConnection
şş #
(
şş# $
SocketShutdown
şş$ 2
.
şş2 3
Both
şş3 7
)
şş7 8
;
şş8 9
if
€€ 
(
€€ 
dis
€€ 
)
€€ 
{
 
ClientSocket
‚‚ $
.
‚‚$ %
Close
‚‚% *
(
‚‚* +
)
‚‚+ ,
;
‚‚, -
}
„„ 
else
…… 
Send
…… 
(
…… 
SocketManager
…… +
.
……+ ,
ClientClosed
……, 8
(
……8 9
Id
……9 ;
)
……; <
)
……< =
;
……= >
}
†† 
catch
‡‡ 
(
‡‡ 
	Exception
‡‡  
ex
‡‡! #
)
‡‡# $
{
ˆˆ 
myLogger
‰‰ 
.
‰‰ 
Log
‰‰  
(
‰‰  !
$str
‰‰! R
+
‰‰S T
ex
‰‰U W
)
‰‰W X
;
‰‰X Y
}
ŠŠ 
}
‹‹ 
else
ŒŒ 
myLogger
 
.
 
Log
 
(
 
$str
 W
)
W X
;
X Y
}
 	
}
““ 
}”” 	
ID:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\SocketCommand.cs
	namespace 	
SanAndreasAPI
 
{ 
[ 
Serializable 
] 
public 

class 
SocketCommand 
{ 
public 
SocketCommands 
Command %
;% &
public		 
SocketCommandData		  
Metadata		! )
;		) *
private 
SocketCommand 
( 
) 
{ 	
}
 
public 
SocketCommand 
( 
SocketCommands +
cmd, /
)/ 0
{ 	
Command 
= 
cmd 
; 
} 	
public 
SocketCommand 
( 
SocketCommands +
cmd, /
,/ 0
SocketCommandData1 B
metC F
)F G
{ 	
Command 
= 
cmd 
; 
Metadata 
= 
met 
; 
} 	
} 
} »9
MD:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\SocketCommandData.cs
	namespace 	
SanAndreasAPI
 
{ 
[ 
Serializable 
] 
public		 

class		 
SocketCommandData		 "
:		# $
IDictionary		% 0
<		0 1
string		1 7
,		7 8
object		9 ?
>		? @
{

 
private 

Dictionary 
< 
string !
,! "
object# )
>) *
_dict+ 0
=1 2
new3 6

Dictionary7 A
<A B
stringB H
,H I
objectJ P
>P Q
(Q R
)R S
;S T
public 
object 
	otherData 
;  
public 
object 
this 
[ 
string !
key" %
]% &
{ 	
get 
{ 
if 
( 
_dict 
. 
ContainsKey %
(% &
key& )
)) *
)* +
return 
_dict  
[  !
key! $
]$ %
;% &
return 
null 
; 
} 
set 
{ 
if 
( 
! 
_dict 
. 
ContainsKey &
(& '
key' *
)* +
)+ ,
_dict 
. 
Add 
( 
key !
,! "
value# (
)( )
;) *
else 
_dict 
[ 
key 
] 
=  
value! &
;& '
} 
} 	
private   
SocketCommandData   !
(  ! "
)  " #
{!! 	
}!!
 
public## 
SocketCommandData##  
(##  !

Dictionary##! +
<##+ ,
string##, 2
,##2 3
object##4 :
>##: ;
values##< B
)##B C
{$$ 	
_dict%% 
=%% 
values%% 
;%% 
}&& 	
public(( 
SocketCommandData((  
(((  !
object((! '
obj((( +
,((+ ,

Dictionary((- 7
<((7 8
string((8 >
,((> ?
object((@ F
>((F G
values((H N
)((N O
{)) 	
	otherData** 
=** 
obj** 
;** 
_dict++ 
=++ 
values++ 
;++ 
},, 	
public.. 
ICollection.. 
<.. 
string.. !
>..! "
Keys..# '
=>..( *
_dict..+ 0
...0 1
Keys..1 5
;..5 6
public00 
ICollection00 
<00 
object00 !
>00! "
Values00# )
=>00* ,
throw00- 2
new003 6#
NotImplementedException007 N
(00N O
)00O P
;00P Q
public22 
int22 
Count22 
=>22 
throw22 !
new22" %#
NotImplementedException22& =
(22= >
)22> ?
;22? @
public44 
bool44 

IsReadOnly44 
=>44 !
throw44" '
new44( +#
NotImplementedException44, C
(44C D
)44D E
;44E F
public66 
void66 
Add66 
(66 
string66 
key66 "
,66" #
object66$ *
value66+ 0
)660 1
{77 	
_dict88 
.88 
Add88 
(88 
key88 
,88 
value88  
)88  !
;88! "
}99 	
public;; 
void;; 
Add;; 
(;; 
KeyValuePair;; $
<;;$ %
string;;% +
,;;+ ,
object;;- 3
>;;3 4
item;;5 9
);;9 :
{<< 	
_dict>> 
.>> 
Add>> 
(>> 
item>> 
)>> 
;>> 
}?? 	
publicAA 
voidAA 
ClearAA 
(AA 
)AA 
{BB 	
_dictCC 
.CC 
ClearCC 
(CC 
)CC 
;CC 
}DD 	
publicFF 
boolFF 
ContainsFF 
(FF 
KeyValuePairFF )
<FF) *
stringFF* 0
,FF0 1
objectFF2 8
>FF8 9
itemFF: >
)FF> ?
{GG 	
returnHH 
_dictHH 
.HH 
ContainsHH !
(HH! "
itemHH" &
)HH& '
;HH' (
}II 	
publicKK 
boolKK 
ContainsKeyKK 
(KK  
stringKK  &
keyKK' *
)KK* +
{LL 	
returnMM 
_dictMM 
.MM 
ContainsKeyMM $
(MM$ %
keyMM% (
)MM( )
;MM) *
}NN 	
publicPP 
voidPP 
CopyToPP 
(PP 
KeyValuePairPP '
<PP' (
stringPP( .
,PP. /
objectPP0 6
>PP6 7
[PP7 8
]PP8 9
arrayPP: ?
,PP? @
intPPA D

arrayIndexPPE O
)PPO P
{QQ 	
throwRR 
newRR #
NotImplementedExceptionRR -
(RR- .
)RR. /
;RR/ 0
}SS 	
publicUU 
IEnumeratorUU 
<UU 
KeyValuePairUU '
<UU' (
stringUU( .
,UU. /
objectUU0 6
>UU6 7
>UU7 8
GetEnumeratorUU9 F
(UUF G
)UUG H
{VV 	
returnWW 
_dictWW 
.WW 
GetEnumeratorWW &
(WW& '
)WW' (
;WW( )
}XX 	
publicZZ 
boolZZ 
RemoveZZ 
(ZZ 
stringZZ !
keyZZ" %
)ZZ% &
{[[ 	
return\\ 
_dict\\ 
.\\ 
Remove\\ 
(\\  
key\\  #
)\\# $
;\\$ %
}]] 	
public__ 
bool__ 
Remove__ 
(__ 
KeyValuePair__ '
<__' (
string__( .
,__. /
object__0 6
>__6 7
item__8 <
)__< =
{`` 	
throwaa 
newaa #
NotImplementedExceptionaa -
(aa- .
)aa. /
;aa/ 0
}bb 	
publicdd 
booldd 
TryGetValuedd 
(dd  
stringdd  &
keydd' *
,dd* +
outdd, /
objectdd0 6
valuedd7 <
)dd< =
{ee 	
returnff 
_dictff 
.ff 
TryGetValueff $
(ff$ %
keyff% (
,ff( )
outff* -
valueff. 3
)ff3 4
;ff4 5
}gg 	
IEnumeratorii 
IEnumerableii 
.ii  
GetEnumeratorii  -
(ii- .
)ii. /
{jj 	
returnkk 
_dictkk 
.kk 
GetEnumeratorkk &
(kk& '
)kk' (
;kk( )
}ll 	
}mm 
}nn é
LD:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\SocketExtensions.cs
	namespace

 	
SanAndreasAPI


 
{ 
public 

class 
MinMax 
< 
T 
> 
{ 
public 
T 
min 
, 
max 
; 
private 
MinMax 
( 
) 
{ 	
} 	
public 
MinMax 
( 
T 
mn 
, 
T 
mx  
)  !
{ 	
min 
= 
mn 
; 
max 
= 
mx 
; 
} 	
} 
public 

static 
class 
ArrayExtensions '
{ 
public 
static 
IEnumerable !
<! "
T" #
># $
JoinMultipleArray% 6
<6 7
T7 8
>8 9
(9 :
this: >
IEnumerable? J
<J K
TK L
[L M
]M N
>N O
arrayP U
)U V
{ 	
foreach 
( 
var 
el 
in 
array $
)$ %
for   
(   
int   
i   
=   
$num   
;   
i    !
<  " #
el  $ &
.  & '
Length  ' -
;  - .
++  / 1
i  1 2
)  2 3
yield!! 
return!!  
el!!! #
[!!# $
i!!$ %
]!!% &
;!!& '
}"" 	
}## 
public%% 

enum%% 
ImageFormats%% 
{&& 
JPG'' 
,'' 
PNG(( 
,(( 
BMP)) 
,)) 
TIFF** 
,** 
GIF++ 
,++ 
ICO,, 
}-- 
publicXX 

staticXX 
classXX 
SocketExtensionsXX (
{YY 
publicZZ 
staticZZ 
	IPAddressZZ 
GetLocalIPAddressZZ  1
(ZZ1 2
)ZZ2 3
{[[ 	
IPHostEntry\\ 
host\\ 
=\\ 
Dns\\ "
.\\" #
GetHostEntry\\# /
(\\/ 0
Dns\\0 3
.\\3 4
GetHostName\\4 ?
(\\? @
)\\@ A
)\\A B
;\\B C
foreach]] 
(]] 
var]] 
ip]] 
in]] 
host]] #
.]]# $
AddressList]]$ /
)]]/ 0
if^^ 
(^^ 
ip^^ 
.^^ 
AddressFamily^^ $
==^^% '
AddressFamily^^( 5
.^^5 6
InterNetwork^^6 B
)^^B C
return__ 
ip__ 
;__ 
throw`` 
new`` 
	Exception`` 
(``  
$str``  Y
)``Y Z
;``Z [
}aa 	
publiccc 
staticcc 
intcc 
GetObjectSizecc '
(cc' (
thiscc( ,
objectcc- 3

TestObjectcc4 >
)cc> ?
{dd 	
BinaryFormatteree 
bfee 
=ee  
newee! $
BinaryFormatteree% 4
(ee4 5
)ee5 6
;ee6 7
usingff 
(ff 
MemoryStreamff 
msff  "
=ff# $
newff% (
MemoryStreamff) 5
(ff5 6
)ff6 7
)ff7 8
{gg 
bytehh 
[hh 
]hh 
Arrayhh 
;hh 
bfii 
.ii 
	Serializeii 
(ii 
msii 
,ii  

TestObjectii! +
)ii+ ,
;ii, -
Arrayjj 
=jj 
msjj 
.jj 
ToArrayjj "
(jj" #
)jj# $
;jj$ %
returnkk 
Arraykk 
.kk 
Lengthkk #
;kk# $
}ll 
}mm 	
publicoo 
staticoo 
booloo 3
'FindFirstMissingNumberFromSequenceUlongoo B
(ooB C
thisooC G
IEnumerableooH S
<ooS T
ulongooT Y
>ooY Z
arroo[ ^
,oo^ _
outoo` c
ulongood i
nooj k
,ook l
MinMaxoom s
<oos t
ulongoot y
>ooy z
mnmxoo{ 
=
oo€ 
null
oo‚ †
)
oo† ‡
{pp 	
ifss 
(ss 
mnmxss 
!=ss 
nullss 
)ss 
{tt 
arruu 
.uu 
Adduu 
(uu 
mnmxuu 
.uu 
minuu  
)uu  !
;uu! "
arrvv 
.vv 
Addvv 
(vv 
mnmxvv 
.vv 
maxvv  
)vv  !
;vv! "
}ww 
IOrderedEnumerableyy 
<yy 
ulongyy $
>yy$ %
listyy& *
=yy+ ,
arryy- 0
.yy0 1
OrderByyy1 8
(yy8 9
xyy9 :
=>yy; =
xyy> ?
)yy? @
;yy@ A
bool}} 
b}} 
=}} 
false}} 
;}} 
n~~ 
=~~ 
$num~~ 
;~~ 
foreach
€€ 
(
€€ 
ulong
€€ 
num
€€ 
in
€€ !
list
€€" &
)
€€& '
{
 
b
‚‚ 
=
‚‚ 
num
‚‚ 
-
‚‚ 
n
‚‚ 
>
‚‚ 
$num
‚‚ 
;
‚‚  
if
ƒƒ 
(
ƒƒ 
b
ƒƒ 
)
ƒƒ 
break
„„ 
;
„„ 
else
…… 
n
†† 
=
†† 
num
†† 
;
†† 
}
‡‡ 
n
‰‰ 
+=
‰‰ 
$num
‰‰ 
;
‰‰ 
return
‹‹ 
b
‹‹ 
;
‹‹ 
}
ŒŒ 	
public
 
static
 
bool
 0
"FindFirstMissingNumberFromSequence
 =
<
= >
T
> ?
>
? @
(
@ A
this
A E
IEnumerable
F Q
<
Q R
T
R S
>
S T
arr
U X
,
X Y
out
Z ]
T
^ _
n
` a
,
a b
MinMax
c i
<
i j
T
j k
>
k l
mnmx
m q
=
r s
null
t x
)
x y
{
 	
if
’’ 
(
’’ 
!
’’ 
arr
’’ 
.
’’ 
GetItemType
’’  
(
’’  !
)
’’! "
.
’’" #
IsNumericType
’’# 0
(
’’0 1
)
’’1 2
)
’’2 3
{
““ 
Console
”” 
.
”” 
	WriteLine
”” !
(
””! "
$str
””" O
,
””O P
typeof
””Q W
(
””W X
T
””X Y
)
””Y Z
.
””Z [
Name
””[ _
)
””_ `
;
””` a
n
•• 
=
•• 
default
•• 
(
•• 
T
•• 
)
•• 
;
•• 
return
–– 
false
–– 
;
–– 
}
—— 
if
™™ 
(
™™ 
mnmx
™™ 
!=
™™ 
null
™™ 
)
™™ 
{
šš 
arr
›› 
.
›› 
Add
›› 
(
›› 
mnmx
›› 
.
›› 
min
››  
)
››  !
;
››! "
arr
œœ 
.
œœ 
Add
œœ 
(
œœ 
mnmx
œœ 
.
œœ 
max
œœ  
)
œœ  !
;
œœ! "
}
  
IOrderedEnumerable
ŸŸ 
<
ŸŸ 
T
ŸŸ  
>
ŸŸ  !
list
ŸŸ" &
=
ŸŸ' (
arr
ŸŸ) ,
.
ŸŸ, -
OrderBy
ŸŸ- 4
(
ŸŸ4 5
x
ŸŸ5 6
=>
ŸŸ7 9
x
ŸŸ: ;
)
ŸŸ; <
;
ŸŸ< =
bool
££ 
b
££ 
=
££ 
false
££ 
;
££ 
object
¤¤ 
n1
¤¤ 
=
¤¤ 
null
¤¤ 
;
¤¤ 
foreach
¦¦ 
(
¦¦ 
object
¦¦ 
num
¦¦ 
in
¦¦  "
list
¦¦# '
)
¦¦' (
{
§§ 
b
¨¨ 
=
¨¨ 
ExpressionMath
¨¨ "
<
¨¨" #
object
¨¨# )
>
¨¨) *
.
¨¨* +
Default
¨¨+ 2
.
¨¨2 3
GreaterThan
¨¨3 >
(
¨¨> ?
ExpressionMath
¨¨? M
<
¨¨M N
object
¨¨N T
>
¨¨T U
.
¨¨U V
Default
¨¨V ]
.
¨¨] ^
Subtract
¨¨^ f
(
¨¨f g
num
¨¨g j
,
¨¨j k
n1
¨¨l n
==
¨¨o q
null
¨¨r v
?
¨¨w x
$num
¨¨y z
:
¨¨{ |
n1
¨¨} 
)¨¨ €
,¨¨€ 
$num¨¨‚ ƒ
)¨¨ƒ „
;¨¨„ …
if
©© 
(
©© 
b
©© 
)
©© 
break
ªª 
;
ªª 
else
«« 
n1
¬¬ 
=
¬¬ 
(
¬¬ 
T
¬¬ 
)
¬¬ 
num
¬¬ 
;
¬¬  
}
­­ 
n1
¯¯ 
=
¯¯ 
(
¯¯ 
T
¯¯ 
)
¯¯ 
ExpressionMath
¯¯ "
<
¯¯" #
object
¯¯# )
>
¯¯) *
.
¯¯* +
Default
¯¯+ 2
.
¯¯2 3
Add
¯¯3 6
(
¯¯6 7
n1
¯¯7 9
,
¯¯9 :
$num
¯¯; <
)
¯¯< =
;
¯¯= >
n
°° 
=
°° 
(
°° 
T
°° 
)
°° 
n1
°° 
;
°° 
return
²² 
b
²² 
;
²² 
}
³³ 	
public
µµ 
static
µµ 
IEnumerable
µµ !
<
µµ! "
T
µµ" #
>
µµ# $,
FindMissingNumbersFromSequence
µµ% C
<
µµC D
T
µµD E
>
µµE F
(
µµF G
IEnumerable
µµG R
<
µµR S
T
µµS T
>
µµT U
arr
µµV Y
,
µµY Z
MinMax
µµ[ a
<
µµa b
T
µµb c
>
µµc d
mnmx
µµe i
=
µµj k
null
µµl p
)
µµp q
where
µµr w
T
µµx y
:
µµz {
structµµ| ‚
{
¶¶ 	
if
·· 
(
·· 
!
·· 
arr
·· 
.
·· 
GetItemType
··  
(
··  !
)
··! "
.
··" #
IsNumericType
··# 0
(
··0 1
)
··1 2
)
··2 3
{
¸¸ 
Console
¹¹ 
.
¹¹ 
	WriteLine
¹¹ !
(
¹¹! "
$str
¹¹" O
,
¹¹O P
typeof
¹¹Q W
(
¹¹W X
T
¹¹X Y
)
¹¹Y Z
.
¹¹Z [
Name
¹¹[ _
)
¹¹_ `
;
¹¹` a
yield
ºº 
break
ºº 
;
ºº 
}
»» 
if
½½ 
(
½½ 
mnmx
½½ 
!=
½½ 
null
½½ 
)
½½ 
{
¾¾ 
arr
¿¿ 
.
¿¿ 
Add
¿¿ 
(
¿¿ 
mnmx
¿¿ 
.
¿¿ 
min
¿¿  
)
¿¿  !
;
¿¿! "
arr
ÀÀ 
.
ÀÀ 
Add
ÀÀ 
(
ÀÀ 
mnmx
ÀÀ 
.
ÀÀ 
max
ÀÀ  
)
ÀÀ  !
;
ÀÀ! "
}
ÁÁ  
IOrderedEnumerable
ÃÃ 
<
ÃÃ 
T
ÃÃ  
>
ÃÃ  !
list
ÃÃ" &
=
ÃÃ' (
arr
ÃÃ) ,
.
ÃÃ, -
OrderBy
ÃÃ- 4
(
ÃÃ4 5
x
ÃÃ5 6
=>
ÃÃ7 9
x
ÃÃ: ;
)
ÃÃ; <
;
ÃÃ< =
T
ÄÄ 
n
ÄÄ 
=
ÄÄ 
default
ÄÄ 
(
ÄÄ 
T
ÄÄ 
)
ÄÄ 
;
ÄÄ 
foreach
ÆÆ 
(
ÆÆ 
object
ÆÆ 
num
ÆÆ 
in
ÆÆ  "
list
ÆÆ# '
)
ÆÆ' (
{
ÇÇ 
T
ÈÈ 
op
ÈÈ 
=
ÈÈ 
(
ÈÈ 
T
ÈÈ 
)
ÈÈ 
ExpressionMath
ÈÈ (
<
ÈÈ( )
object
ÈÈ) /
>
ÈÈ/ 0
.
ÈÈ0 1
Default
ÈÈ1 8
.
ÈÈ8 9
Subtract
ÈÈ9 A
(
ÈÈA B
num
ÈÈB E
,
ÈÈE F
n
ÈÈG H
)
ÈÈH I
;
ÈÈI J
if
ÉÉ 
(
ÉÉ 
ExpressionMath
ÉÉ "
<
ÉÉ" #
T
ÉÉ# $
>
ÉÉ$ %
.
ÉÉ% &
Default
ÉÉ& -
.
ÉÉ- .
GreaterThan
ÉÉ. 9
(
ÉÉ9 :
op
ÉÉ: <
,
ÉÉ< =
$num
ÉÉ> ?
.
ÉÉ? @
ConvertGeneric
ÉÉ@ N
<
ÉÉN O
T
ÉÉO P
>
ÉÉP Q
(
ÉÉQ R
)
ÉÉR S
)
ÉÉS T
)
ÉÉT U
{
ÊÊ 
int
ËË 
max
ËË 
=
ËË 
op
ËË  
.
ËË  !
ConvertValue
ËË! -
<
ËË- .
int
ËË. 1
>
ËË1 2
(
ËË2 3
)
ËË3 4
;
ËË4 5
for
ÌÌ 
(
ÌÌ 
int
ÌÌ 
l
ÌÌ 
=
ÌÌ  
$num
ÌÌ! "
;
ÌÌ" #
l
ÌÌ$ %
<
ÌÌ& '
max
ÌÌ( +
;
ÌÌ+ ,
++
ÌÌ- /
l
ÌÌ/ 0
)
ÌÌ0 1
yield
ÍÍ 
return
ÍÍ $
ExpressionMath
ÍÍ% 3
<
ÍÍ3 4
T
ÍÍ4 5
>
ÍÍ5 6
.
ÍÍ6 7
Default
ÍÍ7 >
.
ÍÍ> ?
Add
ÍÍ? B
(
ÍÍB C
n
ÍÍC D
,
ÍÍD E
l
ÍÍF G
.
ÍÍG H
ConvertValue
ÍÍH T
<
ÍÍT U
T
ÍÍU V
>
ÍÍV W
(
ÍÍW X
)
ÍÍX Y
)
ÍÍY Z
;
ÍÍZ [
}
ÎÎ 
n
ÏÏ 
=
ÏÏ 
(
ÏÏ 
T
ÏÏ 
)
ÏÏ 
num
ÏÏ 
;
ÏÏ 
}
ĞĞ 
}
ÑÑ 	
public
ÓÓ 
static
ÓÓ 
Type
ÓÓ 
GetItemType
ÓÓ &
<
ÓÓ& '
T
ÓÓ' (
>
ÓÓ( )
(
ÓÓ) *
this
ÓÓ* .
IEnumerable
ÓÓ/ :
<
ÓÓ: ;
T
ÓÓ; <
>
ÓÓ< =

enumerable
ÓÓ> H
)
ÓÓH I
{
ÔÔ 	
return
ÕÕ 
typeof
ÕÕ 
(
ÕÕ 
T
ÕÕ 
)
ÕÕ 
;
ÕÕ 
}
ÖÖ 	
public
ØØ 
static
ØØ 
T
ØØ 
ConvertGeneric
ØØ &
<
ØØ& '
T
ØØ' (
>
ØØ( )
(
ØØ) *
this
ØØ* .
object
ØØ/ 5
o
ØØ6 7
)
ØØ7 8
{
ÙÙ 	
return
ÚÚ 
(
ÚÚ 
T
ÚÚ 
)
ÚÚ 
o
ÚÚ 
;
ÚÚ 
}
ÛÛ 	
public
ŞŞ 
static
ŞŞ 
T
ŞŞ 
ConvertValue
ŞŞ $
<
ŞŞ$ %
T
ŞŞ% &
>
ŞŞ& '
(
ŞŞ' (
this
ŞŞ( ,
object
ŞŞ- 3
o
ŞŞ4 5
)
ŞŞ5 6
where
ŞŞ7 <
T
ŞŞ= >
:
ŞŞ? @
struct
ŞŞA G
{
ßß 	
return
àà 
(
àà 
T
àà 
)
àà 
Convert
àà 
.
àà 

ChangeType
àà (
(
àà( )
o
àà) *
,
àà* +
typeof
àà, 2
(
àà2 3
T
àà3 4
)
àà4 5
)
àà5 6
;
àà6 7
}
áá 	
public
ãã 
static
ãã 
bool
ãã 
IsNumericType
ãã (
<
ãã( )
T
ãã) *
>
ãã* +
(
ãã+ ,
this
ãã, 0
T
ãã1 2
o
ãã3 4
)
ãã4 5
{
ää 	
return
åå 
typeof
åå 
(
åå 
T
åå 
)
åå 
.
åå 
IsNumericType
åå *
(
åå* +
)
åå+ ,
;
åå, -
}
ææ 	
public
èè 
static
èè 
bool
èè 
IsNumericType
èè (
(
èè( )
this
èè) -
Type
èè. 2
type
èè3 7
)
èè7 8
{
éé 	
switch
êê 
(
êê 
Type
êê 
.
êê 
GetTypeCode
êê $
(
êê$ %
type
êê% )
)
êê) *
)
êê* +
{
ëë 
case
ìì 
TypeCode
ìì 
.
ìì 
Byte
ìì "
:
ìì" #
case
íí 
TypeCode
íí 
.
íí 
SByte
íí #
:
íí# $
case
îî 
TypeCode
îî 
.
îî 
UInt16
îî $
:
îî$ %
case
ïï 
TypeCode
ïï 
.
ïï 
UInt32
ïï $
:
ïï$ %
case
ğğ 
TypeCode
ğğ 
.
ğğ 
UInt64
ğğ $
:
ğğ$ %
case
ññ 
TypeCode
ññ 
.
ññ 
Int16
ññ #
:
ññ# $
case
òò 
TypeCode
òò 
.
òò 
Int32
òò #
:
òò# $
case
óó 
TypeCode
óó 
.
óó 
Int64
óó #
:
óó# $
case
ôô 
TypeCode
ôô 
.
ôô 
Decimal
ôô %
:
ôô% &
case
õõ 
TypeCode
õõ 
.
õõ 
Double
õõ $
:
õõ$ %
case
öö 
TypeCode
öö 
.
öö 
Single
öö $
:
öö$ %
return
÷÷ 
true
÷÷ 
;
÷÷  
default
ùù 
:
ùù 
return
úú 
false
úú  
;
úú  !
}
ûû 
}
üü 	
public
şş 
static
şş 
IEnumerable
şş !
<
şş! "
T
şş" #
>
şş# $
Add
şş% (
<
şş( )
T
şş) *
>
şş* +
(
şş+ ,
this
şş, 0
IEnumerable
şş1 <
<
şş< =
T
şş= >
>
şş> ?
e
şş@ A
,
şşA B
T
şşC D
value
şşE J
)
şşJ K
{
ÿÿ 	
foreach
€€ 
(
€€ 
var
€€ 
cur
€€ 
in
€€ 
e
€€  !
)
€€! "
{
 
yield
‚‚ 
return
‚‚ 
cur
‚‚  
;
‚‚  !
}
ƒƒ 
yield
„„ 
return
„„ 
value
„„ 
;
„„ 
}
…… 	
}
†† 
}‡‡ Ây
ID:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\SocketGlobals.cs
	namespace 	
SanAndreasAPI
 
{ 
public 

enum 
SocketDbgType 
{ 
Client 
, 
Server		 
}

 
public 

enum 
SocketState 
{ 

NonStarted 
, 
ClientStarted 
, 
ServerStarted 
, 
ClientStopped 
, 
ServerStopped 
} 
public 

enum 
SocketCommands 
{ 
Conn 
, 
ConfirmConnId 
, 
CloseClients 
, 
ClosedClient 
, 
Stop 
, 
UnpoliteStop 
, 
CustomCommand 
, 
CreateConnId"" 
,"" 
CloseInstance$$ 
}%% 
public'' 

static'' 
class'' 
SocketGlobals'' %
{(( 
public)) 
const)) 
int)) 
gBufferSize)) $
=))% &
$num))' +
;))+ ,
public++ 
class++ 
AsyncReceiveState++ &
:++' (
IDisposable++) 4
{,, 	
public-- 
System-- 
.-- 
Net-- 
.-- 
Sockets-- %
.--% &
Socket--& ,
Socket--- 3
;--3 4
public.. 
byte.. 
[.. 
].. 
Buffer..  
=..! "
new..# &
byte..' +
[..+ ,
gBufferSize.., 7
]..7 8
;..8 9
internal00 
MemoryStream00 !
_packetBuff00" -
;00- .
public33 
MemoryStream33 
PacketBufferStream33  2
{44 
get55 
{66 
if77 
(77 
_packetBuff77 #
==77$ &
null77' +
)77+ ,
{88 
Console99 
.99  
	WriteLine99  )
(99) *
$str99* G
)99G H
;99H I
_packetBuff:: #
=::$ %
new::& )
MemoryStream::* 6
(::6 7
)::7 8
;::8 9
};; 
return<< 
_packetBuff<< &
;<<& '
}== 
set>> 
{?? 
_packetBuff@@ 
=@@  !
value@@" '
;@@' (
}AA 
}BB 
publicDD 
objectDD 
PacketDD  
;DD  !
publicGG 
intGG 
ReceiveSizeGG "
;GG" #
publicJJ 
intJJ 
TotalBytesReceivedJJ )
;JJ) *
publicMM 
voidMM 
DisposeMM 
(MM  
)MM  !
{NN 
DisposeOO 
(OO 
trueOO 
)OO 
;OO 
GCPP 
.PP 
SuppressFinalizePP #
(PP# $
thisPP$ (
)PP( )
;PP) *
}QQ 
privateSS 
boolSS 
disposedSS !
;SS! "
	protectedVV 
virtualVV 
voidVV "
DisposeVV# *
(VV* +
boolVV+ /
	disposingVV0 9
)VV9 :
{WW 
ifXX 
(XX 
disposedXX 
)XX 
returnYY 
;YY 
if[[ 
([[ 
	disposing[[ 
)[[ 
{\\ 
_packetBuff^^ 
.^^  
Dispose^^  '
(^^' (
)^^( )
;^^) *
Array__ 
.__ 
Clear__ 
(__  
Buffer__  &
,__& '
$num__( )
,__) *
Buffer__+ 1
.__1 2
Length__2 8
)__8 9
;__9 :
}bb 
disposedff 
=ff 
trueff 
;ff  
}gg 
}hh 	
publicjj 
classjj 
AsyncSendStatejj #
:jj$ %
IDisposablejj& 1
{kk 	
publicll 
Systemll 
.ll 
Netll 
.ll 
Socketsll %
.ll% &
Socketll& ,
Socketll- 3
;ll3 4
publicoo 
byteoo 
[oo 
]oo 
BytesToSendoo %
;oo% &
publicqq 
intqq 
Progressqq 
;qq  
publicss 
AsyncSendStatess !
(ss! "
Systemss" (
.ss( )
Netss) ,
.ss, -
Socketsss- 4
.ss4 5
Socketss5 ;
	argSocketss< E
)ssE F
{tt 
Socketuu 
=uu 
	argSocketuu "
;uu" #
}vv 
publicxx 
intxx 

NextOffsetxx !
(xx! "
)xx" #
{yy 
returnzz 
Progresszz 
;zz  
}{{ 
public}} 
int}} 

NextLength}} !
(}}! "
)}}" #
{~~ 
if 
( 
BytesToSend 
.  
Length  &
-' (
Progress) 1
>2 3
gBufferSize4 ?
)? @
{
€€ 
return
 
gBufferSize
 &
;
& '
}
‚‚ 
else
ƒƒ 
{
„„ 
return
…… 
BytesToSend
…… &
.
……& '
Length
……' -
-
……. /
Progress
……0 8
;
……8 9
}
†† 
}
‡‡ 
public
ŠŠ 
void
ŠŠ 
Dispose
ŠŠ 
(
ŠŠ  
)
ŠŠ  !
{
‹‹ 
Dispose
ŒŒ 
(
ŒŒ 
true
ŒŒ 
)
ŒŒ 
;
ŒŒ 
GC
 
.
 
SuppressFinalize
 #
(
# $
this
$ (
)
( )
;
) *
}
 
private
 
bool
 
disposed
 !
;
! "
	protected
““ 
virtual
““ 
void
““ "
Dispose
““# *
(
““* +
bool
““+ /
	disposing
““0 9
)
““9 :
{
”” 
if
•• 
(
•• 
disposed
•• 
)
•• 
return
–– 
;
–– 
if
˜˜ 
(
˜˜ 
	disposing
˜˜ 
)
˜˜ 
{
™™ 
Array
›› 
.
›› 
Clear
›› 
(
››  
BytesToSend
››  +
,
››+ ,
$num
››- .
,
››. /
BytesToSend
››0 ;
.
››; <
Length
››< B
)
››B C
;
››C D
}
 
disposed
¢¢ 
=
¢¢ 
true
¢¢ 
;
¢¢  
}
££ 
}
¤¤ 	
public
¦¦ 
class
¦¦ 
MessageQueue
¦¦ !
{
§§ 	
public
¨¨ 
System
¨¨ 
.
¨¨ 
Collections
¨¨ %
.
¨¨% &
Queue
¨¨& +
Messages
¨¨, 4
=
¨¨5 6
new
¨¨7 :
System
¨¨; A
.
¨¨A B
Collections
¨¨B M
.
¨¨M N
Queue
¨¨N S
(
¨¨S T
)
¨¨T U
;
¨¨U V
public
©© 
bool
©© 

Processing
©© "
;
©©" #
public
«« 
event
«« '
MessageQueuedEventHandler
«« 2
MessageQueued
««3 @
;
««@ A
public
­­ 
delegate
­­ 
void
­­  '
MessageQueuedEventHandler
­­! :
(
­­: ;
)
­­; <
;
­­< =
public
¯¯ 
void
¯¯ 
Add
¯¯ 
(
¯¯ 
AsyncSendState
¯¯ *
argState
¯¯+ 3
)
¯¯3 4
{
°° 
Messages
±± 
.
±± 
Enqueue
±±  
(
±±  !
argState
±±! )
)
±±) *
;
±±* +
MessageQueued
²² 
?
²² 
.
²² 
Invoke
²² %
(
²²% &
)
²²& '
;
²²' (
}
³³ 
}
´´ 	
public
¶¶ 
static
¶¶ 
class
¶¶ 
SocketManager
¶¶ )
{
·· 	
public
¾¾ 
static
¾¾ 
object
¾¾  
SendCommand
¾¾! ,
(
¾¾, -
SocketCommands
¾¾- ;
cmd
¾¾< ?
,
¾¾? @
SocketCommandData
¾¾A R
data
¾¾S W
,
¾¾W X
ulong
¾¾Y ^
OriginClientId
¾¾_ m
=
¾¾n o
$num
¾¾p q
)
¾¾q r
{
¿¿ 
return
ÀÀ 
new
ÀÀ 
SocketMessage
ÀÀ (
(
ÀÀ( )
OriginClientId
ÀÀ) 7
,
ÀÀ7 8
new
ÀÀ9 <
SocketCommand
ÀÀ= J
(
ÀÀJ K
cmd
ÀÀK N
,
ÀÀN O
data
ÀÀP T
)
ÀÀT U
)
ÀÀU V
;
ÀÀV W
}
ÁÁ 
private
ÃÃ 
static
ÃÃ 
object
ÃÃ !
SendCommand
ÃÃ" -
(
ÃÃ- .
SocketCommands
ÃÃ. <
cmd
ÃÃ= @
,
ÃÃ@ A
ulong
ÃÃB G
OriginClientId
ÃÃH V
=
ÃÃW X
$num
ÃÃY Z
)
ÃÃZ [
{
ÄÄ 
return
ÅÅ 
new
ÅÅ 
SocketMessage
ÅÅ (
(
ÅÅ( )
OriginClientId
ÅÅ) 7
,
ÅÅ7 8
new
ÅÅ9 <
SocketCommand
ÅÅ= J
(
ÅÅJ K
cmd
ÅÅK N
)
ÅÅN O
)
ÅÅO P
;
ÅÅP Q
}
ÆÆ 
public
ÈÈ 
static
ÈÈ 
object
ÈÈ  

SendObject
ÈÈ! +
(
ÈÈ+ ,
object
ÈÈ, 2
obj
ÈÈ3 6
,
ÈÈ6 7
ulong
ÈÈ8 =
OriginClientId
ÈÈ> L
)
ÈÈL M
{
ÉÉ 
return
ÊÊ 
new
ÊÊ 
SocketMessage
ÊÊ (
(
ÊÊ( )
OriginClientId
ÊÊ) 7
,
ÊÊ7 8
obj
ÊÊ9 <
)
ÊÊ< =
;
ÊÊ= >
}
ËË 
public
ÏÏ 
static
ÏÏ 
object
ÏÏ  

SendConnId
ÏÏ! +
(
ÏÏ+ ,
ulong
ÏÏ, 1
clientId
ÏÏ2 :
)
ÏÏ: ;
{
ĞĞ 
return
ÑÑ 
SendCommand
ÑÑ "
(
ÑÑ" #
SocketCommands
ÑÑ# 1
.
ÑÑ1 2
CreateConnId
ÑÑ2 >
,
ÑÑ> ?
clientId
ÑÑ@ H
)
ÑÑH I
;
ÑÑI J
}
ÒÒ 
public
ÔÔ 
static
ÔÔ 
object
ÔÔ  
ConfirmConnId
ÔÔ! .
(
ÔÔ. /
ulong
ÔÔ/ 4
id
ÔÔ5 7
)
ÔÔ7 8
{
ÕÕ 
return
ÖÖ 
SendCommand
ÖÖ "
(
ÖÖ" #
SocketCommands
ÖÖ# 1
.
ÖÖ1 2
ConfirmConnId
ÖÖ2 ?
,
ÖÖ? @
id
ÖÖA C
)
ÖÖC D
;
ÖÖD E
}
×× 
public
ÚÚ 
static
ÚÚ 
object
ÚÚ  
ManagedConn
ÚÚ! ,
(
ÚÚ, -
)
ÚÚ- .
{
ÛÛ 
return
ÜÜ 
SendCommand
ÜÜ "
(
ÜÜ" #
SocketCommands
ÜÜ# 1
.
ÜÜ1 2
Conn
ÜÜ2 6
)
ÜÜ6 7
;
ÜÜ7 8
}
İİ 
public
ßß 
static
ßß 
object
ßß  
PoliteClose
ßß! ,
(
ßß, -
ulong
ßß- 2
id
ßß3 5
=
ßß6 7
$num
ßß8 9
)
ßß9 :
{
àà 
return
áá 
SendCommand
áá "
(
áá" #
SocketCommands
áá# 1
.
áá1 2
CloseInstance
áá2 ?
)
áá? @
;
áá@ A
}
ââ 
public
ää 
static
ää 
object
ää  
ClientClosed
ää! -
(
ää- .
ulong
ää. 3
id
ää4 6
=
ää7 8
$num
ää9 :
)
ää: ;
{
åå 
return
ææ 
SendCommand
ææ "
(
ææ" #
SocketCommands
ææ# 1
.
ææ1 2
ClosedClient
ææ2 >
)
ææ> ?
;
ææ? @
}
çç 
}
èè 	
public
êê 
class
êê !
SocketServerConsole
êê (
{
ëë 	
public
îî !
SocketServerConsole
îî &
(
îî& '
)
îî' (
{
ïï 
}
ğğ 
public
÷÷ 
void
÷÷ 
Log
÷÷ 
(
÷÷ 
string
÷÷ "
str
÷÷# &
,
÷÷& '
params
÷÷( .
object
÷÷/ 5
[
÷÷5 6
]
÷÷6 7
str0
÷÷8 <
)
÷÷< =
{
øø 
Log
ùù 
(
ùù 
string
ùù 
.
ùù 
Format
ùù !
(
ùù! "
str
ùù" %
,
ùù% &
str0
ùù' +
)
ùù+ ,
)
ùù, -
;
ùù- .
}
úú 
public
üü 
void
üü 
Log
üü 
(
üü 
string
üü "
str
üü# &
)
üü& '
{
ıı 
Console
şş 
.
şş 
	WriteLine
şş !
(
şş! "
str
şş" %
)
şş% &
;
şş& '
}
ˆˆ 
}
‰‰ 	
public
‹‹ 
class
‹‹ !
SocketClientConsole
‹‹ (
{
ŒŒ 	
private
 
readonly
 
bool
 !

writeLines
" ,
=
- .
true
/ 3
;
3 4
private
’’ !
SocketClientConsole
’’ '
(
’’' (
)
’’( )
{
““ 
}
”” 
public
–– !
SocketClientConsole
–– &
(
––& '
bool
––' +
wl
––, .
=
––/ 0
true
––1 5
)
––5 6
{
—— 

writeLines
™™ 
=
™™ 
wl
™™ 
;
™™  
}
šš 
public
œœ 
void
œœ 
Log
œœ 
(
œœ 
string
œœ "
str
œœ# &
,
œœ& '
params
œœ( .
object
œœ/ 5
[
œœ5 6
]
œœ6 7
str0
œœ8 <
)
œœ< =
{
 
Log
 
(
 
string
 
.
 
Format
 !
(
! "
str
" %
,
% &
str0
' +
)
+ ,
)
, -
;
- .
}
ŸŸ 
public
¡¡ 
void
¡¡ 
Log
¡¡ 
(
¡¡ 
string
¡¡ "
str
¡¡# &
)
¡¡& '
{
¢¢ 
if
££ 
(
££ 

writeLines
££ 
)
££ 
Console
¤¤ 
.
¤¤ 
	WriteLine
¤¤ %
(
¤¤% &
$str
¤¤& 8
+
¤¤9 :
str
¤¤; >
)
¤¤> ?
;
¤¤? @
}
®® 
public
°° 
void
°° 
LogError
°°  
(
°°  !
string
°°! '
str
°°( +
,
°°+ ,
params
°°- 3
object
°°4 :
[
°°: ;
]
°°; <
str0
°°= A
)
°°A B
{
±± 
LogError
²² 
(
²² 
string
²² 
.
²²  
Format
²²  &
(
²²& '
str
²²' *
,
²²* +
str0
²², 0
)
²²0 1
)
²²1 2
;
²²2 3
}
³³ 
public
µµ 
void
µµ 
LogError
µµ  
(
µµ  !
string
µµ! '
str
µµ( +
)
µµ+ ,
{
¶¶ 
if
·· 
(
·· 

writeLines
·· 
)
·· 
Console
¸¸ 
.
¸¸ 
	WriteLine
¸¸ %
(
¸¸% &
$str
¸¸& >
+
¸¸? @
str
¸¸A D
)
¸¸D E
;
¸¸E F
}
ÂÂ 
}
ÃÃ 	
}
ÄÄ 
}ÅÅ Ö
ID:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\SocketMessage.cs
	namespace 	
SanAndreasAPI
 
{ 
[ 
Serializable 
] 
public		 

class		 
SocketMessage		 
{

 
public 
string 
StringValue !
{ 	
get 
{ 
try 
{ 
return 
( 
string "
)" #
msg# &
;& '
} 
catch 
{ 
return 
$str 
; 
} 
} 
} 	
public 
int 
IntValue 
{ 	
get 
{ 
try 
{   
return!! 
(!! 
int!! 
)!!  
msg!!  #
;!!# $
}"" 
catch## 
{$$ 
return%% 
-%% 
$num%% 
;%% 
}&& 
}'' 
}(( 	
[** 	
Obsolete**	 
]** 
public++ 
ulong++ 
id++ 
{,, 	
get-- 
{.. 
return// 
ClientOriginId// %
;//% &
}00 
}11 	
public66 
ulong66 
ClientOriginId66 #
;66# $
public88 
ulong88 
[88 
]88 
DestsId88 
=88  
new88! $
ulong88% *
[88* +
$num88+ ,
]88, -
{88. /
ulong880 5
.885 6
MaxValue886 >
}88? @
;88@ A
public;; 
Type;; 
Type;; 
{<< 	
get== 
{>> 
return?? 
msg?? 
.?? 
GetType?? "
(??" #
)??# $
;??$ %
}@@ 
}AA 	
publicGG 
objectGG 
msgGG 
;GG 
publicNN 
SocketMessageNN 
(NN 
ulongNN "
oiNN# %
,NN% &
objectNN' -
mNN. /
)NN/ 0
{OO 	
ClientOriginIdPP 
=PP 
oiPP 
;PP  
msgRR 
=RR 
mRR 
;RR 
}SS 	
publicUU 
voidUU 

SetDestIdsUU 
(UU 
paramsUU %
ulongUU& +
[UU+ ,
]UU, -
idsUU. 1
)UU1 2
{VV 	
DestsIdWW 
=WW 
idsWW 
;WW 
}XX 	
publicZZ 
TZZ 
TryGetObjectZZ 
<ZZ 
TZZ 
>ZZ  
(ZZ  !
)ZZ! "
{[[ 	
return\\ 
(\\ 
T\\ 
)\\ 
msg\\ 
;\\ 
}]] 	
}^^ 
}__ œø
HD:\UNITY\Unity Projects\SanAndreasUnity\VS\SanAndreasAPI\SocketServer.cs
	namespace		 	
SanAndreasAPI		
 
{

 
public 

class 
SocketServer 
: 
IDisposable  +
{ 
public 
SocketServerConsole "
myLogger# +
=, -
new. 1
SocketServerConsole2 E
(E F
)F G
;G H
public 
const 
int 
DefPort  
=! "
$num# '
;' (
public 
Socket 
ServerSocket "
;" #
public!! 
SocketPermission!! 
	Permision!!  )
;!!) *
public&& 
	IPAddress&& 
IP&& 
;&& 
public++ 
int++ 
Port++ 
;++ 
[-- 	
Obsolete--	 
(-- 
$str-- &
)--& '
]--' (
private.. 

IPEndPoint.. 
	_endpoint.. $
;..$ %
public33 
static33 
ManualResetEvent33 &
allDone33' .
=33/ 0
new331 4
ManualResetEvent335 E
(33E F
false33F K
)33K L
;33L M
public88 
static88 

Dictionary88  
<88  !
ulong88! &
,88& '
Socket88( .
>88. /
routingTable880 <
=88= >
new88? B

Dictionary88C M
<88M N
ulong88N S
,88S T
Socket88U [
>88[ \
(88\ ]
)88] ^
;88^ _
public:: 
Action:: 
<:: 
object:: 
,:: 
Socket:: $
>::$ %)
ReceivedClientMessageCallback::& C
;::C D
private<< 
static<< 
bool<< 
dispose<< #
,<<# $
debug<<% *
;<<* +
public@@ 
event@@ '
ClientConnectedEventHandler@@ 0
ClientConnected@@1 @
;@@@ A
publicBB 
eventBB '
MessageReceivedEventHandlerBB 0
MessageReceivedBB1 @
;BB@ A
publicDD 
eventDD *
ClientDisconnectedEventHandlerDD 3
ClientDisconnectedDD4 F
;DDF G
publicFF 
delegateFF 
voidFF '
ClientConnectedEventHandlerFF 8
(FF8 9
SocketFF9 ?
argClientSocketFF@ O
)FFO P
;FFP Q
publicHH 
delegateHH 
voidHH '
MessageReceivedEventHandlerHH 8
(HH8 9
stringHH9 ?

argMessageHH@ J
,HHJ K
SocketHHL R
argClientSocketHHS b
)HHb c
;HHc d
publicJJ 
delegateJJ 
voidJJ *
ClientDisconnectedEventHandlerJJ ;
(JJ; <
SocketJJ< B
argClientSocketJJC R
)JJR S
;JJS T
privatePP 
SocketStatePP 
_statePP "
;PP" #
publicRR 
SocketStateRR 
myStateRR "
{SS 	
getTT 
{UU 
returnVV 
_stateVV 
;VV 
}WW 
}XX 	
internal\\ 

IPEndPoint\\ 
IPEnd\\ !
{]] 	
get^^ 
{__ 
if`` 
(`` 
IP`` 
!=`` 
null`` 
)`` 
{aa 
ifbb 
(bb 
	_endpointbb !
==bb" $
nullbb% )
)bb) *
	_endpointcc !
=cc" #
newcc$ '

IPEndPointcc( 2
(cc2 3
IPcc3 5
,cc5 6
Portcc7 ;
)cc; <
;cc< =
returndd 
	_endpointdd $
;dd$ %
}ee 
elseff 
returnff 
nullff  
;ff  !
}gg 
}hh 	
publicuu 
SocketServeruu 
(uu 
booluu  
debuguu! &
,uu& '
booluu( ,
doConnectionuu- 9
=uu: ;
falseuu< A
)uuA B
:uuC D
thisvv 
(vv 
newvv 
SocketPermissionvv %
(vv% &
NetworkAccessvv& 3
.vv3 4
Acceptvv4 :
,vv: ;
TransportTypevv< I
.vvI J
TcpvvJ M
,vvM N
$strvvO Q
,vvQ R
SocketPermissionvvS c
.vvc d
AllPortsvvd l
)vvl m
,vvm n
Dnsvvo r
.vvr s
GetHostEntryvvs 
(	vv €
$str
vv€ ‚
)
vv‚ ƒ
.
vvƒ „
AddressList
vv„ 
[
vv 
$num
vv ‘
]
vv‘ ’
,
vv’ “
DefPort
vv” ›
,
vv› œ

SocketType
vv §
.
vv§ ¨
Stream
vv¨ ®
,
vv® ¯
ProtocolType
vv° ¼
.
vv¼ ½
Tcp
vv½ À
,
vvÀ Á
debug
vvÂ Ç
,
vvÇ È
doConnection
vvÉ Õ
)
vvÕ Ö
{ww 	
}ww
 
public
€€ 
SocketServer
€€ 
(
€€ 
string
€€ "
ip
€€# %
,
€€% &
int
€€' *
port
€€+ /
,
€€/ 0
bool
€€1 5
debug
€€6 ;
,
€€; <
bool
€€= A
doConnection
€€B N
=
€€O P
false
€€Q V
)
€€V W
:
€€X Y
this
 
(
 
new
 
SocketPermission
 %
(
% &
NetworkAccess
& 3
.
3 4
Accept
4 :
,
: ;
TransportType
< I
.
I J
Tcp
J M
,
M N
$str
O Q
,
Q R
SocketPermission
S c
.
c d
AllPorts
d l
)
l m
,
m n
	IPAddress
o x
.
x y
Parse
y ~
(
~ 
ip 
) ‚
,‚ ƒ
port„ ˆ
,ˆ ‰

SocketTypeŠ ”
.” •
Stream• ›
,› œ
ProtocolType ©
.© ª
Tcpª ­
,­ ®
debug¯ ´
,´ µ
doConnection¶ Â
)Â Ã
{
‚‚ 	
}
‚‚
 
public
 
SocketServer
 
(
 
SocketPermission
 ,

permission
- 7
,
7 8
	IPAddress
9 B
ipAddr
C I
,
I J
int
K N
port
O S
,
S T

SocketType
U _
sType
` e
,
e f
ProtocolType
g s
pType
t y
,
y z
bool
{ 
curDebug€ ˆ
,ˆ ‰
boolŠ 
doConnection ›
=œ 
false £
)£ ¤
{
 	

permission
 
.
 
Demand
 
(
 
)
 
;
  
IP
’’ 
=
’’ 
ipAddr
’’ 
;
’’ 
Port
““ 
=
““ 
port
““ 
;
““ 
debug
•• 
=
•• 
curDebug
•• 
;
•• 
ServerSocket
—— 
=
—— 
new
—— 
Socket
—— %
(
——% &
ipAddr
——& ,
.
——, -
AddressFamily
——- :
,
——: ;
sType
——< A
,
——A B
pType
——C H
)
——H I
;
——I J
if
™™ 
(
™™ 
doConnection
™™ 
)
™™ 
StartServer
šš 
(
šš 
)
šš 
;
šš 
}
›› 	
public
¡¡ 
void
¡¡ 
InitializeServer
¡¡ $
(
¡¡$ %
)
¡¡% &
{
¢¢ 	
}
££ 	
public
©© 
void
©© 
StartServer
©© 
(
©©  
)
©©  !
{
ªª 	
ServerSocket
®® 
.
®® 
Bind
®® 
(
®® 
IPEnd
®® #
)
®®# $
;
®®$ %
ServerSocket
±± 
.
±± 
Listen
±± 
(
±±  
$num
±±  $
)
±±$ %
;
±±% &
ServerSocket
´´ 
.
´´ 
BeginAccept
´´ $
(
´´$ %
new
´´% (
AsyncCallback
´´) 6
(
´´6 7
ClientAccepted
´´7 E
)
´´E F
,
´´F G
ServerSocket
´´H T
)
´´T U
;
´´U V
}
µµ 	
public
·· 
void
·· 

StopServer
·· 
(
·· 
)
··  
{
¸¸ 	
ServerSocket
ºº 
.
ºº 
Close
ºº 
(
ºº 
)
ºº  
;
ºº  !
}
¼¼ 	
public
ÃÃ 
void
ÃÃ 
ClientAccepted
ÃÃ "
(
ÃÃ" #
IAsyncResult
ÃÃ# /
ar
ÃÃ0 2
)
ÃÃ2 3
{
ÄÄ 	
Socket
ÆÆ 
mServerSocket
ÆÆ  
=
ÆÆ! "
(
ÆÆ# $
Socket
ÆÆ$ *
)
ÆÆ* +
ar
ÆÆ+ -
.
ÆÆ- .

AsyncState
ÆÆ. 8
;
ÆÆ8 9
Socket
ÈÈ 
mClientSocket
ÈÈ  
=
ÈÈ! "
null
ÈÈ# '
;
ÈÈ' (
try
ÉÉ 
{
ÊÊ 
mClientSocket
ËË 
=
ËË 
mServerSocket
ËË  -
.
ËË- .
	EndAccept
ËË. 7
(
ËË7 8
ar
ËË8 :
)
ËË: ;
;
ËË; <
}
ÌÌ 
catch
ÍÍ 
{
ÎÎ 
return
ĞĞ 
;
ĞĞ 
}
ÑÑ 
SocketGlobals
ÓÓ 
.
ÓÓ 
AsyncReceiveState
ÓÓ +
mState
ÓÓ, 2
=
ÓÓ3 4
new
ÓÓ5 8
SocketGlobals
ÓÓ9 F
.
ÓÓF G
AsyncReceiveState
ÓÓG X
(
ÓÓX Y
)
ÓÓY Z
;
ÓÓZ [
mState
ÔÔ 
.
ÔÔ 
Socket
ÔÔ 
=
ÔÔ 
mClientSocket
ÔÔ )
;
ÔÔ) *
ClientConnected
ÕÕ 
?
ÕÕ 
.
ÕÕ 
Invoke
ÕÕ #
(
ÕÕ# $
mState
ÕÕ$ *
.
ÕÕ* +
Socket
ÕÕ+ 1
)
ÕÕ1 2
;
ÕÕ2 3
mState
ÖÖ 
.
ÖÖ 
Socket
ÖÖ 
.
ÖÖ 
BeginReceive
ÖÖ &
(
ÖÖ& '
mState
ÖÖ' -
.
ÖÖ- .
Buffer
ÖÖ. 4
,
ÖÖ4 5
$num
ÖÖ6 7
,
ÖÖ7 8
SocketGlobals
ÖÖ9 F
.
ÖÖF G
gBufferSize
ÖÖG R
,
ÖÖR S
SocketFlags
ÖÖT _
.
ÖÖ_ `
None
ÖÖ` d
,
ÖÖd e
new
ÖÖf i
AsyncCallback
ÖÖj w
(
ÖÖw x$
ClientMessageReceivedÖÖx 
)ÖÖ 
,ÖÖ 
mStateÖÖ –
)ÖÖ– —
;ÖÖ— ˜
mServerSocket
ØØ 
.
ØØ 
BeginAccept
ØØ %
(
ØØ% &
new
ØØ& )
AsyncCallback
ØØ* 7
(
ØØ7 8
ClientAccepted
ØØ8 F
)
ØØF G
,
ØØG H
mServerSocket
ØØI V
)
ØØV W
;
ØØW X
}
ÜÜ 	
public
ãã 
void
ãã #
ClientMessageReceived
ãã )
(
ãã) *
IAsyncResult
ãã* 6
ar
ãã7 9
)
ãã9 :
{
ää 	
SocketGlobals
ææ 
.
ææ 
AsyncReceiveState
ææ +
mState
ææ, 2
=
ææ3 4
(
ææ5 6
SocketGlobals
ææ6 C
.
ææC D
AsyncReceiveState
ææD U
)
ææU V
ar
ææV X
.
ææX Y

AsyncState
ææY c
;
ææc d
int
éé 
numBytesReceived
éé  
=
éé! "
$num
éé# $
;
éé$ %
try
êê 
{
ëë 
numBytesReceived
ìì  
=
ìì! "
mState
ìì# )
.
ìì) *
Socket
ìì* 0
.
ìì0 1

EndReceive
ìì1 ;
(
ìì; <
ar
ìì< >
)
ìì> ?
;
ìì? @
}
íí 
catch
îî 
(
îî 
SocketException
îî "
ex
îî# %
)
îî% &
{
ïï 
if
ññ 
(
ññ 
ex
ññ 
.
ññ 
SocketErrorCode
ññ &
==
ññ' )
SocketError
ññ* 5
.
ññ5 6
ConnectionReset
ññ6 E
)
ññE F
{
òò  
ClientDisconnected
óó &
?
óó& '
.
óó' (
Invoke
óó( .
(
óó. /
mState
óó/ 5
.
óó5 6
Socket
óó6 <
)
óó< =
;
óó= >
return
ôô 
;
ôô 
}
õõ 
}
öö 
if
øø 
(
øø 
numBytesReceived
øø  
==
øø! #
$num
øø$ %
)
øø% &
{
ùù  
ClientDisconnected
úú "
?
úú" #
.
úú# $
Invoke
úú$ *
(
úú* +
mState
úú+ 1
.
úú1 2
Socket
úú2 8
)
úú8 9
;
úú9 :
return
ûû 
;
ûû 
}
üü 
if
ÿÿ 
(
ÿÿ 
mState
ÿÿ 
.
ÿÿ 
ReceiveSize
ÿÿ "
==
ÿÿ# %
$num
ÿÿ& '
)
ÿÿ' (
{
€€ 
mState
‚‚ 
.
‚‚ 
ReceiveSize
‚‚ "
=
‚‚# $
BitConverter
‚‚% 1
.
‚‚1 2
ToInt32
‚‚2 9
(
‚‚9 :
mState
‚‚: @
.
‚‚@ A
Buffer
‚‚A G
,
‚‚G H
$num
‚‚I J
)
‚‚J K
;
‚‚K L
mState
„„ 
.
„„  
PacketBufferStream
„„ )
.
„„) *
Write
„„* /
(
„„/ 0
mState
„„0 6
.
„„6 7
Buffer
„„7 =
,
„„= >
$num
„„? @
,
„„@ A
numBytesReceived
„„B R
-
„„S T
$num
„„U V
)
„„V W
;
„„W X
}
…… 
else
†† 
{
‡‡ 
mState
‰‰ 
.
‰‰  
PacketBufferStream
‰‰ )
.
‰‰) *
Write
‰‰* /
(
‰‰/ 0
mState
‰‰0 6
.
‰‰6 7
Buffer
‰‰7 =
,
‰‰= >
$num
‰‰? @
,
‰‰@ A
numBytesReceived
‰‰B R
)
‰‰R S
;
‰‰S T
}
ŠŠ 
mState
 
.
  
TotalBytesReceived
 %
+=
& (
numBytesReceived
) 9
;
9 :
if
 
(
 
mState
 
.
  
TotalBytesReceived
 )
<
* +
mState
, 2
.
2 3
ReceiveSize
3 >
)
> ?
{
‘‘ 
mState
”” 
.
”” 
Socket
”” 
.
”” 
BeginReceive
”” *
(
””* +
mState
””+ 1
.
””1 2
Buffer
””2 8
,
””8 9
$num
””: ;
,
””; <
SocketGlobals
””= J
.
””J K
gBufferSize
””K V
,
””V W
SocketFlags
””X c
.
””c d
None
””d h
,
””h i
new
””j m
AsyncCallback
””n {
(
””{ |$
ClientMessageReceived””| ‘
)””‘ ’
,””’ “
mState””” š
)””š ›
;””› œ
}
•• 
else
–– 
{
—— 
System
šš 
.
šš 
Runtime
šš 
.
šš 
Serialization
šš ,
.
šš, -

Formatters
šš- 7
.
šš7 8
Binary
šš8 >
.
šš> ?
BinaryFormatter
šš? N
mSerializer
ššO Z
=
šš[ \
new
šš] `
System
šša g
.
ššg h
Runtime
ššh o
.
ššo p
Serialization
ššp }
.
šš} ~

Formattersšš~ ˆ
.ššˆ ‰
Binaryšš‰ 
.šš 
BinaryFormatteršš Ÿ
(ššŸ  
)šš  ¡
;šš¡ ¢
mState
œœ 
.
œœ  
PacketBufferStream
œœ )
.
œœ) *
Position
œœ* 2
=
œœ3 4
$num
œœ5 6
;
œœ6 7
mState
 
.
 
Packet
 
=
 
mSerializer
  +
.
+ ,
Deserialize
, 7
(
7 8
mState
8 >
.
> ? 
PacketBufferStream
? Q
)
Q R
;
R S
Console
ŸŸ 
.
ŸŸ 
	WriteLine
ŸŸ !
(
ŸŸ! "
$str
ŸŸ" P
,
ŸŸP Q
mState
ŸŸR X
.
ŸŸX Y
Packet
ŸŸY _
.
ŸŸ_ `
GetType
ŸŸ` g
(
ŸŸg h
)
ŸŸh i
.
ŸŸi j
Name
ŸŸj n
)
ŸŸn o
;
ŸŸo p(
ParseReceivedClientMessage
¡¡ *
(
¡¡* +
mState
¡¡+ 1
.
¡¡1 2
Packet
¡¡2 8
,
¡¡8 9
mState
¡¡: @
.
¡¡@ A
Socket
¡¡A G
)
¡¡G H
;
¡¡H I
SocketGlobals
££ 
.
££ 
AsyncReceiveState
££ /

mNextState
££0 :
=
££; <
new
££= @
SocketGlobals
££A N
.
££N O
AsyncReceiveState
££O `
(
££` a
)
££a b
;
££b c

mNextState
¤¤ 
.
¤¤ 
Socket
¤¤ !
=
¤¤" #
mState
¤¤$ *
.
¤¤* +
Socket
¤¤+ 1
;
¤¤1 2
mState
§§ 
.
§§  
PacketBufferStream
§§ )
.
§§) *
Close
§§* /
(
§§/ 0
)
§§0 1
;
§§1 2
mState
¨¨ 
.
¨¨  
PacketBufferStream
¨¨ )
.
¨¨) *
Dispose
¨¨* 1
(
¨¨1 2
)
¨¨2 3
;
¨¨3 4
mState
©© 
.
©©  
PacketBufferStream
©© )
=
©©* +
null
©©, 0
;
©©0 1
Array
ªª 
.
ªª 
Clear
ªª 
(
ªª 
mState
ªª "
.
ªª" #
Buffer
ªª# )
,
ªª) *
$num
ªª+ ,
,
ªª, -
mState
ªª. 4
.
ªª4 5
Buffer
ªª5 ;
.
ªª; <
Length
ªª< B
)
ªªB C
;
ªªC D
Console
¬¬ 
.
¬¬ 
	WriteLine
¬¬ !
(
¬¬! "
$str
¬¬" q
,
¬¬q r
ar
¬¬s u
.
¬¬u v%
CompletedSynchronously¬¬v Œ
,¬¬Œ 
ar¬¬ 
.¬¬ ‘
IsCompleted¬¬‘ œ
)¬¬œ 
;¬¬ 

mNextState
®® 
.
®® 
Socket
®® !
.
®®! "
BeginReceive
®®" .
(
®®. /

mNextState
®®/ 9
.
®®9 :
Buffer
®®: @
,
®®@ A
$num
®®B C
,
®®C D
SocketGlobals
®®E R
.
®®R S
gBufferSize
®®S ^
,
®®^ _
SocketFlags
®®` k
.
®®k l
None
®®l p
,
®®p q
new
®®r u
AsyncCallback®®v ƒ
(®®ƒ „%
ClientMessageReceived®®„ ™
)®®™ š
,®®š ›

mNextState®®œ ¦
)®®¦ §
;®®§ ¨
mState
±± 
=
±± 
null
±± 
;
±± 
}
²² 
}
³³ 	
public
µµ 
void
µµ (
ParseReceivedClientMessage
µµ .
(
µµ. /
object
µµ/ 5
obj
µµ6 9
,
µµ9 :
Socket
µµ; A
	argClient
µµB K
)
µµK L
{
¶¶ 	
if
¸¸ 
(
¸¸ 
obj
¸¸ 
is
¸¸ 
string
¸¸ 
)
¸¸ 
{
¹¹ 
string
ºº 
argCommandString
ºº '
=
ºº( )
(
ºº* +
string
ºº+ 1
)
ºº1 2
obj
ºº2 5
;
ºº5 6
myLogger
»» 
.
»» 
Log
»» 
(
»» 
$str
»» ;
+
»»< =
argCommandString
»»> N
)
»»N O
;
»»O P
string
¾¾ 

argCommand
¾¾ !
=
¾¾" #
null
¾¾$ (
;
¾¾( )
string
¿¿ 
argText
¿¿ 
=
¿¿  
null
¿¿! %
;
¿¿% &
if
ÁÁ 
(
ÁÁ 
argCommandString
ÁÁ $
.
ÁÁ$ %

StartsWith
ÁÁ% /
(
ÁÁ/ 0
$str
ÁÁ0 3
)
ÁÁ3 4
)
ÁÁ4 5
{
ÂÂ 

argCommand
ÃÃ 
=
ÃÃ  
argCommandString
ÃÃ! 1
.
ÃÃ1 2
	Substring
ÃÃ2 ;
(
ÃÃ; <
$num
ÃÃ< =
,
ÃÃ= >
argCommandString
ÃÃ? O
.
ÃÃO P
IndexOf
ÃÃP W
(
ÃÃW X
$str
ÃÃX [
)
ÃÃ[ \
)
ÃÃ\ ]
;
ÃÃ] ^
argText
ÄÄ 
=
ÄÄ 
argCommandString
ÄÄ .
.
ÄÄ. /
Remove
ÄÄ/ 5
(
ÄÄ5 6
$num
ÄÄ6 7
,
ÄÄ7 8

argCommand
ÄÄ9 C
.
ÄÄC D
Length
ÄÄD J
+
ÄÄK L
$num
ÄÄM N
)
ÄÄN O
;
ÄÄO P
}
ÅÅ 
else
ÆÆ 
argText
ÇÇ 
=
ÇÇ 
argCommandString
ÇÇ .
;
ÇÇ. /
switch
ÉÉ 
(
ÉÉ 
argText
ÉÉ 
)
ÉÉ  
{
ÊÊ 
case
ËË 
$str
ËË $
:
ËË$ %!
SendMessageToClient
ÌÌ +
(
ÌÌ+ ,
$str
ÌÌ, B
,
ÌÌB C
	argClient
ÌÌD M
)
ÌÌM N
;
ÌÌN O
break
ÍÍ 
;
ÍÍ 
}
ÎÎ 
MessageReceived
ĞĞ 
?
ĞĞ  
.
ĞĞ  !
Invoke
ĞĞ! '
(
ĞĞ' (
argCommandString
ĞĞ( 8
,
ĞĞ8 9
	argClient
ĞĞ: C
)
ĞĞC D
;
ĞĞD E
}
ÑÑ 
else
ÒÒ 
if
ÒÒ 
(
ÒÒ 
obj
ÒÒ 
is
ÒÒ 
SocketMessage
ÒÒ )
)
ÒÒ) *
HandleAction
ÓÓ 
(
ÓÓ 
(
ÓÓ 
SocketMessage
ÓÓ +
)
ÓÓ+ ,
obj
ÓÓ, /
,
ÓÓ/ 0
	argClient
ÓÓ1 :
)
ÓÓ: ;
;
ÓÓ; <+
ReceivedClientMessageCallback
ÖÖ )
?
ÖÖ) *
.
ÖÖ* +
Invoke
ÖÖ+ 1
(
ÖÖ1 2
obj
ÖÖ2 5
,
ÖÖ5 6
	argClient
ÖÖ7 @
)
ÖÖ@ A
;
ÖÖA B
}
ØØ 	
public
ŞŞ 
void
ŞŞ 
SendToClient
ŞŞ  
(
ŞŞ  !
object
ŞŞ! '
obj
ŞŞ( +
,
ŞŞ+ ,
Socket
ŞŞ- 3
	argClient
ŞŞ4 =
)
ŞŞ= >
{
ßß 	
System
áá 
.
áá 
Runtime
áá 
.
áá 
Serialization
áá (
.
áá( )

Formatters
áá) 3
.
áá3 4
Binary
áá4 :
.
áá: ;
BinaryFormatter
áá; J
mSerializer
ááK V
=
ááW X
new
ááY \
System
áá] c
.
áác d
Runtime
áád k
.
áák l
Serialization
áál y
.
ááy z

Formattersááz „
.áá„ …
Binaryáá… ‹
.áá‹ Œ
BinaryFormatterááŒ ›
(áá› œ
)ááœ 
;áá 
using
ââ 
(
ââ 
System
ââ 
.
ââ 
IO
ââ 
.
ââ 
MemoryStream
ââ )
mSerializerStream
ââ* ;
=
ââ< =
new
ââ> A
System
ââB H
.
ââH I
IO
ââI K
.
ââK L
MemoryStream
ââL X
(
ââX Y
)
ââY Z
)
ââZ [
{
ãã 
mSerializer
ää 
.
ää 
	Serialize
ää %
(
ää% &
mSerializerStream
ää& 7
,
ää7 8
obj
ää9 <
)
ää< =
;
ää= >
byte
çç 
[
çç 
]
çç 
mPacketBytes
çç #
=
çç$ %
mSerializerStream
çç& 7
.
çç7 8
	GetBuffer
çç8 A
(
ççA B
)
ççB C
;
ççC D
byte
êê 
[
êê 
]
êê 

mSizeBytes
êê !
=
êê" #
BitConverter
êê$ 0
.
êê0 1
GetBytes
êê1 9
(
êê9 :
mPacketBytes
êê: F
.
êêF G
Length
êêG M
+
êêN O
$num
êêP Q
)
êêQ R
;
êêR S
SocketGlobals
íí 
.
íí 
AsyncSendState
íí ,
mState
íí- 3
=
íí4 5
new
íí6 9
SocketGlobals
íí: G
.
ííG H
AsyncSendState
ííH V
(
ííV W
	argClient
ííW `
)
íí` a
;
íía b
Array
ññ 
.
ññ 
Resize
ññ 
(
ññ 
ref
ññ  
mState
ññ! '
.
ññ' (
BytesToSend
ññ( 3
,
ññ3 4
mPacketBytes
ññ5 A
.
ññA B
Length
ññB H
+
ññI J

mSizeBytes
ññK U
.
ññU V
Length
ññV \
)
ññ\ ]
;
ññ] ^
Buffer
ôô 
.
ôô 
	BlockCopy
ôô  
(
ôô  !

mSizeBytes
ôô! +
,
ôô+ ,
$num
ôô- .
,
ôô. /
mState
ôô0 6
.
ôô6 7
BytesToSend
ôô7 B
,
ôôB C
$num
ôôD E
,
ôôE F

mSizeBytes
ôôG Q
.
ôôQ R
Length
ôôR X
)
ôôX Y
;
ôôY Z
Buffer
õõ 
.
õõ 
	BlockCopy
õõ  
(
õõ  !
mPacketBytes
õõ! -
,
õõ- .
$num
õõ/ 0
,
õõ0 1
mState
õõ2 8
.
õõ8 9
BytesToSend
õõ9 D
,
õõD E

mSizeBytes
õõF P
.
õõP Q
Length
õõQ W
,
õõW X
mPacketBytes
õõY e
.
õõe f
Length
õõf l
)
õõl m
;
õõm n
Array
÷÷ 
.
÷÷ 
Clear
÷÷ 
(
÷÷ 

mSizeBytes
÷÷ &
,
÷÷& '
$num
÷÷( )
,
÷÷) *

mSizeBytes
÷÷+ 5
.
÷÷5 6
Length
÷÷6 <
)
÷÷< =
;
÷÷= >
Array
øø 
.
øø 
Clear
øø 
(
øø 
mPacketBytes
øø (
,
øø( )
$num
øø* +
,
øø+ ,
mPacketBytes
øø- 9
.
øø9 :
Length
øø: @
)
øø@ A
;
øøA B
Console
úú 
.
úú 
Write
úú 
(
úú 
$str
úú  
)
úú  !
;
úú! "
Console
ıı 
.
ıı 
	WriteLine
ıı !
(
ıı! "
$str
ıı" [
,
ıı[ \
mState
ıı] c
.
ııc d

NextOffset
ııd n
(
ıın o
)
ııo p
,
ııp q
mState
ıır x
.
ııx y

NextLengthııy ƒ
(ııƒ „
)ıı„ …
)ıı… †
;ıı† ‡
	argClient
şş 
.
şş 
	BeginSend
şş #
(
şş# $
mState
şş$ *
.
şş* +
BytesToSend
şş+ 6
,
şş6 7
mState
şş8 >
.
şş> ?

NextOffset
şş? I
(
şşI J
)
şşJ K
,
şşK L
mState
şşM S
.
şşS T

NextLength
şşT ^
(
şş^ _
)
şş_ `
,
şş` a
SocketFlags
şşb m
.
şşm n
None
şşn r
,
şşr s
new
şşt w
AsyncCallbackşşx …
(şş… †
MessagePartSentşş† •
)şş• –
,şş– —
mStateşş˜ 
)şş Ÿ
;şşŸ  
}
ÿÿ 
}
€€ 	
public
†† 
void
†† !
SendMessageToClient
†† '
(
††' (
string
††( .
argCommandString
††/ ?
,
††? @
Socket
††A G
	argClient
††H Q
)
††Q R
{
‡‡ 	
SendToClient
ˆˆ 
(
ˆˆ 
argCommandString
ˆˆ )
,
ˆˆ) *
	argClient
ˆˆ+ 4
)
ˆˆ4 5
;
ˆˆ5 6
}
‰‰ 	
public
‹‹ 
void
‹‹ 
MessagePartSent
‹‹ #
(
‹‹# $
IAsyncResult
‹‹$ 0
ar
‹‹1 3
)
‹‹3 4
{
ŒŒ 	
SocketGlobals
 
.
 
AsyncSendState
 (
mState
) /
=
0 1
(
2 3
SocketGlobals
3 @
.
@ A
AsyncSendState
A O
)
O P
ar
P R
.
R S

AsyncState
S ]
;
] ^
try
 
{
‘‘ 
int
’’ 
numBytesSent
’’  
=
’’! "
$num
’’# $
;
’’$ %
numBytesSent
•• 
=
•• 
mState
•• %
.
••% &
Socket
••& ,
.
••, -
EndSend
••- 4
(
••4 5
ar
••5 7
)
••7 8
;
••8 9
mState
˜˜ 
.
˜˜ 
Progress
˜˜ 
+=
˜˜  "
numBytesSent
˜˜# /
;
˜˜/ 0
if
›› 
(
›› 
mState
›› 
.
›› 

NextLength
›› %
(
››% &
)
››& '
>
››( )
$num
››* +
)
››+ ,
{
œœ 
mState
 
.
 
Socket
 !
.
! "
	BeginSend
" +
(
+ ,
mState
, 2
.
2 3
BytesToSend
3 >
,
> ?
mState
@ F
.
F G

NextOffset
G Q
(
Q R
)
R S
,
S T
mState
U [
.
[ \

NextLength
\ f
(
f g
)
g h
,
h i
SocketFlags
j u
.
u v
None
v z
,
z {
new
| 
AsyncCallback€ 
( 
MessagePartSent 
) 
, Ÿ
mState  ¦
)¦ §
;§ ¨
}
ŸŸ 
else
   
{
¡¡ 
Console
¢¢ 
.
¢¢ 
	WriteLine
¢¢ %
(
¢¢% &
$str
¢¢& [
)
¢¢[ \
;
¢¢\ ]
Array
¤¤ 
.
¤¤ 
Clear
¤¤ 
(
¤¤  
mState
¤¤  &
.
¤¤& '
BytesToSend
¤¤' 2
,
¤¤2 3
$num
¤¤4 5
,
¤¤5 6
mState
¤¤7 =
.
¤¤= >
BytesToSend
¤¤> I
.
¤¤I J
Length
¤¤J P
)
¤¤P Q
;
¤¤Q R
mState
§§ 
=
§§ 
null
§§ !
;
§§! "
}
¨¨ 
}
«« 
catch
¬¬ 
(
¬¬ 
	Exception
¬¬ 
ex
¬¬ 
)
¬¬  
{
­­ 
myLogger
®® 
.
®® 
Log
®® 
(
®® 
$str
®® /
+
®®0 1
ex
®®2 4
.
®®4 5
Message
®®5 <
)
®®< =
;
®®= >
}
¯¯ 
}
°° 	
private
¶¶ 
void
¶¶ 
HandleAction
¶¶ !
(
¶¶! "
SocketMessage
¶¶" /
sm
¶¶0 2
,
¶¶2 3
Socket
¶¶4 :
handler
¶¶; B
)
¶¶B C
{
·· 	
if
¹¹ 
(
¹¹ 
sm
¹¹ 
.
¹¹ 
msg
¹¹ 
is
¹¹ 
SocketCommand
¹¹ '
)
¹¹' (
{
ºº 
SocketCommand
»» 
cmd
»» !
=
»»" #
sm
»»$ &
.
»»& '
TryGetObject
»»' 3
<
»»3 4
SocketCommand
»»4 A
>
»»A B
(
»»B C
)
»»C D
;
»»D E
if
¼¼ 
(
¼¼ 
cmd
¼¼ 
!=
¼¼ 
null
¼¼ 
)
¼¼  
{
½½ 
switch
¾¾ 
(
¾¾ 
cmd
¾¾ 
.
¾¾  
Command
¾¾  '
)
¾¾' (
{
¿¿ 
case
ÀÀ 
SocketCommands
ÀÀ +
.
ÀÀ+ ,
Conn
ÀÀ, 0
:
ÀÀ0 1
ulong
ÆÆ !
genID
ÆÆ" '
=
ÆÆ( )
$num
ÆÆ* +
;
ÆÆ+ ,
bool
ÉÉ  
b
ÉÉ! "
=
ÉÉ# $
routingTable
ÉÉ% 1
.
ÉÉ1 2
Keys
ÉÉ2 6
.
ÉÉ6 75
'FindFirstMissingNumberFromSequenceUlong
ÉÉ7 ^
(
ÉÉ^ _
out
ÉÉ_ b
genID
ÉÉc h
,
ÉÉh i
new
ÉÉj m
MinMax
ÉÉn t
<
ÉÉt u
ulong
ÉÉu z
>
ÉÉz {
(
ÉÉ{ |
$num
ÉÉ| }
,
ÉÉ} ~
(ÉÉ €
ulongÉÉ€ …
)ÉÉ… †
routingTableÉÉ† ’
.ÉÉ’ “
CountÉÉ“ ˜
)ÉÉ˜ ™
)ÉÉ™ š
;ÉÉš ›
myLogger
ÊÊ $
.
ÊÊ$ %
Log
ÊÊ% (
(
ÊÊ( )
$str
ÊÊ) O
,
ÊÊO P
genID
ÊÊQ V
)
ÊÊV W
;
ÊÊW X
SendToClient
ÌÌ (
(
ÌÌ( )
SocketManager
ÌÌ) 6
.
ÌÌ6 7

SendConnId
ÌÌ7 A
(
ÌÌA B
genID
ÌÌB G
)
ÌÌG H
,
ÌÌH I
handler
ÌÌJ Q
)
ÌÌQ R
;
ÌÌR S
break
ÍÍ !
;
ÍÍ! "
case
ÏÏ 
SocketCommands
ÏÏ +
.
ÏÏ+ ,
ConfirmConnId
ÏÏ, 9
:
ÏÏ9 :
routingTable
ĞĞ (
.
ĞĞ( )
Add
ĞĞ) ,
(
ĞĞ, -
sm
ĞĞ- /
.
ĞĞ/ 0
id
ĞĞ0 2
,
ĞĞ2 3
handler
ĞĞ4 ;
)
ĞĞ; <
;
ĞĞ< =
break
ÑÑ !
;
ÑÑ! "
case
ÓÓ 
SocketCommands
ÓÓ +
.
ÓÓ+ ,
CloseClients
ÓÓ, 8
:
ÓÓ8 9
CloseAllClients
ÔÔ +
(
ÔÔ+ ,
sm
ÔÔ, .
.
ÔÔ. /
id
ÔÔ/ 1
)
ÔÔ1 2
;
ÔÔ2 3
break
ÕÕ !
;
ÕÕ! "
case
×× 
SocketCommands
×× +
.
××+ ,
ClosedClient
××, 8
:
××8 9
SocketManager
ÙÙ )
.
ÙÙ) *
PoliteClose
ÙÙ* 5
(
ÙÙ5 6
sm
ÙÙ6 8
.
ÙÙ8 9
id
ÙÙ9 ;
)
ÙÙ; <
;
ÙÙ< =
routingTable
ÚÚ (
.
ÚÚ( )
Remove
ÚÚ) /
(
ÚÚ/ 0
sm
ÚÚ0 2
.
ÚÚ2 3
id
ÚÚ3 5
)
ÚÚ5 6
;
ÚÚ6 7*
CloseServerAfterClientsClose
ÛÛ 8
(
ÛÛ8 9
dispose
ÛÛ9 @
)
ÛÛ@ A
;
ÛÛA B
break
ÜÜ !
;
ÜÜ! "
case
ŞŞ 
SocketCommands
ŞŞ +
.
ŞŞ+ ,
Stop
ŞŞ, 0
:
ŞŞ0 1
CloseAllClients
ßß +
(
ßß+ ,
sm
ßß, .
.
ßß. /
id
ßß/ 1
)
ßß1 2
;
ßß2 3
break
àà !
;
àà! "
case
ââ 
SocketCommands
ââ +
.
ââ+ ,
UnpoliteStop
ââ, 8
:
ââ8 9
object
ãã "
d
ãã# $
=
ãã% &
cmd
ãã' *
.
ãã* +
Metadata
ãã+ 3
[
ãã3 4
$str
ãã4 =
]
ãã= >
;
ãã> ?
Stop
ää  
(
ää  !
d
ää! "
!=
ää# %
null
ää& *
&&
ää+ -
(
ää. /
(
ää/ 0
bool
ää0 4
)
ää4 5
d
ää5 6
)
ää6 7
)
ää7 8
;
ää8 9
break
åå !
;
åå! "
default
çç 
:
çç  
DoServerError
èè )
(
èè) *
string
èè* 0
.
èè0 1
Format
èè1 7
(
èè7 8
$str
èè8 v
,
èèv w
cmd
èèx {
.
èè{ |
Commandèè| ƒ
)èèƒ „
,èè„ …
smèè† ˆ
.èèˆ ‰
idèè‰ ‹
)èè‹ Œ
;èèŒ 
break
éé !
;
éé! "
}
êê 
}
ëë 
}
ìì 
else
íí 
SendToClient
ïï 
(
ïï 
sm
ïï 
,
ïï  
sm
ïï! #
.
ïï# $
DestsId
ïï$ +
)
ïï+ ,
;
ïï, -
}
ğğ 	
private
ôô 
void
ôô 
SendToAllClients
ôô %
(
ôô% &
SocketMessage
ôô& 3
sm
ôô4 6
,
ôô6 7
object
ôô8 >
obj
ôô? B
=
ôôC D
null
ôôE I
,
ôôI J
int
ôôK N
	bytesRead
ôôO X
=
ôôY Z
$num
ôô[ \
)
ôô\ ]
{
õõ 	
myLogger
öö 
.
öö 
Log
öö 
(
öö 
$str
öö 6
)
öö6 7
;
öö7 8
if
÷÷ 
(
÷÷ 
	bytesRead
÷÷ 
>
÷÷ 
$num
÷÷ 
)
÷÷ 
myLogger
÷÷ '
.
÷÷' (
Log
÷÷( +
(
÷÷+ ,
$str
÷÷, W
,
÷÷W X
sm
÷÷Y [
.
÷÷[ \
id
÷÷\ ^
,
÷÷^ _
	bytesRead
÷÷` i
)
÷÷i j
;
÷÷j k
myLogger
øø 
.
øø 
Log
øø 
(
øø 
$str
øø 8
)
øø8 9
;
øø9 :
myLogger
ùù 
.
ùù 
Log
ùù 
(
ùù 
$str
ùù 6
)
ùù6 7
;
ùù7 8
myLogger
úú 
.
úú 
Log
úú 
(
úú 
$str
úú 
)
úú 
;
úú 
foreach
ıı 
(
ıı 
KeyValuePair
ıı !
<
ıı! "
ulong
ıı" '
,
ıı' (
Socket
ıı) /
>
ıı/ 0
soc
ıı1 4
in
ıı5 7
routingTable
ıı8 D
)
ııD E
if
şş 
(
şş 
soc
şş 
.
şş 
Key
şş 
!=
şş 
sm
şş !
.
şş! "
id
şş" $
)
şş$ %
SendToClient
ÿÿ  
(
ÿÿ  !
obj
ÿÿ! $
==
ÿÿ% '
null
ÿÿ( ,
?
ÿÿ- .
sm
ÿÿ/ 1
:
ÿÿ2 3
obj
ÿÿ4 7
,
ÿÿ7 8
soc
ÿÿ9 <
.
ÿÿ< =
Value
ÿÿ= B
)
ÿÿB C
;
ÿÿC D
}
€€ 	
private
‚‚ 
void
‚‚ 
SendToClient
‚‚ !
(
‚‚! "
SocketMessage
‚‚" /
sm
‚‚0 2
,
‚‚2 3
object
‚‚4 :
obj
‚‚; >
=
‚‚? @
null
‚‚A E
,
‚‚E F
params
‚‚G M
ulong
‚‚N S
[
‚‚S T
]
‚‚T U
dests
‚‚V [
)
‚‚[ \
{
ƒƒ 	
SendToClient
„„ 
(
„„ 
sm
„„ 
,
„„ 
dests
„„ "
.
„„" #
AsEnumerable
„„# /
(
„„/ 0
)
„„0 1
,
„„1 2
obj
„„3 6
)
„„6 7
;
„„7 8
dests
…… 
=
…… 
null
…… 
;
…… 
}
†† 	
private
ˆˆ 
void
ˆˆ 
SendToClient
ˆˆ !
(
ˆˆ! "
SocketMessage
ˆˆ" /
sm
ˆˆ0 2
,
ˆˆ2 3
IEnumerable
ˆˆ4 ?
<
ˆˆ? @
ulong
ˆˆ@ E
>
ˆˆE F
dests
ˆˆG L
,
ˆˆL M
object
ˆˆN T
obj
ˆˆU X
=
ˆˆY Z
null
ˆˆ[ _
)
ˆˆ_ `
{
‰‰ 	
if
ŠŠ 
(
ŠŠ 
dests
ŠŠ 
==
ŠŠ 
null
ŠŠ 
)
ŠŠ 
{
‹‹ 
Console
ŒŒ 
.
ŒŒ 
	WriteLine
ŒŒ !
(
ŒŒ! "
$str
ŒŒ" I
)
ŒŒI J
;
ŒŒJ K
return
 
;
 
}
 
if
 
(
 
dests
 
.
 
Count
 
(
 
)
 
==
  
$num
! "
)
" #
{
 
if
‘‘ 
(
‘‘ 
dests
‘‘ 
.
‘‘ 
First
‘‘ 
(
‘‘  
)
‘‘  !
==
‘‘" $
ulong
‘‘% *
.
‘‘* +
MaxValue
‘‘+ 3
)
‘‘3 4
{
’’ 
foreach
““ 
(
““ 
KeyValuePair
““ )
<
““) *
ulong
““* /
,
““/ 0
Socket
““1 7
>
““7 8
soc
““9 <
in
““= ?
routingTable
““@ L
)
““L M
if
”” 
(
”” 
soc
”” 
.
””  
Key
””  #
!=
””$ &
sm
””' )
.
””) *
id
””* ,
)
””, -
SendToClient
•• (
(
••( )
obj
••) ,
==
••- /
null
••0 4
?
••5 6
sm
••7 9
:
••: ;
obj
••< ?
,
••? @
soc
••A D
.
••D E
Value
••E J
)
••J K
;
••K L
}
–– 
}
—— 
else
˜˜ 
if
˜˜ 
(
˜˜ 
dests
˜˜ 
.
˜˜ 
Count
˜˜  
(
˜˜  !
)
˜˜! "
>
˜˜# $
$num
˜˜% &
)
˜˜& '
{
™™ 
foreach
šš 
(
šš 
KeyValuePair
šš %
<
šš% &
ulong
šš& +
,
šš+ ,
Socket
šš- 3
>
šš3 4
soc
šš5 8
in
šš9 ;
routingTable
šš< H
.
ššH I
Where
ššI N
(
ššN O
x
ššO P
=>
ššQ S
dests
ššT Y
.
ššY Z
Contains
ššZ b
(
ššb c
x
ššc d
.
ššd e
Key
šše h
)
ššh i
)
šši j
)
ššj k
if
›› 
(
›› 
soc
›› 
.
›› 
Key
›› 
!=
››  "
sm
››# %
.
››% &
id
››& (
)
››( )
SendToClient
œœ $
(
œœ$ %
obj
œœ% (
==
œœ) +
null
œœ, 0
?
œœ1 2
sm
œœ3 5
:
œœ6 7
obj
œœ8 ;
,
œœ; <
soc
œœ= @
.
œœ@ A
Value
œœA F
)
œœF G
;
œœG H
}
 
else
 
{
ŸŸ 
Console
¡¡ 
.
¡¡ 
	WriteLine
¡¡ !
(
¡¡! "
$str
¡¡" V
)
¡¡V W
;
¡¡W X
}
¢¢ 
}
££ 	
private
©© 
void
©© 
DoServerError
©© "
(
©©" #
string
©©# )
msg
©©* -
,
©©- .
ulong
©©/ 4
id
©©5 7
=
©©8 9
$num
©©: ;
,
©©; <
bool
©©= A
dis
©©B E
=
©©F G
false
©©H M
)
©©M N
{
ªª 	

PoliteStop
«« 
(
«« 
dis
«« 
,
«« 
id
«« 
)
«« 
;
««  
myLogger
¬¬ 
.
¬¬ 
Log
¬¬ 
(
¬¬ 
$str
¬¬ 6
+
¬¬7 8
msg
¬¬9 <
,
¬¬< =
id
­­ 
==
­­ 
$num
­­ 
?
­­ 
$str
­­ 
:
­­ 
string
­­ %
.
­­% &
Format
­­& ,
(
­­, -
$str
­­- B
,
­­B C
id
­­D F
)
­­F G
)
­­G H
;
­­H I
}
®® 	
private
°° 
void
°° 
CloseAllClients
°° $
(
°°$ %
ulong
°°% *
id
°°+ -
=
°°. /
$num
°°0 1
)
°°1 2
{
±± 	
if
²² 
(
²² 
id
²² 
>
²² 
$num
²² 
)
²² 
SendToClient
²² $
(
²²$ %
SocketManager
²²% 2
.
²²2 3
PoliteClose
²²3 >
(
²²> ?
id
²²? A
)
²²A B
,
²²B C
routingTable
²²D P
[
²²P Q
id
²²Q S
]
²²S T
)
²²T U
;
²²U V
myLogger
³³ 
.
³³ 
Log
³³ 
(
³³ 
$str
³³ =
,
³³= >
routingTable
³³? K
.
³³K L
Count
³³L Q
)
³³Q R
;
³³R S
foreach
´´ 
(
´´ 
KeyValuePair
´´ !
<
´´! "
ulong
´´" '
,
´´' (
Socket
´´) /
>
´´/ 0
soc
´´1 4
in
´´5 7
routingTable
´´8 D
)
´´D E
{
µµ 
if
¶¶ 
(
¶¶ 
soc
¶¶ 
.
¶¶ 
Key
¶¶ 
!=
¶¶ 
id
¶¶ !
)
¶¶! "
{
·· 
myLogger
¸¸ 
.
¸¸ 
Log
¸¸  
(
¸¸  !
$str
¸¸! H
,
¸¸H I
soc
¸¸J M
.
¸¸M N
Key
¸¸N Q
)
¸¸Q R
;
¸¸R S
SendToClient
¹¹  
(
¹¹  !
SocketManager
¹¹! .
.
¹¹. /
PoliteClose
¹¹/ :
(
¹¹: ;
soc
¹¹; >
.
¹¹> ?
Key
¹¹? B
)
¹¹B C
,
¹¹C D
soc
¹¹E H
.
¹¹H I
Value
¹¹I N
)
¹¹N O
;
¹¹O P
}
ºº 
}
»» 
}
¼¼ 	
private
¾¾ 
void
¾¾ *
CloseServerAfterClientsClose
¾¾ 1
(
¾¾1 2
bool
¾¾2 6
dis
¾¾7 :
)
¾¾: ;
{
¿¿ 	
if
ÀÀ 
(
ÀÀ 
routingTable
ÀÀ 
.
ÀÀ 
Count
ÀÀ "
==
ÀÀ# %
$num
ÀÀ& '
)
ÀÀ' (
Stop
ÁÁ 
(
ÁÁ 
dis
ÁÁ 
)
ÁÁ 
;
ÁÁ 
}
ÂÂ 	
public
ÄÄ 
void
ÄÄ 

PoliteStop
ÄÄ 
(
ÄÄ 
bool
ÄÄ #
dis
ÄÄ$ '
=
ÄÄ( )
false
ÄÄ* /
,
ÄÄ/ 0
ulong
ÄÄ1 6
id
ÄÄ7 9
=
ÄÄ: ;
$num
ÄÄ< =
)
ÄÄ= >
{
ÅÅ 	
dispose
ÆÆ 
=
ÆÆ 
dis
ÆÆ 
;
ÆÆ 
CloseAllClients
ÇÇ 
(
ÇÇ 
id
ÇÇ 
)
ÇÇ 
;
ÇÇ  
}
ÈÈ 	
private
ÍÍ 
void
ÍÍ 
Stop
ÍÍ 
(
ÍÍ 
bool
ÍÍ 
dis
ÍÍ "
=
ÍÍ# $
true
ÍÍ% )
)
ÍÍ) *
{
ÎÎ 	
if
ÏÏ 
(
ÏÏ 
_state
ÏÏ 
==
ÏÏ 
SocketState
ÏÏ %
.
ÏÏ% &
ServerStarted
ÏÏ& 3
)
ÏÏ3 4
{
ĞĞ 
try
ÑÑ 
{
ÒÒ 
myLogger
ÓÓ 
.
ÓÓ 
Log
ÓÓ  
(
ÓÓ  !
$str
ÓÓ! 1
)
ÓÓ1 2
;
ÓÓ2 3
_state
ÕÕ 
=
ÕÕ 
SocketState
ÕÕ (
.
ÕÕ( )
ServerStopped
ÕÕ) 6
;
ÕÕ6 7
if
ÖÖ 
(
ÖÖ 
ServerSocket
ÖÖ $
.
ÖÖ$ %
	Connected
ÖÖ% .
)
ÖÖ. /
ServerSocket
×× $
.
××$ %
Shutdown
××% -
(
××- .
SocketShutdown
××. <
.
××< =
Both
××= A
)
××A B
;
××B C
ServerSocket
ÙÙ  
.
ÙÙ  !
Close
ÙÙ! &
(
ÙÙ& '
)
ÙÙ' (
;
ÙÙ( )
if
ÛÛ 
(
ÛÛ 
dis
ÛÛ 
)
ÛÛ 
{
ÜÜ 
ServerSocket
ŞŞ $
=
ŞŞ% &
null
ŞŞ' +
;
ŞŞ+ ,
}
ßß 
}
àà 
catch
áá 
(
áá 
	Exception
áá  
ex
áá! #
)
áá# $
{
ââ 
myLogger
ãã 
.
ãã 
Log
ãã  
(
ãã  !
$str
ãã! R
+
ããS T
ex
ããU W
)
ããW X
;
ããX Y
}
ää 
}
åå 
else
ææ 
myLogger
çç 
.
çç 
Log
çç 
(
çç 
$str
çç W
)
ççW X
;
ççX Y
}
èè 	
private
êê 
bool
êê 
disposed
êê 
;
êê 
public
íí 
void
íí 
Dispose
íí 
(
íí 
)
íí 
{
îî 	
Dispose
ïï 
(
ïï 
true
ïï 
)
ïï 
;
ïï 
GC
ğğ 
.
ğğ 
SuppressFinalize
ğğ 
(
ğğ  
this
ğğ  $
)
ğğ$ %
;
ğğ% &
}
ññ 	
	protected
ôô 
virtual
ôô 
void
ôô 
Dispose
ôô &
(
ôô& '
bool
ôô' +
	disposing
ôô, 5
)
ôô5 6
{
õõ 	
if
öö 
(
öö 
disposed
öö 
)
öö 
return
÷÷ 
;
÷÷ 
if
ùù 
(
ùù 
	disposing
ùù 
)
ùù 
{
úú 
myLogger
ûû 
.
ûû 
Log
ûû 
(
ûû 
$str
ûû /
)
ûû/ 0
;
ûû0 1

PoliteStop
üü 
(
üü 
true
üü 
)
üü  
;
üü  !
}
ÿÿ 
disposed
ƒƒ 
=
ƒƒ 
true
ƒƒ 
;
ƒƒ 
}
„„ 	
}
‰‰ 
}ŠŠ 