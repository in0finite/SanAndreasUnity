š
nD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water (Basic)\Scripts\WaterBasic.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
[ 
ExecuteInEditMode 
] 
public 

class 

WaterBasic 
: 
MonoBehaviour +
{ 
private 
void 
Update 
( 
) 
{		 	
Renderer

 
r

 
=

 
GetComponent

 %
<

% &
Renderer

& .
>

. /
(

/ 0
)

0 1
;

1 2
if 
( 
! 
r 
) 
{ 
return 
; 
} 
Material 
mat 
= 
r 
. 
sharedMaterial +
;+ ,
if 
( 
! 
mat 
) 
{ 
return 
; 
} 
Vector4 
	waveSpeed 
= 
mat  #
.# $
	GetVector$ -
(- .
$str. 9
)9 :
;: ;
float 
	waveScale 
= 
mat !
.! "
GetFloat" *
(* +
$str+ 7
)7 8
;8 9
float 
t 
= 
Time 
. 
time 
/  !
$num" '
;' (
Vector4 
offset4 
= 
	waveSpeed '
*( )
(* +
t+ ,
*- .
	waveScale/ 8
)8 9
;9 :
Vector4 
offsetClamped !
=" #
new$ '
Vector4( /
(/ 0
Mathf0 5
.5 6
Repeat6 <
(< =
offset4= D
.D E
xE F
,F G
$numH L
)L M
,M N
MathfO T
.T U
RepeatU [
([ \
offset4\ c
.c d
yd e
,e f
$numg k
)k l
,l m
Mathf 
. 
Repeat 
( 
offset4 $
.$ %
z% &
,& '
$num( ,
), -
,- .
Mathf/ 4
.4 5
Repeat5 ;
(; <
offset4< C
.C D
wD E
,E F
$numG K
)K L
)L M
;M N
mat 
. 
	SetVector 
( 
$str '
,' (
offsetClamped) 6
)6 7
;7 8
} 	
} 
} ·
jD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\Displace.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
[ 
ExecuteInEditMode 
] 
[ 
RequireComponent 
( 
typeof 
( 
	WaterBase &
)& '
)' (
]( )
public 

class 
Displace 
: 
MonoBehaviour )
{ 
public		 
void		 
Awake		 
(		 
)		 
{

 	
if 
( 
enabled 
) 
{ 
OnEnable 
( 
) 
; 
} 
else 
{ 
	OnDisable 
( 
) 
; 
} 
} 	
public 
void 
OnEnable 
( 
) 
{ 	
Shader 
. 
EnableKeyword  
(  !
$str! ?
)? @
;@ A
Shader 
. 
DisableKeyword !
(! "
$str" A
)A B
;B C
} 	
public 
void 
	OnDisable 
( 
) 
{ 	
Shader 
. 
EnableKeyword  
(  !
$str! @
)@ A
;A B
Shader 
. 
DisableKeyword !
(! "
$str" @
)@ A
;A B
} 	
}   
}!! Î
rD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\GerstnerDisplace.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
[ 
ExecuteInEditMode 
] 
[ 
RequireComponent 
( 
typeof 
( 
	WaterBase &
)& '
)' (
]( )
public 

class 
GerstnerDisplace !
:" #
Displace$ ,
{- .
}/ 0
} Ä

oD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\MeshContainer.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
public 

class 
MeshContainer 
{ 
public 
Mesh 
mesh 
; 
public 
Vector3 
[ 
] 
vertices !
;! "
public		 
Vector3		 
[		 
]		 
normals		  
;		  !
public 
MeshContainer 
( 
Mesh !
m" #
)# $
{ 	
mesh 
= 
m 
; 
vertices 
= 
m 
. 
vertices !
;! "
normals 
= 
m 
. 
normals 
;  
} 	
public 
void 
Update 
( 
) 
{ 	
mesh 
. 
vertices 
= 
vertices $
;$ %
mesh 
. 
normals 
= 
normals "
;" #
} 	
} 
} –â
rD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\PlanarReflection.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
[ 
ExecuteInEditMode 
] 
[ 
RequireComponent 
( 
typeof 
( 
	WaterBase &
)& '
)' (
]( )
public		 

class		 
PlanarReflection		 !
:		" #
MonoBehaviour		$ 1
{

 
public 
	LayerMask 
reflectionMask '
;' (
public 
bool 
reflectSkybox !
=" #
false$ )
;) *
public 
Color 

clearColor 
=  !
Color" '
.' (
grey( ,
;, -
public 
String 
reflectionSampler '
=( )
$str* :
;: ;
public 
float 
clipPlaneOffset $
=% &
$num' ,
;, -
private 
Vector3 
m_Oldpos  
;  !
private 
Camera 
m_ReflectionCamera )
;) *
private 
Material 
m_SharedMaterial )
;) *
private 

Dictionary 
< 
Camera !
,! "
bool# '
>' (
m_HelperCameras) 8
;8 9
public 
void 
Start 
( 
) 
{ 	
m_SharedMaterial 
= 
(  
(  !
	WaterBase! *
)* +

gameObject+ 5
.5 6
GetComponent6 B
(B C
typeofC I
(I J
	WaterBaseJ S
)S T
)T U
)U V
.V W
sharedMaterialW e
;e f
} 	
private 
Camera %
CreateReflectionCameraFor 0
(0 1
Camera1 7
cam8 ;
); <
{ 	
String 
reflName 
= 

gameObject (
.( )
name) -
+. /
$str0 <
+= >
cam? B
.B C
nameC G
;G H

GameObject 
go 
= 

GameObject &
.& '
Find' +
(+ ,
reflName, 4
)4 5
;5 6
if   
(   
!   
go   
)   
{!! 
go"" 
="" 
new"" 

GameObject"" #
(""# $
reflName""$ ,
,"", -
typeof"". 4
(""4 5
Camera""5 ;
)""; <
)""< =
;""= >
}## 
if$$ 
($$ 
!$$ 
go$$ 
.$$ 
GetComponent$$  
($$  !
typeof$$! '
($$' (
Camera$$( .
)$$. /
)$$/ 0
)$$0 1
{%% 
go&& 
.&& 
AddComponent&& 
(&&  
typeof&&  &
(&&& '
Camera&&' -
)&&- .
)&&. /
;&&/ 0
}'' 
Camera(( 
reflectCamera((  
=((! "
go((# %
.((% &
GetComponent((& 2
<((2 3
Camera((3 9
>((9 :
(((: ;
)((; <
;((< =
reflectCamera** 
.** 
backgroundColor** )
=*** +

clearColor**, 6
;**6 7
reflectCamera++ 
.++ 

clearFlags++ $
=++% &
reflectSkybox++' 4
?++5 6
CameraClearFlags++7 G
.++G H
Skybox++H N
:++O P
CameraClearFlags++Q a
.++a b

SolidColor++b l
;++l m&
SetStandardCameraParameter-- &
(--& '
reflectCamera--' 4
,--4 5
reflectionMask--6 D
)--D E
;--E F
if// 
(// 
!// 
reflectCamera// 
.// 
targetTexture// ,
)//, -
{00 
reflectCamera11 
.11 
targetTexture11 +
=11, -
CreateTextureFor11. >
(11> ?
cam11? B
)11B C
;11C D
}22 
return44 
reflectCamera44  
;44  !
}55 	
private77 
void77 &
SetStandardCameraParameter77 /
(77/ 0
Camera770 6
cam777 :
,77: ;
	LayerMask77< E
mask77F J
)77J K
{88 	
cam99 
.99 
cullingMask99 
=99 
mask99 "
&99# $
~99% &
(99& '
$num99' (
<<99) +
	LayerMask99, 5
.995 6
NameToLayer996 A
(99A B
$str99B I
)99I J
)99J K
;99K L
cam:: 
.:: 
backgroundColor:: 
=::  !
Color::" '
.::' (
black::( -
;::- .
cam;; 
.;; 
enabled;; 
=;; 
false;; 
;;;  
}<< 	
private>> 
RenderTexture>> 
CreateTextureFor>> .
(>>. /
Camera>>/ 5
cam>>6 9
)>>9 :
{?? 	
RenderTexture@@ 
rt@@ 
=@@ 
new@@ "
RenderTexture@@# 0
(@@0 1
Mathf@@1 6
.@@6 7

FloorToInt@@7 A
(@@A B
cam@@B E
.@@E F

pixelWidth@@F P
*@@Q R
$num@@S W
)@@W X
,@@X Y
MathfAA 
.AA 

FloorToIntAA  
(AA  !
camAA! $
.AA$ %
pixelHeightAA% 0
*AA1 2
$numAA3 7
)AA7 8
,AA8 9
$numAA: <
)AA< =
;AA= >
rtBB 
.BB 
	hideFlagsBB 
=BB 
	HideFlagsBB $
.BB$ %
DontSaveBB% -
;BB- .
returnCC 
rtCC 
;CC 
}DD 	
publicFF 
voidFF 
RenderHelpCamerasFF %
(FF% &
CameraFF& ,

currentCamFF- 7
)FF7 8
{GG 	
ifHH 
(HH 
nullHH 
==HH 
m_HelperCamerasHH '
)HH' (
{II 
m_HelperCamerasJJ 
=JJ  !
newJJ" %

DictionaryJJ& 0
<JJ0 1
CameraJJ1 7
,JJ7 8
boolJJ9 =
>JJ= >
(JJ> ?
)JJ? @
;JJ@ A
}KK 
ifMM 
(MM 
!MM 
m_HelperCamerasMM  
.MM  !
ContainsKeyMM! ,
(MM, -

currentCamMM- 7
)MM7 8
)MM8 9
{NN 
m_HelperCamerasOO 
.OO  
AddOO  #
(OO# $

currentCamOO$ .
,OO. /
falseOO0 5
)OO5 6
;OO6 7
}PP 
ifQQ 
(QQ 
m_HelperCamerasQQ 
[QQ  

currentCamQQ  *
]QQ* +
)QQ+ ,
{RR 
returnSS 
;SS 
}TT 
ifVV 
(VV 
!VV 
m_ReflectionCameraVV #
)VV# $
{WW 
m_ReflectionCameraXX "
=XX# $%
CreateReflectionCameraForXX% >
(XX> ?

currentCamXX? I
)XXI J
;XXJ K
}YY 
RenderReflectionFor[[ 
([[  

currentCam[[  *
,[[* +
m_ReflectionCamera[[, >
)[[> ?
;[[? @
m_HelperCameras]] 
[]] 

currentCam]] &
]]]& '
=]]( )
true]]* .
;]]. /
}^^ 	
public`` 
void`` 

LateUpdate`` 
(`` 
)``  
{aa 	
ifbb 
(bb 
nullbb 
!=bb 
m_HelperCamerasbb '
)bb' (
{cc 
m_HelperCamerasdd 
.dd  
Cleardd  %
(dd% &
)dd& '
;dd' (
}ee 
}ff 	
publichh 
voidhh "
WaterTileBeingRenderedhh *
(hh* +
	Transformhh+ 4
trhh5 7
,hh7 8
Camerahh9 ?

currentCamhh@ J
)hhJ K
{ii 	
RenderHelpCamerasjj 
(jj 

currentCamjj (
)jj( )
;jj) *
ifll 
(ll 
m_ReflectionCamerall "
&&ll# %
m_SharedMaterialll& 6
)ll6 7
{mm 
m_SharedMaterialnn  
.nn  !

SetTexturenn! +
(nn+ ,
reflectionSamplernn, =
,nn= >
m_ReflectionCamerann? Q
.nnQ R
targetTexturennR _
)nn_ `
;nn` a
}oo 
}pp 	
publicrr 
voidrr 
OnEnablerr 
(rr 
)rr 
{ss 	
Shadertt 
.tt 
EnableKeywordtt  
(tt  !
$strtt! 3
)tt3 4
;tt4 5
Shaderuu 
.uu 
DisableKeyworduu !
(uu! "
$struu" 0
)uu0 1
;uu1 2
}vv 	
publicxx 
voidxx 
	OnDisablexx 
(xx 
)xx 
{yy 	
Shaderzz 
.zz 
EnableKeywordzz  
(zz  !
$strzz! /
)zz/ 0
;zz0 1
Shader{{ 
.{{ 
DisableKeyword{{ !
({{! "
$str{{" 4
){{4 5
;{{5 6
}|| 	
private~~ 
void~~ 
RenderReflectionFor~~ (
(~~( )
Camera~~) /
cam~~0 3
,~~3 4
Camera~~5 ;
reflectCamera~~< I
)~~I J
{ 	
if
€€ 
(
€€ 
!
€€ 
reflectCamera
€€ 
)
€€ 
{
 
return
‚‚ 
;
‚‚ 
}
ƒƒ 
if
…… 
(
…… 
m_SharedMaterial
……  
&&
……! #
!
……$ %
m_SharedMaterial
……% 5
.
……5 6
HasProperty
……6 A
(
……A B
reflectionSampler
……B S
)
……S T
)
……T U
{
†† 
return
‡‡ 
;
‡‡ 
}
ˆˆ 
reflectCamera
ŠŠ 
.
ŠŠ 
cullingMask
ŠŠ %
=
ŠŠ& '
reflectionMask
ŠŠ( 6
&
ŠŠ7 8
~
ŠŠ9 :
(
ŠŠ: ;
$num
ŠŠ; <
<<
ŠŠ= ?
	LayerMask
ŠŠ@ I
.
ŠŠI J
NameToLayer
ŠŠJ U
(
ŠŠU V
$str
ŠŠV ]
)
ŠŠ] ^
)
ŠŠ^ _
;
ŠŠ_ ` 
SaneCameraSettings
ŒŒ 
(
ŒŒ 
reflectCamera
ŒŒ ,
)
ŒŒ, -
;
ŒŒ- .
reflectCamera
ŽŽ 
.
ŽŽ 
backgroundColor
ŽŽ )
=
ŽŽ* +

clearColor
ŽŽ, 6
;
ŽŽ6 7
reflectCamera
 
.
 

clearFlags
 $
=
% &
reflectSkybox
' 4
?
5 6
CameraClearFlags
7 G
.
G H
Skybox
H N
:
O P
CameraClearFlags
Q a
.
a b

SolidColor
b l
;
l m
if
 
(
 
reflectSkybox
 
)
 
{
‘‘ 
if
’’ 
(
’’ 
cam
’’ 
.
’’ 

gameObject
’’ "
.
’’" #
GetComponent
’’# /
(
’’/ 0
typeof
’’0 6
(
’’6 7
Skybox
’’7 =
)
’’= >
)
’’> ?
)
’’? @
{
““ 
Skybox
”” 
sb
”” 
=
”” 
(
””  !
Skybox
””! '
)
””' (
reflectCamera
””( 5
.
””5 6

gameObject
””6 @
.
””@ A
GetComponent
””A M
(
””M N
typeof
””N T
(
””T U
Skybox
””U [
)
””[ \
)
””\ ]
;
””] ^
if
•• 
(
•• 
!
•• 
sb
•• 
)
•• 
{
–– 
sb
—— 
=
—— 
(
—— 
Skybox
—— $
)
——$ %
reflectCamera
——% 2
.
——2 3

gameObject
——3 =
.
——= >
AddComponent
——> J
(
——J K
typeof
——K Q
(
——Q R
Skybox
——R X
)
——X Y
)
——Y Z
;
——Z [
}
˜˜ 
sb
™™ 
.
™™ 
material
™™ 
=
™™  !
(
™™" #
(
™™# $
Skybox
™™$ *
)
™™* +
cam
™™+ .
.
™™. /
GetComponent
™™/ ;
(
™™; <
typeof
™™< B
(
™™B C
Skybox
™™C I
)
™™I J
)
™™J K
)
™™K L
.
™™L M
material
™™M U
;
™™U V
}
šš 
}
›› 
GL
 
.
 
invertCulling
 
=
 
true
 #
;
# $
	Transform
ŸŸ 
reflectiveSurface
ŸŸ '
=
ŸŸ( )
	transform
ŸŸ* 3
;
ŸŸ3 4
Vector3
¡¡ 
eulerA
¡¡ 
=
¡¡ 
cam
¡¡  
.
¡¡  !
	transform
¡¡! *
.
¡¡* +
eulerAngles
¡¡+ 6
;
¡¡6 7
reflectCamera
££ 
.
££ 
	transform
££ #
.
££# $
eulerAngles
££$ /
=
££0 1
new
££2 5
Vector3
££6 =
(
££= >
-
££> ?
eulerA
££? E
.
££E F
x
££F G
,
££G H
eulerA
££I O
.
££O P
y
££P Q
,
££Q R
eulerA
££S Y
.
££Y Z
z
££Z [
)
££[ \
;
££\ ]
reflectCamera
¤¤ 
.
¤¤ 
	transform
¤¤ #
.
¤¤# $
position
¤¤$ ,
=
¤¤- .
cam
¤¤/ 2
.
¤¤2 3
	transform
¤¤3 <
.
¤¤< =
position
¤¤= E
;
¤¤E F
Vector3
¦¦ 
pos
¦¦ 
=
¦¦ 
reflectiveSurface
¦¦ +
.
¦¦+ ,
	transform
¦¦, 5
.
¦¦5 6
position
¦¦6 >
;
¦¦> ?
pos
§§ 
.
§§ 
y
§§ 
=
§§ 
reflectiveSurface
§§ %
.
§§% &
position
§§& .
.
§§. /
y
§§/ 0
;
§§0 1
Vector3
¨¨ 
normal
¨¨ 
=
¨¨ 
reflectiveSurface
¨¨ .
.
¨¨. /
	transform
¨¨/ 8
.
¨¨8 9
up
¨¨9 ;
;
¨¨; <
float
©© 
d
©© 
=
©© 
-
©© 
Vector3
©© 
.
©© 
Dot
©© "
(
©©" #
normal
©©# )
,
©©) *
pos
©©+ .
)
©©. /
-
©©0 1
clipPlaneOffset
©©2 A
;
©©A B
Vector4
ªª 
reflectionPlane
ªª #
=
ªª$ %
new
ªª& )
Vector4
ªª* 1
(
ªª1 2
normal
ªª2 8
.
ªª8 9
x
ªª9 :
,
ªª: ;
normal
ªª< B
.
ªªB C
y
ªªC D
,
ªªD E
normal
ªªF L
.
ªªL M
z
ªªM N
,
ªªN O
d
ªªP Q
)
ªªQ R
;
ªªR S
	Matrix4x4
¬¬ 

reflection
¬¬  
=
¬¬! "
	Matrix4x4
¬¬# ,
.
¬¬, -
zero
¬¬- 1
;
¬¬1 2

reflection
­­ 
=
­­ '
CalculateReflectionMatrix
­­ 2
(
­­2 3

reflection
­­3 =
,
­­= >
reflectionPlane
­­? N
)
­­N O
;
­­O P
m_Oldpos
®® 
=
®® 
cam
®® 
.
®® 
	transform
®® $
.
®®$ %
position
®®% -
;
®®- .
Vector3
¯¯ 
newpos
¯¯ 
=
¯¯ 

reflection
¯¯ '
.
¯¯' (
MultiplyPoint
¯¯( 5
(
¯¯5 6
m_Oldpos
¯¯6 >
)
¯¯> ?
;
¯¯? @
reflectCamera
±± 
.
±± !
worldToCameraMatrix
±± -
=
±±. /
cam
±±0 3
.
±±3 4!
worldToCameraMatrix
±±4 G
*
±±H I

reflection
±±J T
;
±±T U
Vector4
³³ 
	clipPlane
³³ 
=
³³ 
CameraSpacePlane
³³  0
(
³³0 1
reflectCamera
³³1 >
,
³³> ?
pos
³³@ C
,
³³C D
normal
³³E K
,
³³K L
$num
³³M Q
)
³³Q R
;
³³R S
	Matrix4x4
µµ 

projection
µµ  
=
µµ! "
cam
µµ# &
.
µµ& '
projectionMatrix
µµ' 7
;
µµ7 8

projection
¶¶ 
=
¶¶ $
CalculateObliqueMatrix
¶¶ /
(
¶¶/ 0

projection
¶¶0 :
,
¶¶: ;
	clipPlane
¶¶< E
)
¶¶E F
;
¶¶F G
reflectCamera
·· 
.
·· 
projectionMatrix
·· *
=
··+ ,

projection
··- 7
;
··7 8
reflectCamera
¹¹ 
.
¹¹ 
	transform
¹¹ #
.
¹¹# $
position
¹¹$ ,
=
¹¹- .
newpos
¹¹/ 5
;
¹¹5 6
Vector3
ºº 
euler
ºº 
=
ºº 
cam
ºº 
.
ºº  
	transform
ºº  )
.
ºº) *
eulerAngles
ºº* 5
;
ºº5 6
reflectCamera
»» 
.
»» 
	transform
»» #
.
»»# $
eulerAngles
»»$ /
=
»»0 1
new
»»2 5
Vector3
»»6 =
(
»»= >
-
»»> ?
euler
»»? D
.
»»D E
x
»»E F
,
»»F G
euler
»»H M
.
»»M N
y
»»N O
,
»»O P
euler
»»Q V
.
»»V W
z
»»W X
)
»»X Y
;
»»Y Z
reflectCamera
½½ 
.
½½ 
Render
½½  
(
½½  !
)
½½! "
;
½½" #
GL
¿¿ 
.
¿¿ 
invertCulling
¿¿ 
=
¿¿ 
false
¿¿ $
;
¿¿$ %
}
ÀÀ 	
private
ÂÂ 
void
ÂÂ  
SaneCameraSettings
ÂÂ '
(
ÂÂ' (
Camera
ÂÂ( .
	helperCam
ÂÂ/ 8
)
ÂÂ8 9
{
ÃÃ 	
	helperCam
ÄÄ 
.
ÄÄ 
depthTextureMode
ÄÄ &
=
ÄÄ' (
DepthTextureMode
ÄÄ) 9
.
ÄÄ9 :
None
ÄÄ: >
;
ÄÄ> ?
	helperCam
ÅÅ 
.
ÅÅ 
backgroundColor
ÅÅ %
=
ÅÅ& '
Color
ÅÅ( -
.
ÅÅ- .
black
ÅÅ. 3
;
ÅÅ3 4
	helperCam
ÆÆ 
.
ÆÆ 

clearFlags
ÆÆ  
=
ÆÆ! "
CameraClearFlags
ÆÆ# 3
.
ÆÆ3 4

SolidColor
ÆÆ4 >
;
ÆÆ> ?
	helperCam
ÇÇ 
.
ÇÇ 
renderingPath
ÇÇ #
=
ÇÇ$ %
RenderingPath
ÇÇ& 3
.
ÇÇ3 4
Forward
ÇÇ4 ;
;
ÇÇ; <
}
ÈÈ 	
private
ÊÊ 
static
ÊÊ 
	Matrix4x4
ÊÊ  $
CalculateObliqueMatrix
ÊÊ! 7
(
ÊÊ7 8
	Matrix4x4
ÊÊ8 A

projection
ÊÊB L
,
ÊÊL M
Vector4
ÊÊN U
	clipPlane
ÊÊV _
)
ÊÊ_ `
{
ËË 	
Vector4
ÌÌ 
q
ÌÌ 
=
ÌÌ 

projection
ÌÌ "
.
ÌÌ" #
inverse
ÌÌ# *
*
ÌÌ+ ,
new
ÌÌ- 0
Vector4
ÌÌ1 8
(
ÌÌ8 9
Sgn
ÍÍ 
(
ÍÍ 
	clipPlane
ÍÍ 
.
ÍÍ 
x
ÍÍ 
)
ÍÍ  
,
ÍÍ  !
Sgn
ÎÎ 
(
ÎÎ 
	clipPlane
ÎÎ 
.
ÎÎ 
y
ÎÎ 
)
ÎÎ  
,
ÎÎ  !
$num
ÏÏ 
,
ÏÏ 
$num
ÐÐ 
)
ÑÑ 
;
ÑÑ 
Vector4
ÒÒ 
c
ÒÒ 
=
ÒÒ 
	clipPlane
ÒÒ !
*
ÒÒ" #
(
ÒÒ$ %
$num
ÒÒ% )
/
ÒÒ* +
(
ÒÒ, -
Vector4
ÒÒ- 4
.
ÒÒ4 5
Dot
ÒÒ5 8
(
ÒÒ8 9
	clipPlane
ÒÒ9 B
,
ÒÒB C
q
ÒÒD E
)
ÒÒE F
)
ÒÒF G
)
ÒÒG H
;
ÒÒH I

projection
ÔÔ 
[
ÔÔ 
$num
ÔÔ 
]
ÔÔ 
=
ÔÔ 
c
ÔÔ 
.
ÔÔ 
x
ÔÔ 
-
ÔÔ  !

projection
ÔÔ" ,
[
ÔÔ, -
$num
ÔÔ- .
]
ÔÔ. /
;
ÔÔ/ 0

projection
ÕÕ 
[
ÕÕ 
$num
ÕÕ 
]
ÕÕ 
=
ÕÕ 
c
ÕÕ 
.
ÕÕ 
y
ÕÕ 
-
ÕÕ  !

projection
ÕÕ" ,
[
ÕÕ, -
$num
ÕÕ- .
]
ÕÕ. /
;
ÕÕ/ 0

projection
ÖÖ 
[
ÖÖ 
$num
ÖÖ 
]
ÖÖ 
=
ÖÖ 
c
ÖÖ 
.
ÖÖ 
z
ÖÖ  
-
ÖÖ! "

projection
ÖÖ# -
[
ÖÖ- .
$num
ÖÖ. 0
]
ÖÖ0 1
;
ÖÖ1 2

projection
×× 
[
×× 
$num
×× 
]
×× 
=
×× 
c
×× 
.
×× 
w
××  
-
××! "

projection
××# -
[
××- .
$num
××. 0
]
××0 1
;
××1 2
return
ÙÙ 

projection
ÙÙ 
;
ÙÙ 
}
ÚÚ 	
private
ÜÜ 
static
ÜÜ 
	Matrix4x4
ÜÜ  '
CalculateReflectionMatrix
ÜÜ! :
(
ÜÜ: ;
	Matrix4x4
ÜÜ; D
reflectionMat
ÜÜE R
,
ÜÜR S
Vector4
ÜÜT [
plane
ÜÜ\ a
)
ÜÜa b
{
ÝÝ 	
reflectionMat
ÞÞ 
.
ÞÞ 
m00
ÞÞ 
=
ÞÞ 
(
ÞÞ  !
$num
ÞÞ! %
-
ÞÞ& '
$num
ÞÞ( ,
*
ÞÞ- .
plane
ÞÞ/ 4
[
ÞÞ4 5
$num
ÞÞ5 6
]
ÞÞ6 7
*
ÞÞ8 9
plane
ÞÞ: ?
[
ÞÞ? @
$num
ÞÞ@ A
]
ÞÞA B
)
ÞÞB C
;
ÞÞC D
reflectionMat
ßß 
.
ßß 
m01
ßß 
=
ßß 
(
ßß  !
-
ßß! "
$num
ßß" &
*
ßß' (
plane
ßß) .
[
ßß. /
$num
ßß/ 0
]
ßß0 1
*
ßß2 3
plane
ßß4 9
[
ßß9 :
$num
ßß: ;
]
ßß; <
)
ßß< =
;
ßß= >
reflectionMat
àà 
.
àà 
m02
àà 
=
àà 
(
àà  !
-
àà! "
$num
àà" &
*
àà' (
plane
àà) .
[
àà. /
$num
àà/ 0
]
àà0 1
*
àà2 3
plane
àà4 9
[
àà9 :
$num
àà: ;
]
àà; <
)
àà< =
;
àà= >
reflectionMat
áá 
.
áá 
m03
áá 
=
áá 
(
áá  !
-
áá! "
$num
áá" &
*
áá' (
plane
áá) .
[
áá. /
$num
áá/ 0
]
áá0 1
*
áá2 3
plane
áá4 9
[
áá9 :
$num
áá: ;
]
áá; <
)
áá< =
;
áá= >
reflectionMat
ãã 
.
ãã 
m10
ãã 
=
ãã 
(
ãã  !
-
ãã! "
$num
ãã" &
*
ãã' (
plane
ãã) .
[
ãã. /
$num
ãã/ 0
]
ãã0 1
*
ãã2 3
plane
ãã4 9
[
ãã9 :
$num
ãã: ;
]
ãã; <
)
ãã< =
;
ãã= >
reflectionMat
ää 
.
ää 
m11
ää 
=
ää 
(
ää  !
$num
ää! %
-
ää& '
$num
ää( ,
*
ää- .
plane
ää/ 4
[
ää4 5
$num
ää5 6
]
ää6 7
*
ää8 9
plane
ää: ?
[
ää? @
$num
ää@ A
]
ääA B
)
ääB C
;
ääC D
reflectionMat
åå 
.
åå 
m12
åå 
=
åå 
(
åå  !
-
åå! "
$num
åå" &
*
åå' (
plane
åå) .
[
åå. /
$num
åå/ 0
]
åå0 1
*
åå2 3
plane
åå4 9
[
åå9 :
$num
åå: ;
]
åå; <
)
åå< =
;
åå= >
reflectionMat
ææ 
.
ææ 
m13
ææ 
=
ææ 
(
ææ  !
-
ææ! "
$num
ææ" &
*
ææ' (
plane
ææ) .
[
ææ. /
$num
ææ/ 0
]
ææ0 1
*
ææ2 3
plane
ææ4 9
[
ææ9 :
$num
ææ: ;
]
ææ; <
)
ææ< =
;
ææ= >
reflectionMat
èè 
.
èè 
m20
èè 
=
èè 
(
èè  !
-
èè! "
$num
èè" &
*
èè' (
plane
èè) .
[
èè. /
$num
èè/ 0
]
èè0 1
*
èè2 3
plane
èè4 9
[
èè9 :
$num
èè: ;
]
èè; <
)
èè< =
;
èè= >
reflectionMat
éé 
.
éé 
m21
éé 
=
éé 
(
éé  !
-
éé! "
$num
éé" &
*
éé' (
plane
éé) .
[
éé. /
$num
éé/ 0
]
éé0 1
*
éé2 3
plane
éé4 9
[
éé9 :
$num
éé: ;
]
éé; <
)
éé< =
;
éé= >
reflectionMat
êê 
.
êê 
m22
êê 
=
êê 
(
êê  !
$num
êê! %
-
êê& '
$num
êê( ,
*
êê- .
plane
êê/ 4
[
êê4 5
$num
êê5 6
]
êê6 7
*
êê8 9
plane
êê: ?
[
êê? @
$num
êê@ A
]
êêA B
)
êêB C
;
êêC D
reflectionMat
ëë 
.
ëë 
m23
ëë 
=
ëë 
(
ëë  !
-
ëë! "
$num
ëë" &
*
ëë' (
plane
ëë) .
[
ëë. /
$num
ëë/ 0
]
ëë0 1
*
ëë2 3
plane
ëë4 9
[
ëë9 :
$num
ëë: ;
]
ëë; <
)
ëë< =
;
ëë= >
reflectionMat
íí 
.
íí 
m30
íí 
=
íí 
$num
íí  $
;
íí$ %
reflectionMat
îî 
.
îî 
m31
îî 
=
îî 
$num
îî  $
;
îî$ %
reflectionMat
ïï 
.
ïï 
m32
ïï 
=
ïï 
$num
ïï  $
;
ïï$ %
reflectionMat
ðð 
.
ðð 
m33
ðð 
=
ðð 
$num
ðð  $
;
ðð$ %
return
òò 
reflectionMat
òò  
;
òò  !
}
óó 	
private
õõ 
static
õõ 
float
õõ 
Sgn
õõ  
(
õõ  !
float
õõ! &
a
õõ' (
)
õõ( )
{
öö 	
if
÷÷ 
(
÷÷ 
a
÷÷ 
>
÷÷ 
$num
÷÷ 
)
÷÷ 
{
øø 
return
ùù 
$num
ùù 
;
ùù 
}
úú 
if
ûû 
(
ûû 
a
ûû 
<
ûû 
$num
ûû 
)
ûû 
{
üü 
return
ýý 
-
ýý 
$num
ýý 
;
ýý 
}
þþ 
return
ÿÿ 
$num
ÿÿ 
;
ÿÿ 
}
€€ 	
private
‚‚ 
Vector4
‚‚ 
CameraSpacePlane
‚‚ (
(
‚‚( )
Camera
‚‚) /
cam
‚‚0 3
,
‚‚3 4
Vector3
‚‚5 <
pos
‚‚= @
,
‚‚@ A
Vector3
‚‚B I
normal
‚‚J P
,
‚‚P Q
float
‚‚R W
sideSign
‚‚X `
)
‚‚` a
{
ƒƒ 	
Vector3
„„ 
	offsetPos
„„ 
=
„„ 
pos
„„  #
+
„„$ %
normal
„„& ,
*
„„- .
clipPlaneOffset
„„/ >
;
„„> ?
	Matrix4x4
…… 
m
…… 
=
…… 
cam
…… 
.
…… !
worldToCameraMatrix
…… 1
;
……1 2
Vector3
†† 
cpos
†† 
=
†† 
m
†† 
.
†† 
MultiplyPoint
†† *
(
††* +
	offsetPos
††+ 4
)
††4 5
;
††5 6
Vector3
‡‡ 
cnormal
‡‡ 
=
‡‡ 
m
‡‡ 
.
‡‡  
MultiplyVector
‡‡  .
(
‡‡. /
normal
‡‡/ 5
)
‡‡5 6
.
‡‡6 7

normalized
‡‡7 A
*
‡‡B C
sideSign
‡‡D L
;
‡‡L M
return
‰‰ 
new
‰‰ 
Vector4
‰‰ 
(
‰‰ 
cnormal
‰‰ &
.
‰‰& '
x
‰‰' (
,
‰‰( )
cnormal
‰‰* 1
.
‰‰1 2
y
‰‰2 3
,
‰‰3 4
cnormal
‰‰5 <
.
‰‰< =
z
‰‰= >
,
‰‰> ?
-
‰‰@ A
Vector3
‰‰A H
.
‰‰H I
Dot
‰‰I L
(
‰‰L M
cpos
‰‰M Q
,
‰‰Q R
cnormal
‰‰S Z
)
‰‰Z [
)
‰‰[ \
;
‰‰\ ]
}
ŠŠ 	
}
‹‹ 
}ŒŒ Û
rD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\SpecularLighting.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
[ 
RequireComponent 
( 
typeof 
( 
	WaterBase &
)& '
)' (
]( )
[ 
ExecuteInEditMode 
] 
public 

class 
SpecularLighting !
:" #
MonoBehaviour$ 1
{ 
public		 
	Transform		 
specularLight		 &
;		& '
private

 
	WaterBase

 
m_WaterBase

 %
;

% &
public 
void 
Start 
( 
) 
{ 	
m_WaterBase 
= 
( 
	WaterBase $
)$ %

gameObject% /
./ 0
GetComponent0 <
(< =
typeof= C
(C D
	WaterBaseD M
)M N
)N O
;O P
} 	
public 
void 
Update 
( 
) 
{ 	
if 
( 
! 
m_WaterBase 
) 
{ 
m_WaterBase 
= 
( 
	WaterBase (
)( )

gameObject) 3
.3 4
GetComponent4 @
(@ A
typeofA G
(G H
	WaterBaseH Q
)Q R
)R S
;S T
} 
if 
( 
specularLight 
&&  
m_WaterBase! ,
., -
sharedMaterial- ;
); <
{ 
m_WaterBase 
. 
sharedMaterial *
.* +
	SetVector+ 4
(4 5
$str5 E
,E F
specularLightG T
.T U
	transformU ^
.^ _
forward_ f
)f g
;g h
} 
} 	
} 
} ”¿
gD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\Water.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
[ 
ExecuteInEditMode 
] 
public 

class 
Water 
: 
MonoBehaviour &
{		 
public

 
enum

 
	WaterMode

 
{ 	
Simple 
= 
$num 
, 

Reflective 
= 
$num 
, 

Refractive 
= 
$num 
, 
} 	
;	 

public 
	WaterMode 
	waterMode "
=# $
	WaterMode% .
.. /

Refractive/ 9
;9 :
public 
bool 
disablePixelLights &
=' (
true) -
;- .
public 
int 
textureSize 
=  
$num! $
;$ %
public 
float 
clipPlaneOffset $
=% &
$num' ,
;, -
public 
	LayerMask 
reflectLayers &
=' (
-) *
$num* +
;+ ,
public 
	LayerMask 
refractLayers &
=' (
-) *
$num* +
;+ ,
private 

Dictionary 
< 
Camera !
,! "
Camera# )
>) *
m_ReflectionCameras+ >
=? @
newA D

DictionaryE O
<O P
CameraP V
,V W
CameraX ^
>^ _
(_ `
)` a
;a b
private 

Dictionary 
< 
Camera !
,! "
Camera# )
>) *
m_RefractionCameras+ >
=? @
newA D

DictionaryE O
<O P
CameraP V
,V W
CameraX ^
>^ _
(_ `
)` a
;a b
private 
RenderTexture 
m_ReflectionTexture 1
;1 2
private 
RenderTexture 
m_RefractionTexture 1
;1 2
private 
	WaterMode "
m_HardwareWaterSupport 0
=1 2
	WaterMode3 <
.< =

Refractive= G
;G H
private 
int &
m_OldReflectionTextureSize .
;. /
private 
int &
m_OldRefractionTextureSize .
;. /
private 
static 
bool 
s_InsideWater )
;) *
public%% 
void%% 
OnWillRenderObject%% &
(%%& '
)%%' (
{&& 	
if'' 
('' 
!'' 
enabled'' 
||'' 
!'' 
GetComponent'' )
<'') *
Renderer''* 2
>''2 3
(''3 4
)''4 5
||''6 8
!''9 :
GetComponent'': F
<''F G
Renderer''G O
>''O P
(''P Q
)''Q R
.''R S
sharedMaterial''S a
||''b d
!(( 
GetComponent(( 
<(( 
Renderer(( &
>((& '
(((' (
)((( )
.(() *
enabled((* 1
)((1 2
{)) 
return** 
;** 
}++ 
Camera-- 
cam-- 
=-- 
Camera-- 
.--  
current--  '
;--' (
if.. 
(.. 
!.. 
cam.. 
).. 
{// 
return00 
;00 
}11 
if44 
(44 
s_InsideWater44 
)44 
{55 
return66 
;66 
}77 
s_InsideWater88 
=88 
true88  
;88  !"
m_HardwareWaterSupport== "
===# $$
FindHardwareWaterSupport==% =
(=== >
)==> ?
;==? @
	WaterMode>> 
mode>> 
=>> 
GetWaterMode>> )
(>>) *
)>>* +
;>>+ ,
Camera@@ 
reflectionCamera@@ #
,@@# $
refractionCamera@@% 5
;@@5 6
CreateWaterObjectsAA 
(AA 
camAA "
,AA" #
outAA$ '
reflectionCameraAA( 8
,AA8 9
outAA: =
refractionCameraAA> N
)AAN O
;AAO P
Vector3DD 
posDD 
=DD 
	transformDD #
.DD# $
positionDD$ ,
;DD, -
Vector3EE 
normalEE 
=EE 
	transformEE &
.EE& '
upEE' )
;EE) *
intHH 
oldPixelLightCountHH "
=HH# $
QualitySettingsHH% 4
.HH4 5
pixelLightCountHH5 D
;HHD E
ifII 
(II 
disablePixelLightsII "
)II" #
{JJ 
QualitySettingsKK 
.KK  
pixelLightCountKK  /
=KK0 1
$numKK2 3
;KK3 4
}LL 
UpdateCameraModesNN 
(NN 
camNN !
,NN! "
reflectionCameraNN# 3
)NN3 4
;NN4 5
UpdateCameraModesOO 
(OO 
camOO !
,OO! "
refractionCameraOO# 3
)OO3 4
;OO4 5
ifRR 
(RR 
modeRR 
>=RR 
	WaterModeRR !
.RR! "

ReflectiveRR" ,
)RR, -
{SS 
floatUU 
dUU 
=UU 
-UU 
Vector3UU "
.UU" #
DotUU# &
(UU& '
normalUU' -
,UU- .
posUU/ 2
)UU2 3
-UU4 5
clipPlaneOffsetUU6 E
;UUE F
Vector4VV 
reflectionPlaneVV '
=VV( )
newVV* -
Vector4VV. 5
(VV5 6
normalVV6 <
.VV< =
xVV= >
,VV> ?
normalVV@ F
.VVF G
yVVG H
,VVH I
normalVVJ P
.VVP Q
zVVQ R
,VVR S
dVVT U
)VVU V
;VVV W
	Matrix4x4XX 

reflectionXX $
=XX% &
	Matrix4x4XX' 0
.XX0 1
zeroXX1 5
;XX5 6%
CalculateReflectionMatrixYY )
(YY) *
refYY* -

reflectionYY. 8
,YY8 9
reflectionPlaneYY: I
)YYI J
;YYJ K
Vector3ZZ 
oldposZZ 
=ZZ  
camZZ! $
.ZZ$ %
	transformZZ% .
.ZZ. /
positionZZ/ 7
;ZZ7 8
Vector3[[ 
newpos[[ 
=[[  

reflection[[! +
.[[+ ,
MultiplyPoint[[, 9
([[9 :
oldpos[[: @
)[[@ A
;[[A B
reflectionCamera\\  
.\\  !
worldToCameraMatrix\\! 4
=\\5 6
cam\\7 :
.\\: ;
worldToCameraMatrix\\; N
*\\O P

reflection\\Q [
;\\[ \
Vector4`` 
	clipPlane`` !
=``" #
CameraSpacePlane``$ 4
(``4 5
reflectionCamera``5 E
,``E F
pos``G J
,``J K
normal``L R
,``R S
$num``T X
)``X Y
;``Y Z
reflectionCameraaa  
.aa  !
projectionMatrixaa! 1
=aa2 3
camaa4 7
.aa7 8"
CalculateObliqueMatrixaa8 N
(aaN O
	clipPlaneaaO X
)aaX Y
;aaY Z
reflectionCameradd  
.dd  !
cullingMatrixdd! .
=dd/ 0
camdd1 4
.dd4 5
projectionMatrixdd5 E
*ddF G
camddH K
.ddK L
worldToCameraMatrixddL _
;dd_ `
reflectionCameraff  
.ff  !
cullingMaskff! ,
=ff- .
~ff/ 0
(ff0 1
$numff1 2
<<ff3 5
$numff6 7
)ff7 8
&ff9 :
reflectLayersff; H
.ffH I
valueffI N
;ffN O
reflectionCameragg  
.gg  !
targetTexturegg! .
=gg/ 0
m_ReflectionTexturegg1 D
;ggD E
boolhh 

oldCullinghh 
=hh  !
GLhh" $
.hh$ %
invertCullinghh% 2
;hh2 3
GLii 
.ii 
invertCullingii  
=ii! "
!ii# $

oldCullingii$ .
;ii. /
reflectionCamerajj  
.jj  !
	transformjj! *
.jj* +
positionjj+ 3
=jj4 5
newposjj6 <
;jj< =
Vector3kk 
eulerkk 
=kk 
camkk  #
.kk# $
	transformkk$ -
.kk- .
eulerAngleskk. 9
;kk9 :
reflectionCamerall  
.ll  !
	transformll! *
.ll* +
eulerAnglesll+ 6
=ll7 8
newll9 <
Vector3ll= D
(llD E
-llE F
eulerllF K
.llK L
xllL M
,llM N
eulerllO T
.llT U
yllU V
,llV W
eulerllX ]
.ll] ^
zll^ _
)ll_ `
;ll` a
reflectionCameramm  
.mm  !
Rendermm! '
(mm' (
)mm( )
;mm) *
reflectionCamerann  
.nn  !
	transformnn! *
.nn* +
positionnn+ 3
=nn4 5
oldposnn6 <
;nn< =
GLoo 
.oo 
invertCullingoo  
=oo! "

oldCullingoo# -
;oo- .
GetComponentpp 
<pp 
Rendererpp %
>pp% &
(pp& '
)pp' (
.pp( )
sharedMaterialpp) 7
.pp7 8

SetTexturepp8 B
(ppB C
$strppC S
,ppS T
m_ReflectionTextureppU h
)pph i
;ppi j
}qq 
iftt 
(tt 
modett 
>=tt 
	WaterModett !
.tt! "

Refractivett" ,
)tt, -
{uu 
refractionCameravv  
.vv  !
worldToCameraMatrixvv! 4
=vv5 6
camvv7 :
.vv: ;
worldToCameraMatrixvv; N
;vvN O
Vector4zz 
	clipPlanezz !
=zz" #
CameraSpacePlanezz$ 4
(zz4 5
refractionCamerazz5 E
,zzE F
poszzG J
,zzJ K
normalzzL R
,zzR S
-zzT U
$numzzU Y
)zzY Z
;zzZ [
refractionCamera{{  
.{{  !
projectionMatrix{{! 1
={{2 3
cam{{4 7
.{{7 8"
CalculateObliqueMatrix{{8 N
({{N O
	clipPlane{{O X
){{X Y
;{{Y Z
refractionCamera~~  
.~~  !
cullingMatrix~~! .
=~~/ 0
cam~~1 4
.~~4 5
projectionMatrix~~5 E
*~~F G
cam~~H K
.~~K L
worldToCameraMatrix~~L _
;~~_ `
refractionCamera
€€  
.
€€  !
cullingMask
€€! ,
=
€€- .
~
€€/ 0
(
€€0 1
$num
€€1 2
<<
€€3 5
$num
€€6 7
)
€€7 8
&
€€9 :
refractLayers
€€; H
.
€€H I
value
€€I N
;
€€N O
refractionCamera
  
.
  !
targetTexture
! .
=
/ 0!
m_RefractionTexture
1 D
;
D E
refractionCamera
‚‚  
.
‚‚  !
	transform
‚‚! *
.
‚‚* +
position
‚‚+ 3
=
‚‚4 5
cam
‚‚6 9
.
‚‚9 :
	transform
‚‚: C
.
‚‚C D
position
‚‚D L
;
‚‚L M
refractionCamera
ƒƒ  
.
ƒƒ  !
	transform
ƒƒ! *
.
ƒƒ* +
rotation
ƒƒ+ 3
=
ƒƒ4 5
cam
ƒƒ6 9
.
ƒƒ9 :
	transform
ƒƒ: C
.
ƒƒC D
rotation
ƒƒD L
;
ƒƒL M
refractionCamera
„„  
.
„„  !
Render
„„! '
(
„„' (
)
„„( )
;
„„) *
GetComponent
…… 
<
…… 
Renderer
…… %
>
……% &
(
……& '
)
……' (
.
……( )
sharedMaterial
……) 7
.
……7 8

SetTexture
……8 B
(
……B C
$str
……C S
,
……S T!
m_RefractionTexture
……U h
)
……h i
;
……i j
}
†† 
if
‰‰ 
(
‰‰  
disablePixelLights
‰‰ "
)
‰‰" #
{
ŠŠ 
QualitySettings
‹‹ 
.
‹‹  
pixelLightCount
‹‹  /
=
‹‹0 1 
oldPixelLightCount
‹‹2 D
;
‹‹D E
}
ŒŒ 
switch
 
(
 
mode
 
)
 
{
 
case
‘‘ 
	WaterMode
‘‘ 
.
‘‘ 
Simple
‘‘ %
:
‘‘% &
Shader
’’ 
.
’’ 
EnableKeyword
’’ (
(
’’( )
$str
’’) 7
)
’’7 8
;
’’8 9
Shader
““ 
.
““ 
DisableKeyword
““ )
(
““) *
$str
““* <
)
““< =
;
““= >
Shader
”” 
.
”” 
DisableKeyword
”” )
(
””) *
$str
””* <
)
””< =
;
””= >
break
•• 
;
•• 
case
—— 
	WaterMode
—— 
.
—— 

Reflective
—— )
:
——) *
Shader
˜˜ 
.
˜˜ 
DisableKeyword
˜˜ )
(
˜˜) *
$str
˜˜* 8
)
˜˜8 9
;
˜˜9 :
Shader
™™ 
.
™™ 
EnableKeyword
™™ (
(
™™( )
$str
™™) ;
)
™™; <
;
™™< =
Shader
šš 
.
šš 
DisableKeyword
šš )
(
šš) *
$str
šš* <
)
šš< =
;
šš= >
break
›› 
;
›› 
case
 
	WaterMode
 
.
 

Refractive
 )
:
) *
Shader
žž 
.
žž 
DisableKeyword
žž )
(
žž) *
$str
žž* 8
)
žž8 9
;
žž9 :
Shader
ŸŸ 
.
ŸŸ 
DisableKeyword
ŸŸ )
(
ŸŸ) *
$str
ŸŸ* <
)
ŸŸ< =
;
ŸŸ= >
Shader
   
.
   
EnableKeyword
   (
(
  ( )
$str
  ) ;
)
  ; <
;
  < =
break
¡¡ 
;
¡¡ 
}
¢¢ 
s_InsideWater
¤¤ 
=
¤¤ 
false
¤¤ !
;
¤¤! "
}
¥¥ 	
private
¨¨ 
void
¨¨ 
	OnDisable
¨¨ 
(
¨¨ 
)
¨¨  
{
©© 	
if
ªª 
(
ªª !
m_ReflectionTexture
ªª #
)
ªª# $
{
«« 
DestroyImmediate
¬¬  
(
¬¬  !!
m_ReflectionTexture
¬¬! 4
)
¬¬4 5
;
¬¬5 6!
m_ReflectionTexture
­­ #
=
­­$ %
null
­­& *
;
­­* +
}
®® 
if
¯¯ 
(
¯¯ !
m_RefractionTexture
¯¯ #
)
¯¯# $
{
°° 
DestroyImmediate
±±  
(
±±  !!
m_RefractionTexture
±±! 4
)
±±4 5
;
±±5 6!
m_RefractionTexture
²² #
=
²²$ %
null
²²& *
;
²²* +
}
³³ 
foreach
´´ 
(
´´ 
var
´´ 
kvp
´´ 
in
´´ !
m_ReflectionCameras
´´  3
)
´´3 4
{
µµ 
DestroyImmediate
¶¶  
(
¶¶  !
(
¶¶! "
kvp
¶¶" %
.
¶¶% &
Value
¶¶& +
)
¶¶+ ,
.
¶¶, -

gameObject
¶¶- 7
)
¶¶7 8
;
¶¶8 9
}
·· !
m_ReflectionCameras
¸¸ 
.
¸¸  
Clear
¸¸  %
(
¸¸% &
)
¸¸& '
;
¸¸' (
foreach
¹¹ 
(
¹¹ 
var
¹¹ 
kvp
¹¹ 
in
¹¹ !
m_RefractionCameras
¹¹  3
)
¹¹3 4
{
ºº 
DestroyImmediate
»»  
(
»»  !
(
»»! "
kvp
»»" %
.
»»% &
Value
»»& +
)
»»+ ,
.
»», -

gameObject
»»- 7
)
»»7 8
;
»»8 9
}
¼¼ !
m_RefractionCameras
½½ 
.
½½  
Clear
½½  %
(
½½% &
)
½½& '
;
½½' (
}
¾¾ 	
private
ÂÂ 
void
ÂÂ 
Update
ÂÂ 
(
ÂÂ 
)
ÂÂ 
{
ÃÃ 	
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
GetComponent
ÄÄ 
<
ÄÄ 
Renderer
ÄÄ &
>
ÄÄ& '
(
ÄÄ' (
)
ÄÄ( )
)
ÄÄ) *
{
ÅÅ 
return
ÆÆ 
;
ÆÆ 
}
ÇÇ 
Material
ÈÈ 
mat
ÈÈ 
=
ÈÈ 
GetComponent
ÈÈ '
<
ÈÈ' (
Renderer
ÈÈ( 0
>
ÈÈ0 1
(
ÈÈ1 2
)
ÈÈ2 3
.
ÈÈ3 4
sharedMaterial
ÈÈ4 B
;
ÈÈB C
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 
mat
ÉÉ 
)
ÉÉ 
{
ÊÊ 
return
ËË 
;
ËË 
}
ÌÌ 
Vector4
ÎÎ 
	waveSpeed
ÎÎ 
=
ÎÎ 
mat
ÎÎ  #
.
ÎÎ# $
	GetVector
ÎÎ$ -
(
ÎÎ- .
$str
ÎÎ. 9
)
ÎÎ9 :
;
ÎÎ: ;
float
ÏÏ 
	waveScale
ÏÏ 
=
ÏÏ 
mat
ÏÏ !
.
ÏÏ! "
GetFloat
ÏÏ" *
(
ÏÏ* +
$str
ÏÏ+ 7
)
ÏÏ7 8
;
ÏÏ8 9
Vector4
ÐÐ 

waveScale4
ÐÐ 
=
ÐÐ  
new
ÐÐ! $
Vector4
ÐÐ% ,
(
ÐÐ, -
	waveScale
ÐÐ- 6
,
ÐÐ6 7
	waveScale
ÐÐ8 A
,
ÐÐA B
	waveScale
ÐÐC L
*
ÐÐM N
$num
ÐÐO S
,
ÐÐS T
	waveScale
ÐÐU ^
*
ÐÐ_ `
$num
ÐÐa f
)
ÐÐf g
;
ÐÐg h
double
ÓÓ 
t
ÓÓ 
=
ÓÓ 
Time
ÓÓ 
.
ÓÓ  
timeSinceLevelLoad
ÓÓ .
/
ÓÓ/ 0
$num
ÓÓ1 5
;
ÓÓ5 6
Vector4
ÔÔ 
offsetClamped
ÔÔ !
=
ÔÔ" #
new
ÔÔ$ '
Vector4
ÔÔ( /
(
ÔÔ/ 0
(
ÕÕ 
float
ÕÕ 
)
ÕÕ 
Math
ÕÕ 
.
ÕÕ 
IEEERemainder
ÕÕ )
(
ÕÕ) *
	waveSpeed
ÕÕ* 3
.
ÕÕ3 4
x
ÕÕ4 5
*
ÕÕ6 7

waveScale4
ÕÕ8 B
.
ÕÕB C
x
ÕÕC D
*
ÕÕE F
t
ÕÕG H
,
ÕÕH I
$num
ÕÕJ M
)
ÕÕM N
,
ÕÕN O
(
ÖÖ 
float
ÖÖ 
)
ÖÖ 
Math
ÖÖ 
.
ÖÖ 
IEEERemainder
ÖÖ )
(
ÖÖ) *
	waveSpeed
ÖÖ* 3
.
ÖÖ3 4
y
ÖÖ4 5
*
ÖÖ6 7

waveScale4
ÖÖ8 B
.
ÖÖB C
y
ÖÖC D
*
ÖÖE F
t
ÖÖG H
,
ÖÖH I
$num
ÖÖJ M
)
ÖÖM N
,
ÖÖN O
(
×× 
float
×× 
)
×× 
Math
×× 
.
×× 
IEEERemainder
×× )
(
××) *
	waveSpeed
××* 3
.
××3 4
z
××4 5
*
××6 7

waveScale4
××8 B
.
××B C
z
××C D
*
××E F
t
××G H
,
××H I
$num
××J M
)
××M N
,
××N O
(
ØØ 
float
ØØ 
)
ØØ 
Math
ØØ 
.
ØØ 
IEEERemainder
ØØ )
(
ØØ) *
	waveSpeed
ØØ* 3
.
ØØ3 4
w
ØØ4 5
*
ØØ6 7

waveScale4
ØØ8 B
.
ØØB C
w
ØØC D
*
ØØE F
t
ØØG H
,
ØØH I
$num
ØØJ M
)
ØØM N
)
ÙÙ 
;
ÙÙ 
mat
ÛÛ 
.
ÛÛ 
	SetVector
ÛÛ 
(
ÛÛ 
$str
ÛÛ '
,
ÛÛ' (
offsetClamped
ÛÛ) 6
)
ÛÛ6 7
;
ÛÛ7 8
mat
ÜÜ 
.
ÜÜ 
	SetVector
ÜÜ 
(
ÜÜ 
$str
ÜÜ '
,
ÜÜ' (

waveScale4
ÜÜ) 3
)
ÜÜ3 4
;
ÜÜ4 5
}
ÝÝ 	
private
ßß 
void
ßß 
UpdateCameraModes
ßß &
(
ßß& '
Camera
ßß' -
src
ßß. 1
,
ßß1 2
Camera
ßß3 9
dest
ßß: >
)
ßß> ?
{
àà 	
if
áá 
(
áá 
dest
áá 
==
áá 
null
áá 
)
áá 
{
ââ 
return
ãã 
;
ãã 
}
ää 
dest
ææ 
.
ææ 

clearFlags
ææ 
=
ææ 
src
ææ !
.
ææ! "

clearFlags
ææ" ,
;
ææ, -
dest
çç 
.
çç 
backgroundColor
çç  
=
çç! "
src
çç# &
.
çç& '
backgroundColor
çç' 6
;
çç6 7
if
èè 
(
èè 
src
èè 
.
èè 

clearFlags
èè 
==
èè !
CameraClearFlags
èè" 2
.
èè2 3
Skybox
èè3 9
)
èè9 :
{
éé 
Skybox
êê 
sky
êê 
=
êê 
src
êê  
.
êê  !
GetComponent
êê! -
<
êê- .
Skybox
êê. 4
>
êê4 5
(
êê5 6
)
êê6 7
;
êê7 8
Skybox
ëë 
mysky
ëë 
=
ëë 
dest
ëë #
.
ëë# $
GetComponent
ëë$ 0
<
ëë0 1
Skybox
ëë1 7
>
ëë7 8
(
ëë8 9
)
ëë9 :
;
ëë: ;
if
ìì 
(
ìì 
!
ìì 
sky
ìì 
||
ìì 
!
ìì 
sky
ìì  
.
ìì  !
material
ìì! )
)
ìì) *
{
íí 
mysky
îî 
.
îî 
enabled
îî !
=
îî" #
false
îî$ )
;
îî) *
}
ïï 
else
ðð 
{
ññ 
mysky
òò 
.
òò 
enabled
òò !
=
òò" #
true
òò$ (
;
òò( )
mysky
óó 
.
óó 
material
óó "
=
óó# $
sky
óó% (
.
óó( )
material
óó) 1
;
óó1 2
}
ôô 
}
õõ 
dest
ùù 
.
ùù 
farClipPlane
ùù 
=
ùù 
src
ùù  #
.
ùù# $
farClipPlane
ùù$ 0
;
ùù0 1
dest
úú 
.
úú 
nearClipPlane
úú 
=
úú  
src
úú! $
.
úú$ %
nearClipPlane
úú% 2
;
úú2 3
dest
ûû 
.
ûû 
orthographic
ûû 
=
ûû 
src
ûû  #
.
ûû# $
orthographic
ûû$ 0
;
ûû0 1
dest
üü 
.
üü 
fieldOfView
üü 
=
üü 
src
üü "
.
üü" #
fieldOfView
üü# .
;
üü. /
dest
ýý 
.
ýý 
aspect
ýý 
=
ýý 
src
ýý 
.
ýý 
aspect
ýý $
;
ýý$ %
dest
þþ 
.
þþ 
orthographicSize
þþ !
=
þþ" #
src
þþ$ '
.
þþ' (
orthographicSize
þþ( 8
;
þþ8 9
}
ÿÿ 	
private
‚‚ 
void
‚‚  
CreateWaterObjects
‚‚ '
(
‚‚' (
Camera
‚‚( .
currentCamera
‚‚/ <
,
‚‚< =
out
‚‚> A
Camera
‚‚B H
reflectionCamera
‚‚I Y
,
‚‚Y Z
out
‚‚[ ^
Camera
‚‚_ e
refractionCamera
‚‚f v
)
‚‚v w
{
ƒƒ 	
	WaterMode
„„ 
mode
„„ 
=
„„ 
GetWaterMode
„„ )
(
„„) *
)
„„* +
;
„„+ ,
reflectionCamera
†† 
=
†† 
null
†† #
;
††# $
refractionCamera
‡‡ 
=
‡‡ 
null
‡‡ #
;
‡‡# $
if
‰‰ 
(
‰‰ 
mode
‰‰ 
>=
‰‰ 
	WaterMode
‰‰ !
.
‰‰! "

Reflective
‰‰" ,
)
‰‰, -
{
ŠŠ 
if
ŒŒ 
(
ŒŒ 
!
ŒŒ !
m_ReflectionTexture
ŒŒ (
||
ŒŒ) +(
m_OldReflectionTextureSize
ŒŒ, F
!=
ŒŒG I
textureSize
ŒŒJ U
)
ŒŒU V
{
 
if
ŽŽ 
(
ŽŽ !
m_ReflectionTexture
ŽŽ +
)
ŽŽ+ ,
{
 
DestroyImmediate
 (
(
( )!
m_ReflectionTexture
) <
)
< =
;
= >
}
‘‘ !
m_ReflectionTexture
’’ '
=
’’( )
new
’’* -
RenderTexture
’’. ;
(
’’; <
textureSize
’’< G
,
’’G H
textureSize
’’I T
,
’’T U
$num
’’V X
)
’’X Y
;
’’Y Z!
m_ReflectionTexture
““ '
.
““' (
name
““( ,
=
““- .
$str
““/ B
+
““C D
GetInstanceID
““E R
(
““R S
)
““S T
;
““T U!
m_ReflectionTexture
”” '
.
””' (
isPowerOfTwo
””( 4
=
””5 6
true
””7 ;
;
””; <!
m_ReflectionTexture
•• '
.
••' (
	hideFlags
••( 1
=
••2 3
	HideFlags
••4 =
.
••= >
DontSave
••> F
;
••F G(
m_OldReflectionTextureSize
–– .
=
––/ 0
textureSize
––1 <
;
––< =
}
—— !
m_ReflectionCameras
šš #
.
šš# $
TryGetValue
šš$ /
(
šš/ 0
currentCamera
šš0 =
,
šš= >
out
šš? B
reflectionCamera
ššC S
)
ššS T
;
ššT U
if
›› 
(
›› 
!
›› 
reflectionCamera
›› %
)
››% &
{
œœ 

GameObject
 
go
 !
=
" #
new
$ '

GameObject
( 2
(
2 3
$str
3 I
+
J K
GetInstanceID
L Y
(
Y Z
)
Z [
+
\ ]
$str
^ e
+
f g
currentCamera
h u
.
u v
GetInstanceIDv ƒ
(ƒ „
)„ …
,… †
typeof‡ 
( Ž
CameraŽ ”
)” •
,• –
typeof— 
( ž
Skyboxž ¤
)¤ ¥
)¥ ¦
;¦ §
reflectionCamera
žž $
=
žž% &
go
žž' )
.
žž) *
GetComponent
žž* 6
<
žž6 7
Camera
žž7 =
>
žž= >
(
žž> ?
)
žž? @
;
žž@ A
reflectionCamera
ŸŸ $
.
ŸŸ$ %
enabled
ŸŸ% ,
=
ŸŸ- .
false
ŸŸ/ 4
;
ŸŸ4 5
reflectionCamera
   $
.
  $ %
	transform
  % .
.
  . /
position
  / 7
=
  8 9
	transform
  : C
.
  C D
position
  D L
;
  L M
reflectionCamera
¡¡ $
.
¡¡$ %
	transform
¡¡% .
.
¡¡. /
rotation
¡¡/ 7
=
¡¡8 9
	transform
¡¡: C
.
¡¡C D
rotation
¡¡D L
;
¡¡L M
reflectionCamera
¢¢ $
.
¢¢$ %

gameObject
¢¢% /
.
¢¢/ 0
AddComponent
¢¢0 <
<
¢¢< =

FlareLayer
¢¢= G
>
¢¢G H
(
¢¢H I
)
¢¢I J
;
¢¢J K
go
££ 
.
££ 
	hideFlags
££  
=
££! "
	HideFlags
££# ,
.
££, -
HideAndDontSave
££- <
;
££< =!
m_ReflectionCameras
¤¤ '
[
¤¤' (
currentCamera
¤¤( 5
]
¤¤5 6
=
¤¤7 8
reflectionCamera
¤¤9 I
;
¤¤I J
}
¥¥ 
}
¦¦ 
if
¨¨ 
(
¨¨ 
mode
¨¨ 
>=
¨¨ 
	WaterMode
¨¨ !
.
¨¨! "

Refractive
¨¨" ,
)
¨¨, -
{
©© 
if
«« 
(
«« 
!
«« !
m_RefractionTexture
«« (
||
««) +(
m_OldRefractionTextureSize
««, F
!=
««G I
textureSize
««J U
)
««U V
{
¬¬ 
if
­­ 
(
­­ !
m_RefractionTexture
­­ +
)
­­+ ,
{
®® 
DestroyImmediate
¯¯ (
(
¯¯( )!
m_RefractionTexture
¯¯) <
)
¯¯< =
;
¯¯= >
}
°° !
m_RefractionTexture
±± '
=
±±( )
new
±±* -
RenderTexture
±±. ;
(
±±; <
textureSize
±±< G
,
±±G H
textureSize
±±I T
,
±±T U
$num
±±V X
)
±±X Y
;
±±Y Z!
m_RefractionTexture
²² '
.
²²' (
name
²²( ,
=
²²- .
$str
²²/ B
+
²²C D
GetInstanceID
²²E R
(
²²R S
)
²²S T
;
²²T U!
m_RefractionTexture
³³ '
.
³³' (
isPowerOfTwo
³³( 4
=
³³5 6
true
³³7 ;
;
³³; <!
m_RefractionTexture
´´ '
.
´´' (
	hideFlags
´´( 1
=
´´2 3
	HideFlags
´´4 =
.
´´= >
DontSave
´´> F
;
´´F G(
m_OldRefractionTextureSize
µµ .
=
µµ/ 0
textureSize
µµ1 <
;
µµ< =
}
¶¶ !
m_RefractionCameras
¹¹ #
.
¹¹# $
TryGetValue
¹¹$ /
(
¹¹/ 0
currentCamera
¹¹0 =
,
¹¹= >
out
¹¹? B
refractionCamera
¹¹C S
)
¹¹S T
;
¹¹T U
if
ºº 
(
ºº 
!
ºº 
refractionCamera
ºº %
)
ºº% &
{
»» 

GameObject
¼¼ 
go
¼¼ !
=
¼¼" #
new
½½ 

GameObject
½½ &
(
½½& '
$str
½½' =
+
½½> ?
GetInstanceID
½½@ M
(
½½M N
)
½½N O
+
½½P Q
$str
½½R Y
+
½½Z [
currentCamera
½½\ i
.
½½i j
GetInstanceID
½½j w
(
½½w x
)
½½x y
,
½½y z
typeof
¾¾ "
(
¾¾" #
Camera
¾¾# )
)
¾¾) *
,
¾¾* +
typeof
¾¾, 2
(
¾¾2 3
Skybox
¾¾3 9
)
¾¾9 :
)
¾¾: ;
;
¾¾; <
refractionCamera
¿¿ $
=
¿¿% &
go
¿¿' )
.
¿¿) *
GetComponent
¿¿* 6
<
¿¿6 7
Camera
¿¿7 =
>
¿¿= >
(
¿¿> ?
)
¿¿? @
;
¿¿@ A
refractionCamera
ÀÀ $
.
ÀÀ$ %
enabled
ÀÀ% ,
=
ÀÀ- .
false
ÀÀ/ 4
;
ÀÀ4 5
refractionCamera
ÁÁ $
.
ÁÁ$ %
	transform
ÁÁ% .
.
ÁÁ. /
position
ÁÁ/ 7
=
ÁÁ8 9
	transform
ÁÁ: C
.
ÁÁC D
position
ÁÁD L
;
ÁÁL M
refractionCamera
ÂÂ $
.
ÂÂ$ %
	transform
ÂÂ% .
.
ÂÂ. /
rotation
ÂÂ/ 7
=
ÂÂ8 9
	transform
ÂÂ: C
.
ÂÂC D
rotation
ÂÂD L
;
ÂÂL M
refractionCamera
ÃÃ $
.
ÃÃ$ %

gameObject
ÃÃ% /
.
ÃÃ/ 0
AddComponent
ÃÃ0 <
<
ÃÃ< =

FlareLayer
ÃÃ= G
>
ÃÃG H
(
ÃÃH I
)
ÃÃI J
;
ÃÃJ K
go
ÄÄ 
.
ÄÄ 
	hideFlags
ÄÄ  
=
ÄÄ! "
	HideFlags
ÄÄ# ,
.
ÄÄ, -
HideAndDontSave
ÄÄ- <
;
ÄÄ< =!
m_RefractionCameras
ÅÅ '
[
ÅÅ' (
currentCamera
ÅÅ( 5
]
ÅÅ5 6
=
ÅÅ7 8
refractionCamera
ÅÅ9 I
;
ÅÅI J
}
ÆÆ 
}
ÇÇ 
}
ÈÈ 	
private
ÊÊ 
	WaterMode
ÊÊ 
GetWaterMode
ÊÊ &
(
ÊÊ& '
)
ÊÊ' (
{
ËË 	
if
ÌÌ 
(
ÌÌ $
m_HardwareWaterSupport
ÌÌ &
<
ÌÌ' (
	waterMode
ÌÌ) 2
)
ÌÌ2 3
{
ÍÍ 
return
ÎÎ $
m_HardwareWaterSupport
ÎÎ -
;
ÎÎ- .
}
ÏÏ 
return
ÐÐ 
	waterMode
ÐÐ 
;
ÐÐ 
}
ÑÑ 	
private
ÓÓ 
	WaterMode
ÓÓ &
FindHardwareWaterSupport
ÓÓ 2
(
ÓÓ2 3
)
ÓÓ3 4
{
ÔÔ 	
if
ÕÕ 
(
ÕÕ 
!
ÕÕ 
GetComponent
ÕÕ 
<
ÕÕ 
Renderer
ÕÕ &
>
ÕÕ& '
(
ÕÕ' (
)
ÕÕ( )
)
ÕÕ) *
{
ÖÖ 
return
×× 
	WaterMode
××  
.
××  !
Simple
××! '
;
××' (
}
ØØ 
Material
ÚÚ 
mat
ÚÚ 
=
ÚÚ 
GetComponent
ÚÚ '
<
ÚÚ' (
Renderer
ÚÚ( 0
>
ÚÚ0 1
(
ÚÚ1 2
)
ÚÚ2 3
.
ÚÚ3 4
sharedMaterial
ÚÚ4 B
;
ÚÚB C
if
ÛÛ 
(
ÛÛ 
!
ÛÛ 
mat
ÛÛ 
)
ÛÛ 
{
ÜÜ 
return
ÝÝ 
	WaterMode
ÝÝ  
.
ÝÝ  !
Simple
ÝÝ! '
;
ÝÝ' (
}
ÞÞ 
string
àà 
mode
àà 
=
àà 
mat
àà 
.
àà 
GetTag
àà $
(
àà$ %
$str
àà% 0
,
àà0 1
false
àà2 7
)
àà7 8
;
àà8 9
if
áá 
(
áá 
mode
áá 
==
áá 
$str
áá $
)
áá$ %
{
ââ 
return
ãã 
	WaterMode
ãã  
.
ãã  !

Refractive
ãã! +
;
ãã+ ,
}
ää 
if
åå 
(
åå 
mode
åå 
==
åå 
$str
åå $
)
åå$ %
{
ææ 
return
çç 
	WaterMode
çç  
.
çç  !

Reflective
çç! +
;
çç+ ,
}
èè 
return
êê 
	WaterMode
êê 
.
êê 
Simple
êê #
;
êê# $
}
ëë 	
private
îî 
Vector4
îî 
CameraSpacePlane
îî (
(
îî( )
Camera
îî) /
cam
îî0 3
,
îî3 4
Vector3
îî5 <
pos
îî= @
,
îî@ A
Vector3
îîB I
normal
îîJ P
,
îîP Q
float
îîR W
sideSign
îîX `
)
îî` a
{
ïï 	
Vector3
ðð 
	offsetPos
ðð 
=
ðð 
pos
ðð  #
+
ðð$ %
normal
ðð& ,
*
ðð- .
clipPlaneOffset
ðð/ >
;
ðð> ?
	Matrix4x4
ññ 
m
ññ 
=
ññ 
cam
ññ 
.
ññ !
worldToCameraMatrix
ññ 1
;
ññ1 2
Vector3
òò 
cpos
òò 
=
òò 
m
òò 
.
òò 
MultiplyPoint
òò *
(
òò* +
	offsetPos
òò+ 4
)
òò4 5
;
òò5 6
Vector3
óó 
cnormal
óó 
=
óó 
m
óó 
.
óó  
MultiplyVector
óó  .
(
óó. /
normal
óó/ 5
)
óó5 6
.
óó6 7

normalized
óó7 A
*
óóB C
sideSign
óóD L
;
óóL M
return
ôô 
new
ôô 
Vector4
ôô 
(
ôô 
cnormal
ôô &
.
ôô& '
x
ôô' (
,
ôô( )
cnormal
ôô* 1
.
ôô1 2
y
ôô2 3
,
ôô3 4
cnormal
ôô5 <
.
ôô< =
z
ôô= >
,
ôô> ?
-
ôô@ A
Vector3
ôôA H
.
ôôH I
Dot
ôôI L
(
ôôL M
cpos
ôôM Q
,
ôôQ R
cnormal
ôôS Z
)
ôôZ [
)
ôô[ \
;
ôô\ ]
}
õõ 	
private
øø 
static
øø 
void
øø '
CalculateReflectionMatrix
øø 5
(
øø5 6
ref
øø6 9
	Matrix4x4
øø: C
reflectionMat
øøD Q
,
øøQ R
Vector4
øøS Z
plane
øø[ `
)
øø` a
{
ùù 	
reflectionMat
úú 
.
úú 
m00
úú 
=
úú 
(
úú  !
$num
úú! #
-
úú$ %
$num
úú& (
*
úú) *
plane
úú+ 0
[
úú0 1
$num
úú1 2
]
úú2 3
*
úú4 5
plane
úú6 ;
[
úú; <
$num
úú< =
]
úú= >
)
úú> ?
;
úú? @
reflectionMat
ûû 
.
ûû 
m01
ûû 
=
ûû 
(
ûû  !
-
ûû! "
$num
ûû" $
*
ûû% &
plane
ûû' ,
[
ûû, -
$num
ûû- .
]
ûû. /
*
ûû0 1
plane
ûû2 7
[
ûû7 8
$num
ûû8 9
]
ûû9 :
)
ûû: ;
;
ûû; <
reflectionMat
üü 
.
üü 
m02
üü 
=
üü 
(
üü  !
-
üü! "
$num
üü" $
*
üü% &
plane
üü' ,
[
üü, -
$num
üü- .
]
üü. /
*
üü0 1
plane
üü2 7
[
üü7 8
$num
üü8 9
]
üü9 :
)
üü: ;
;
üü; <
reflectionMat
ýý 
.
ýý 
m03
ýý 
=
ýý 
(
ýý  !
-
ýý! "
$num
ýý" $
*
ýý% &
plane
ýý' ,
[
ýý, -
$num
ýý- .
]
ýý. /
*
ýý0 1
plane
ýý2 7
[
ýý7 8
$num
ýý8 9
]
ýý9 :
)
ýý: ;
;
ýý; <
reflectionMat
ÿÿ 
.
ÿÿ 
m10
ÿÿ 
=
ÿÿ 
(
ÿÿ  !
-
ÿÿ! "
$num
ÿÿ" $
*
ÿÿ% &
plane
ÿÿ' ,
[
ÿÿ, -
$num
ÿÿ- .
]
ÿÿ. /
*
ÿÿ0 1
plane
ÿÿ2 7
[
ÿÿ7 8
$num
ÿÿ8 9
]
ÿÿ9 :
)
ÿÿ: ;
;
ÿÿ; <
reflectionMat
€€ 
.
€€ 
m11
€€ 
=
€€ 
(
€€  !
$num
€€! #
-
€€$ %
$num
€€& (
*
€€) *
plane
€€+ 0
[
€€0 1
$num
€€1 2
]
€€2 3
*
€€4 5
plane
€€6 ;
[
€€; <
$num
€€< =
]
€€= >
)
€€> ?
;
€€? @
reflectionMat
 
.
 
m12
 
=
 
(
  !
-
! "
$num
" $
*
% &
plane
' ,
[
, -
$num
- .
]
. /
*
0 1
plane
2 7
[
7 8
$num
8 9
]
9 :
)
: ;
;
; <
reflectionMat
‚‚ 
.
‚‚ 
m13
‚‚ 
=
‚‚ 
(
‚‚  !
-
‚‚! "
$num
‚‚" $
*
‚‚% &
plane
‚‚' ,
[
‚‚, -
$num
‚‚- .
]
‚‚. /
*
‚‚0 1
plane
‚‚2 7
[
‚‚7 8
$num
‚‚8 9
]
‚‚9 :
)
‚‚: ;
;
‚‚; <
reflectionMat
„„ 
.
„„ 
m20
„„ 
=
„„ 
(
„„  !
-
„„! "
$num
„„" $
*
„„% &
plane
„„' ,
[
„„, -
$num
„„- .
]
„„. /
*
„„0 1
plane
„„2 7
[
„„7 8
$num
„„8 9
]
„„9 :
)
„„: ;
;
„„; <
reflectionMat
…… 
.
…… 
m21
…… 
=
…… 
(
……  !
-
……! "
$num
……" $
*
……% &
plane
……' ,
[
……, -
$num
……- .
]
……. /
*
……0 1
plane
……2 7
[
……7 8
$num
……8 9
]
……9 :
)
……: ;
;
……; <
reflectionMat
†† 
.
†† 
m22
†† 
=
†† 
(
††  !
$num
††! #
-
††$ %
$num
††& (
*
††) *
plane
††+ 0
[
††0 1
$num
††1 2
]
††2 3
*
††4 5
plane
††6 ;
[
††; <
$num
††< =
]
††= >
)
††> ?
;
††? @
reflectionMat
‡‡ 
.
‡‡ 
m23
‡‡ 
=
‡‡ 
(
‡‡  !
-
‡‡! "
$num
‡‡" $
*
‡‡% &
plane
‡‡' ,
[
‡‡, -
$num
‡‡- .
]
‡‡. /
*
‡‡0 1
plane
‡‡2 7
[
‡‡7 8
$num
‡‡8 9
]
‡‡9 :
)
‡‡: ;
;
‡‡; <
reflectionMat
‰‰ 
.
‰‰ 
m30
‰‰ 
=
‰‰ 
$num
‰‰  "
;
‰‰" #
reflectionMat
ŠŠ 
.
ŠŠ 
m31
ŠŠ 
=
ŠŠ 
$num
ŠŠ  "
;
ŠŠ" #
reflectionMat
‹‹ 
.
‹‹ 
m32
‹‹ 
=
‹‹ 
$num
‹‹  "
;
‹‹" #
reflectionMat
ŒŒ 
.
ŒŒ 
m33
ŒŒ 
=
ŒŒ 
$num
ŒŒ  "
;
ŒŒ" #
}
 	
}
ŽŽ 
} æ 
kD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\WaterBase.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
public 

enum 
WaterQuality 
{ 
High 
= 
$num 
, 
Medium 
= 
$num 
, 
Low		 
=		 
$num		 
,		 
}

 
[ 
ExecuteInEditMode 
] 
public 

class 
	WaterBase 
: 
MonoBehaviour *
{ 
public 
Material 
sharedMaterial &
;& '
public 
WaterQuality 
waterQuality (
=) *
WaterQuality+ 7
.7 8
High8 <
;< =
public 
bool 
	edgeBlend 
= 
true  $
;$ %
public 
void 
UpdateShader  
(  !
)! "
{ 	
if 
( 
waterQuality 
> 
WaterQuality +
.+ ,
Medium, 2
)2 3
{ 
sharedMaterial 
. 
shader %
.% &

maximumLOD& 0
=1 2
$num3 6
;6 7
} 
else 
if 
( 
waterQuality !
>" #
WaterQuality$ 0
.0 1
Low1 4
)4 5
{ 
sharedMaterial 
. 
shader %
.% &

maximumLOD& 0
=1 2
$num3 6
;6 7
} 
else 
{ 
sharedMaterial 
. 
shader %
.% &

maximumLOD& 0
=1 2
$num3 6
;6 7
}   
if$$ 
($$ 
!$$ 

SystemInfo$$ 
.$$ '
SupportsRenderTextureFormat$$ 7
($$7 8
RenderTextureFormat$$8 K
.$$K L
Depth$$L Q
)$$Q R
)$$R S
{%% 
	edgeBlend&& 
=&& 
false&& !
;&&! "
}'' 
if)) 
()) 
	edgeBlend)) 
))) 
{** 
Shader++ 
.++ 
EnableKeyword++ $
(++$ %
$str++% 9
)++9 :
;++: ;
Shader,, 
.,, 
DisableKeyword,, %
(,,% &
$str,,& ;
),,; <
;,,< =
if.. 
(.. 
Camera.. 
... 
main.. 
)..  
{// 
Camera00 
.00 
main00 
.00  
depthTextureMode00  0
|=001 3
DepthTextureMode004 D
.00D E
Depth00E J
;00J K
}11 
}22 
else33 
{44 
Shader55 
.55 
EnableKeyword55 $
(55$ %
$str55% :
)55: ;
;55; <
Shader66 
.66 
DisableKeyword66 %
(66% &
$str66& :
)66: ;
;66; <
}77 
}88 	
public:: 
void:: "
WaterTileBeingRendered:: *
(::* +
	Transform::+ 4
tr::5 7
,::7 8
Camera::9 ?

currentCam::@ J
)::J K
{;; 	
if<< 
(<< 

currentCam<< 
&&<< 
	edgeBlend<< '
)<<' (
{== 

currentCam>> 
.>> 
depthTextureMode>> +
|=>>, .
DepthTextureMode>>/ ?
.>>? @
Depth>>@ E
;>>E F
}?? 
}@@ 	
publicBB 
voidBB 
UpdateBB 
(BB 
)BB 
{CC 	
ifDD 
(DD 
sharedMaterialDD 
)DD 
{EE 
UpdateShaderFF 
(FF 
)FF 
;FF 
}GG 
}HH 	
}II 
}JJ Œ
kD:\UNITY\Unity Projects\SanAndreasUnity\Assets\Standard Assets\Environment\Water\Water\Scripts\WaterTile.cs
	namespace 	
UnityStandardAssets
 
. 
Water #
{ 
[ 
ExecuteInEditMode 
] 
public 

class 
	WaterTile 
: 
MonoBehaviour *
{ 
public 
PlanarReflection 

reflection  *
;* +
public		 
	WaterBase		 
	waterBase		 "
;		" #
public 
void 
Start 
( 
) 
{ 	
AcquireComponents 
( 
) 
;  
} 	
private 
void 
AcquireComponents &
(& '
)' (
{ 	
if 
( 
! 

reflection 
) 
{ 
if 
( 
	transform 
. 
parent $
)$ %
{ 

reflection 
=  
	transform! *
.* +
parent+ 1
.1 2
GetComponent2 >
<> ?
PlanarReflection? O
>O P
(P Q
)Q R
;R S
} 
else 
{ 

reflection 
=  
	transform! *
.* +
GetComponent+ 7
<7 8
PlanarReflection8 H
>H I
(I J
)J K
;K L
} 
} 
if 
( 
! 
	waterBase 
) 
{ 
if   
(   
	transform   
.   
parent   $
)  $ %
{!! 
	waterBase"" 
="" 
	transform""  )
."") *
parent""* 0
.""0 1
GetComponent""1 =
<""= >
	WaterBase""> G
>""G H
(""H I
)""I J
;""J K
}## 
else$$ 
{%% 
	waterBase&& 
=&& 
	transform&&  )
.&&) *
GetComponent&&* 6
<&&6 7
	WaterBase&&7 @
>&&@ A
(&&A B
)&&B C
;&&C D
}'' 
}(( 
})) 	
public-- 
void-- 
Update-- 
(-- 
)-- 
{.. 	
AcquireComponents// 
(// 
)// 
;//  
}00 	
public44 
void44 
OnWillRenderObject44 &
(44& '
)44' (
{55 	
if66 
(66 

reflection66 
)66 
{77 

reflection88 
.88 "
WaterTileBeingRendered88 1
(881 2
	transform882 ;
,88; <
Camera88= C
.88C D
current88D K
)88K L
;88L M
}99 
if:: 
(:: 
	waterBase:: 
):: 
{;; 
	waterBase<< 
.<< "
WaterTileBeingRendered<< 0
(<<0 1
	transform<<1 :
,<<: ;
Camera<<< B
.<<B C
current<<C J
)<<J K
;<<K L
}== 
}>> 	
}?? 
}@@ 